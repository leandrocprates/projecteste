<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0038)http://www.jspbrasil.com.br/mostrar/16 -->
<HTML><STYLE>#gview-cmenu {
  position: absolute;
  border: 1px solid #ccc;
  background: #fff;
  margin: 0;
  padding: 0;
  top: 0;
  left: 0;
  z-index: 10000;
  list-style-type: none;
  -webkit-box-shadow: 0 3px 5px rgba(0, 0, 0, .5);
}

#gview-cmenu:focus {
  outline: none;
}

.gview-cmenu-item {
  margin: 0;
  padding: 5px 7px;
  cursor: default;
  font-size: 13px;
  font-family: arial, san-serif;
  color: #000;
  -webkit-user-select: none;
}

.gview-cmenu-item:hover {
  background-color: #F0F7F9;
}

.gview-cmenu-item:first-child {
  border-bottom: 1px solid #ddd;
}

.gview-hidden {
  display: none;
}
</STYLE><HEAD><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<TITLE>JEEBrasil -- O site da comunidade Java EE no Brasil</TITLE>

<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/prototype.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/effects.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/validation.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/votacao.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/form.js"></SCRIPT>

<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/layout.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/rating.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/style.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/forms.css" rel="stylesheet" type="text/css">
</HEAD><BODY>

<DIV id="page">

<!-- Cabeçalho -->
<DIV id="header">

	<DIV id="header-top">
		<H1> <A href="http://www.jspbrasil.com.br/">JEE<SPAN class="greenText">Brasil</SPAN></A> </H1>
		<H2> O site da comunidade Java EE no Brasil </H2>
	
		<DIV id="encontre">
			<H3> Encontre </H3>
			<FORM action="http://www.jspbrasil.com.br/find" method="post" id="buscaForm">
				<P>
				<INPUT id="campo" name="busca" type="text" size="26">
				<A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="$(&#39;buscaForm&#39;).submit();"> Buscar </A>
				</P>
			</FORM>
		</DIV>
	</DIV>
	
	<DIV id="menu">
		<UL>
			<LI> <A href="http://www.jspbrasil.com.br/">Home</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/noticias">Notícias</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/eventos">Eventos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/artigos">Artigos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tutoriais">Tutoriais</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tags">Tags</A> </LI>			
			<LI> <A href="http://www.jspbrasil.com.br/apresentacoes">Apresentações</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/quemsomos">Quem Somos</A> </LI>	
			<LI id="areaRestrita"> <A href="http://www.jspbrasil.com.br/admin"><IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/chave.gif" alt="Administra&ccedil;&atilde;o"></A></LI>			
		</UL>
	</DIV>
	
</DIV>

<DIV id="content">


	<DIV id="fullPanel">
		<DIV id="rightPanel">
			<H4 class="informacoes"> Informações </H4>
			<TABLE>
				<TBODY><TR>
					<TH> Tipo: </TH>
					<TD> Tutorial </TD>
				</TR>
				<TR>
					<TH> Data de Publicação: </TH>
					<TD> 31/12/2005 </TD>
				</TR>
				<TR>
					<TH> Revisado em:</TH>
					<TD> 31/12/2005 </TD>
				</TR>
			</TBODY></TABLE>
			<H4 class="nota" id="user-note">
				
				Vote!
				
				
			</H4>
			<UL class="star-rating" id="voting">
				<LI class="current-rating" id="current-rating" style="width: 125.0px">Currently 5,0/5 Stars.</LI>
				
				<LI><A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="javascript:votar(16,1, &#39;&#39;);" title="muito ruim" class="one-star">1</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="javascript:votar(16,2, &#39;&#39;);" title="ruim" class="two-stars">2</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="javascript:votar(16,3, &#39;&#39;);" title="mais ou menos" class="three-stars">3</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="javascript:votar(16,4, &#39;&#39;);" title="bom" class="four-stars">4</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/16#" onclick="javascript:votar(16,5, &#39;&#39;);" title="muito bom" class="five-stars">5</A></LI>
				
			</UL>
			
			<H4 class="tagsRelacionadas">Tags Relacionadas</H4>
			<P class="tags">
				
				<A href="http://www.jspbrasil.com.br/tags/hibernate">hibernate</A>
				
				<A href="http://www.jspbrasil.com.br/tags/framework">framework</A>
				
				<A href="http://www.jspbrasil.com.br/tags/persistencia">persistencia</A>
				
			</P>
			<H4 class="comentarios"><A href="http://www.jspbrasil.com.br/mostrar/16#comentarios">Comentários ( 5 )</A></H4>
			<H4 class="imprimir">Imprimir</H4>
		</DIV>

		<DIV id="tituloPublicacao">
			<H3> Mapeando Herança com Hibernate </H3>
			<P class="autores">
				por:<BR>
				</P><P class="autor">
				
				Raphaela Galhardo Fernandes (raphaela@jeebrasil.com.br)<BR>
				
				Gleydson Lima (gleydson@jeebrasil.com.br)<BR>
				
				</P>
			<P></P>

			<P class="resumo">
			Neste tutorial serão abordados os mapeamentos de herança com Hibernate para as três tipos de estratégias: tabela por classe concreta, tabela por hierarquia e tabela por sub-classe.
			</P>

			<H4>  </H4>
		</DIV>

		<DIV id="corpoPublicacao">
			<H4>Introdução</H4>

<P>
O Hibernate fornece vários mecanismos de se realizar o mapeamento de uma relação de herança:
</P>

<UL>
	<LI>Tabela por classe concreta: cada classe concreta é mapeada para uma tabela diferente no banco de dados;</LI>
	<LI>Tabela por Hierarquia: todas as classes são mapeadas em uma única tabela;</LI>
	<LI>Tabela por Sub-Classe: mapeia cada tabela, inclusive a classe pai, para tabelas diferentes.</LI>
</UL>

<P>
Neste tutorial serão abordados os mapeamentos de herança para as três estratégias descritas acima.
</P>

<H4>Mapeamento de Herança</H4>

<P>
Observe o exemplo de herança apresentado na Figura 1. Neste caso, as classes <B>Aluno</B> e <B>Professor</B> herdam da classe <B>Pessoa</B>, ou seja, são seus filhos.
</P>


<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/img-01.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 1 - Exemplo de Herança
</P>

<P>
As Figuras 2, 3 e 4 mostram as tabelas que devem ser criadas para as estratégias de mapeamento tabela por classe concreta, tabela por hierarquia e tabela por subclasse, respectivamente.
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/img-02.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 2 - Tabela por Classe Concreta
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/img-03.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 3 - Tabela por Hierarquia
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-6_files/img-04.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 4 - Tabela por Sub-Classe
</P>

<P>
Em relação à estratégia tabela por classe concreta, o mapeamento deve ser feito aplicando os conhecimentos já estudados em tutoriais anteriores, pois existem duas tabelas independentes. O principal problema dessa estratégia é que não suporta muito bem associações polimórficas. Em banco de dados, as associações são feitas através de relacionamentos de chave estrangeira. Neste caso, as subclasses são mapeadas em tabelas diferentes, portanto uma associação polimórfica para a classe mãe não seria possível através de chave estrangeira. Outro problema conceitual é que várias colunas diferentes de tabelas distintas compartilham da mesma semântica, podendo tornar a evolução do esquema mais complexo, por exemplo, a mudança de um tipo de uma coluna da classe mãe implica em mudanças nas várias tabelas mapeadas.
</P>

<P>
Em relação à tabela por hierarquia, o mapeamento deve ser feito como mostrado na Listagem 1. O mapeamento da classe <B>Pessoa</B> é feito para a tabela <B>PESSOA</B>. Para haver a distinção entre as três classes (<B>Pessoa</B>, <B>Aluno</B> e <B>Professor</B>) surge uma coluna especial (<EM>discriminator</EM>). Essa coluna não é uma propriedade da classe persistente, mas apenas usada internamente pelo Hibernate. No caso, a coluna <EM>discriminator</EM> é a <B>TIPO_PESSOA</B> e neste exemplo pode assumir os valores 1 e 2. Esses valores são atribuídos automaticamente pelo Hibernate.
</P>

<P>
Cada subclasse possui uma tag <B>&lt;subclass&gt;</B>, onde suas propriedades devem ser mapeadas. 
</P>


<PRE>...
&lt;hibernate-mapping&gt;

    &lt;class name="br.com.j2eebrasil.dominio.Pessoa"  table="PESSOA"
           discriminator-value="0"&gt;    
        
        &lt;id name="id" column="ID_PESSOA" type="int"&gt;
            &lt;generator class="sequence"&gt;
            	&lt;param name="sequence"&gt;pessoa_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;  
        
        &lt;!-- Coluna Discriminante --&gt;
        &lt;discriminator column="TIPO_PESSOA" type="int"/&gt;
        
        &lt;!-- Propriedades comuns --&gt;
        &lt;property name="matricula"/&gt;        
        &lt;property name="nome"/&gt;        
        &lt;property name="cpf"/&gt;       
       
       &lt;!-- Subclasse Aluno --&gt;
       &lt;subclass name="br.com.j2eebrasil.dominio.Aluno" 
                 discriminator-value="1"&gt;
         &lt;many-to-one name="curso" column="ID_CURSO"
              class="br.com.j2eebrasil.dominio.Curso"/&gt;
       &lt;/subclass&gt;

       &lt;!-- Subclasse Professor --&gt;
       &lt;subclass name="br.com.j2eebrasil.dominio.Professor" 
                discriminator-value="2"&gt;
         &lt;many-to-one name="departamento" column="ID_DEPARTAMENTO"
              class="br.com.j2eebrasil.dominio.Departamento"/&gt;
       &lt;/subclass&gt; 
          
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;

</PRE>
<P class="legenda">
Listagem 1 - Mapeamento Herança: Tabela por Hierarquia
</P>

<P>
A estratégia tabela por hierarquia é bastante simples e apresenta o melhor desempenho na representação do polimorfismo. É importante saber que restrições não nulas não são permitidas para o mapeamento de propriedades das subclasses, pois esse mesmo atributo para uma outra subclasse será nulo.
</P>

<P>
A terceira estratégia, como já citada, consiste em mapear cada classe em uma tabela diferente. Para o exemplo citado, essa estratégia de mapeamento pode ser vista na Listagem 2. Nessa estratégia as tabelas filhas contêm apenas colunas que não são herdadas e suas chaves primárias são também chaves estrangeiras para a tabela mãe.
</P>



<PRE>...
&lt;hibernate-mapping&gt;
    &lt;class name="br.com.j2eebrasil.dominio.Pessoa"  table="PESSOA"&gt;            
        &lt;id name="id" column="ID_PESSOA" type="int"&gt;
            &lt;generator class="increment"/&gt;
        &lt;/id&gt;  

        &lt;!-- Propriedades comuns --&gt;
        &lt;property name="matricula"/&gt;        
        &lt;property name="nome"/&gt;        
        &lt;property name="cpf"/&gt;       

     &lt;!--Sub-Classe Aluno --&gt;
     &lt;joined-subclass name="br.com.j2eebrasil.dominio.Aluno" 
                      table="ALUNO"&gt;
         &lt;key column="ID_ALUNO"/&gt;
         &lt;many-to-one name="curso" column="ID_CURSO"
                      class="br.com.j2eebrasil.dominio.Curso"/&gt;
     &lt;/joined-subclass&gt;

     &lt;!--Sub-Classe Professor --&gt;
     &lt;joined-subclass name="br.com.j2eebrasil.dominio.Professor" 
                      table="PROFESSOR"&gt;
         &lt;key column="ID_PROFESSOR"/&gt;
         &lt;many-to-one name="departamento" column="ID_DEPARTAMENTO"
              class="br.com.j2eebrasil.dominio.Departamento"/&gt;
     &lt;/joined-subclass&gt;     
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;    

</PRE>
<P class="legenda">
Listagem 2 - Mapeamento Herança: Tabela por Sub-Classe
</P>

<P>
Neste caso, por exemplo, se um objeto da classe <B>Aluno</B> é persistido, os valores das propriedades da classe mãe são persistidos em uma linha da tabela <B>PESSOA</B> e apenas os valores correspondentes à classe <B>Aluno</B> são persistidos em uma linha da tabela <B>ALUNO</B>. Em momentos posteriores essa instância de aluno persistida pode ser recuperada de um <EM>join</EM> entre a tabela filha e a tabela mãe. Uma grande vantagem dessa estratégia é que o modelo de relacionamento é totalmente normalizado.
</P>

<P>
Observe que no mapeamento, o Hibernate utiliza a tag <B>&lt;joined-class&gt;</B> para realizar o mapeamento por subclasse. A tag <B>key</B> declara as chaves primárias das subclasses que são também chaves estrangeiras para a chave primária da classe mãe.
</P>

<H4>Conclusões</H4>

<P>
Neste tutorial foi apresentado o mapeamento de herança com Hibernate utilizando três estratégias distintas. A escolha da estratégia vai depender dos requisitos exigidos pela aplicação.
O próximo apresenta conceitos relacionados a transações e como ela é implementada com Hibernate.
</P>


<H4> Referências</H4>

<OL>
	
<LI>Christian Bauer e Gavin King. Hibernate in Action. 2005.</LI>
<LI>Grupo Hibernate. Hibernate Reference 	Documentation. Version 3.0.5. Obtido 
     em http://www.hibernate.org</LI>
<LI>Gleydson de Azevedo Ferreira Lima. Material Didático. 2005.</LI>
<LI>Nick Heudecker. Introdução ao Hibernate.</LI>
<LI>Maurício Linhares. Introdução ao Hibernate 3.</LI>
<LI>Francesc Rosés Albiol. Introducción a Hibernate. 2003.</LI>
<LI>Fabiano Kraemer, Jerônimo Jardel Vogt. Hibernate, um Robusto Framework de 
     Persistência Objeto-Relacional. 2005.</LI>
</OL>



























		</DIV>

		<A name="comentarios"></A>
		
		<DIV id="listaComentarios">
		<H4> Comentários (5) </H4>
			<DL>
				
				<DT>
				Na verdade tenho uma dúvida. Estou programando um sistema utilziando hibernate, onde utilizo herança. Porém, tenho uma outra classe que deverá conter um elemento do pai e um do filho, ou seja, um relacionamento n-1 com cada um deles. Gostaria de saber como ficaria o XML nesse caso. Grato.
				</DT>
					<DD> postado por Diego Velasco em 09/11/2006 às 23:21</DD>
				
				<DT>
				Esta estrategia que voce esta usando me parece um tanto estranho. Se o filho herda tudo do pai, por que entao voce precisa referenciar o pai e o filho?
Atente tambem para o fato de que voce deve evitar referencias circulares.
				</DT>
					<DD> postado por Yuri em 21/11/2006 às 23:21</DD>
				
				<DT>
				Quero saber como implementar o Mapeamento Herança: Tabela por Sub-Classe utlizando annotations.

Obrigado.
				</DT>
					<DD> postado por Jefferson em 22/12/2006 às 23:21</DD>
				
				<DT>
				O que tenho a dizer que vcs sâo mto bom por de mais,mto sucesso e alegria nessa caminhada um forte abraço e um grande bjx.
				</DT>
					<DD> postado por Elza Teodoro em 27/06/2009 às 23:21</DD>
				
				<DT>
				Supondo que em determinado momento o aluno passe a ser professor (deixando de ser aluno). Que impacto esta transformação causaria?
				</DT>
					<DD> postado por José Carlos Thompson em 29/06/2009 às 23:21</DD>
				
			</DL>
		</DIV>
		

	<DIV id="comente">
	<FORM action="http://www.jspbrasil.com.br/comentario" id="form" method="post">
	<FIELDSET>
		<LEGEND>Comente!</LEGEND>
		
		

		<DIV class="notes">
      	<H4>Observações</H4>
      	<P>Os campos em <STRONG>negrito</STRONG> são <STRONG>obrigatórios</STRONG>.</P>
      	<P>Para evitar problemas, este espaço é moderado. Após o envio do comentário será
      	necessário aguardar pela sua aprovação.</P>
    	</DIV> 
		
		<DIV class="obrigatorio">
		<LABEL for="nome">Nome:</LABEL> 
		<INPUT type="text" id="nome" class="required" name="nome" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="email">E-Mail:</LABEL> 
		<INPUT type="text" id="email" class="validate-email" name="email" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="site">Site:</LABEL> 
		<INPUT type="text" id="site" class="validate-url" name="site" size="58" value="">
		</DIV>
		
		<DIV class="obrigatorio">
		<LABEL for="texto">Comentário:</LABEL> 
		<TEXTAREA name="texto" id="texto" class="required" rows="5" cols="55"></TEXTAREA>
		</DIV>
		
	    <P class="botoes">    
			<INPUT type="submit" value="Enviar">
    	</P>
		
	</FIELDSET>

	<INPUT type="hidden" name="publicacao.id" value="16">
	</FORM>
	</DIV>
	<A name="bottom">


</A></DIV><A name="bottom"> <!-- fim de content -->

<SCRIPT type="text/javascript">
	var validForm = new Validation('form');
</SCRIPT>

</A></DIV><A name="bottom"> <!-- Fim de Content -->

</A><DIV id="footer"><A name="bottom">
	</A><A href="http://www.jspbrasil.com.br/quemsomos"> Quem Somos </A> &nbsp;|&nbsp;
	<A href="mailto:sugestoes@jeebrasil.com.br"> Fale Conosco</A>
	<P>Copyright 2006 - JEEBrasil.</P>
</DIV>

</DIV> <!-- fim de page -->



</BODY></HTML>