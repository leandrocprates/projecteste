var Widget=new Class({Implements:Events,shareables:[],shareablesKey:"",shareableIndex:0,authToken:"",user:null,maxContactSearchResults:5,maxSendMessageLength:2000,initialize:function(){this.user=new Widget.User(this);window.contacts=this.contacts;this.pages=this.initializePages(this.pages)},setMaxContactSearchResults:function(a){this.maxContactSearchResults=a},userIsSignedIn:function(){return this.user.isSignedIn()},signIn:function(){var a=false;var b="";if($("login_username").value===""){b+="Please enter your username.\n";a=true}if($("login_password").value===""){b+="Please enter your password.";a=true}if(!a){this.user.signIn($("login_username").value,$("login_password").value)}else{widget.validationFailed(b)}},signOut:function(){forgetUser();this.user.signOut()},limitCharacters:function(d,a,e,f){var b=true;if(d.value.length>=a){switch(f.key){case"up":case"down":case"left":case"right":case"del":case"delete":case"backspace":b=true;break;default:b=false;break}}else{if(d.value.length>=a-10){e.style.color="#FF0000"}else{if(d.value.length>=a-20){e.style.color="#5C0002"}else{e.style.color="#666666"}}}e.set("html",a-d.value.length);return b},postBlogger:function(){var f=$("post_username").value;var l=$("post_password").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value==="true"){var h=1}else{var h=0}var d="";var m=false;if(!f&&!b){m=true;d+="Please enter a username.\n"}if(!l&&!b){m=true;d+="Please enter a password.\n"}if(m){widget.validationFailed(d)}else{if(document.getElementById("post_select")){var b=$("post_select").get("value")}var g="";var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(!b){g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_bloggerDraft+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h}else{g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_bloggerDraft+"&t="+glo_title+"&return=json&blogid="+b+"&rememberme="+k+"&forgetme="+h}var e=new Request({method:"post",url:"/api/postBlogger_ws.php",data:g,onFailure:function(){logError("postblogger","Ajax Failure")},onSuccess:this.postBlogger_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","blogger");e.send()}},postBlogger_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post blogger",b)}if(d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","blogger")}if(d.status==="FAILURE"){if(d.errorMessage&&d.errorMessage.toLowerCase()==="auth_failed"){this.fireEvent("postToServiceFailed",["blogger","Invalid Blogger Username or Password"])}else{if(d.errorMessage&&d.errorMessage.toLowerCase()==="multiple"){this.fireEvent("postToServiceNeedsMoreInfo",["blogger","You have successfully signed on. Please select a blog.",d.data])}else{if(d.statusMessage&&d.statusMessage.toLowerCase()==="missing_parameter_token"){this.fireEvent("postToServiceFailed",["blogger","Remembering Credentials is for Signed in Users Only",d.data])}else{logError("get contacts",JSON.encode(d));this.fireEvent("postToServiceFailed",["blogger","Unable to connect to your blog."])}}}}},postLive_journal:function(){var f=$("post_username").value;var l=$("post_password").value;var g=$("post_message").value;if(g==="optional"){g=""}g=encodeURIComponent(g);if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value==="true"){var h=1}else{var h=0}var b="";var m=false;if(!f){m=true;b+="Please enter a username.\n"}if(!l){m=true;b+="Please enter a password.\n"}var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(b){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(m){widget.validationFailed(b)}else{var e="";e="username="+f+"&password="+l+"&d="+g+"<br/><br/>"+glo_content+j+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h;var d=new Request({method:"post",url:"/api/postLiveJournal_ws.php",data:e,onFailure:function(){logError("postLiveJournal","Ajax Failure")},onSuccess:this.postLive_journal_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","livejournal");d.send()}},postLive_journal_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post_live_journal",b)}if(d.status.toLowerCase()==="success"){this.fireEvent("postToServiceSucceeded","livejournal")}else{logError("postLiveJournal",JSON.encode(d));this.fireEvent("postToServiceFailed",["livejournal","Error while trying to post to your blog."])}},postTwitter:function(){var e=$("post_username").value;var j=$("post_password").value;var d=$("post_message").value;if($("post_remember_me").checked){var h=1}else{var h=0}if($("post_forget_me").value=="true"){var g=1}else{var g=0}var a="";var k=false;if(!e){k=true;a+="Please enter a username.\n"}if(!j){k=true;a+="Please enter a password.\n"}if(!d){k=true;a+="Please enter a status update.\n"}if(d.length>140){k=true;a+="Twitter post too long. Please shorten to less than 140 characters.\n"}if(k){widget.validationFailed(a)}else{var f="";f="username="+e+"&password="+j+"&status="+encodeURIComponent(d)+"&rememberme="+h+"&forgetme="+g+"&return=json";var b=new Request({method:"post",url:"/api/postTwitter_ws.php",data:f,onFailure:function(){logError("postTwitter","Ajax Failure")},onSuccess:this.postTwitter_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","twitter");b.send()}},postTwitter_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("postTwitter",b)}if(d.status&&d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","twitter.com")}else{if(d.errorMessage){switch(d.errorMessage.toLowerCase()){case"auth_failed":this.fireEvent("postToServiceFailed",["twitter","Invalid Twitter Username or Password"]);break;default:this.fireEvent("postToServiceFailed",["twitter",d.errorMessage])}}else{logError("postTwitter",JSON.encode(d));this.fireEvent("postToServiceFailed",["twitter","Unable to connect to ShareThis server."])}}},postTypePad:function(){var f=$("post_username").value;var l=$("post_password").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value=="true"){var h=1}else{var h=0}var d="";var m=false;if(!f&&!b){m=true;d+="Please enter a username.\n"}if(!l&&!b){m=true;d+="Please enter a password.\n"}if(m){widget.validationFailed(d)}else{if(document.getElementById("post_select")){var b=$("post_select").get("value")}var g="";var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(!b){g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_tpDraft+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h}else{g="blogid="+b+"&d="+glo_content+j+"&draft="+glo_tpDraft+"&password="+l+"&t="+glo_title+"&username="+f+"&return=json&rememberme="+k+"&forgetme="+h}var e=new Request({method:"post",url:"/api/postTypePad_ws.php",data:g,onFailure:function(){logError("postTypePad","Ajax Failure")},onSuccess:this.postTypePad_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","typepad");e.send()}},postTypePad_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post typepad",b)}if(d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","typepad")}if(d.status.toLowerCase()=="failure"){if(d.errorMessage&&d.errorMessage.toLowerCase()=="auth_failed"){this.fireEvent("postToServiceFailed",["typepad","Invalid Typepad Username or Password"])}if(d.errorMessage&&d.errorMessage.toLowerCase()=="multiple"){this.fireEvent("postToServiceNeedsMoreInfo",["typepad","You have successfully signed on. Please select a blog.",d.data])}else{logError("postTypePad",JSON.encode(d));this.fireEvent("postToServiceFailed",["typepad","Unable to connect to your blog."])}}},postWordpress:function(){var g=$("post_username").value;var l=$("post_password").value;var a=$("post_url").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value=="true"){var h=1}else{var h=0}var d="";var m=false;if(!g){m=true;d+="Please enter a username.\n"}if(!l){m=true;d+="Please enter a password.\n"}if(!a){m=true;d+="Please enter a url.\n"}var b=glo_title;try{b=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+b+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(m){this.validationFailed(d)}else{var f="";f="username="+g+"&password="+l+"&d="+glo_content+j+"&t="+glo_title+"&return=json&url="+a+"&rememberme="+k+"&forgetme="+h;var e=new Request({method:"post",url:"/api/postWordPress_ws.php",data:f,onFailure:function(){logError("postWordpress","Ajax Failure")},onSuccess:this.postWordpress_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","wordpress");e.send()}},postWordpress_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post wordpress",b)}if(d.status.toLowerCase()==="success"){this.fireEvent("postToServiceSucceeded","wordpress")}else{if(d.errorMessage&&d.errorMessage.toLowerCase()==="connection_failed"){this.fireEvent("postToServiceFailed",["wordpress","Unable to connect to your blog."])}else{if(d.errorMessage&&d.errorMessage.toLowerCase()=="auth_failed"){this.fireEvent("postToServiceFailed",["wordpress","Please Check Username and Password."])}else{if(d.statusMessage&&(d.statusMessage.toLowerCase()=="post_failed"||d.statusMessage.toLowerCase()=="post_wordpress_service_failed")){this.fireEvent("postToServiceFailed",["wordpress","Post Failed."])}else{logError("postWordpress",JSON.encode(d));this.fireEvent("postToServiceFailed",["wordpress","Unable to connect to your blog."])}}}}},setImportContactService:function(a){this.currentImportContactService=this.contactSources[a];this.fireEvent("importContactServiceChanged",a)},setLoginService:function(a){this.currentLoginService=this.loginSources[a];this.fireEvent("loginServiceChanged",a)},getQueryParam:function(d,b){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+d+"=([^&#]*)";var f=new RegExp(a);var e=f.exec(b);if(e==null){return""}else{return e[1]}},importContacts:function(b,h,e,d,a){Cookie.dispose("import",{domain:".sharethis.com",path:"/"});Cookie.dispose("import_delt",{domain:".sharethis.com",path:"/"});if(d){widget.popModalWorkingSheet()}var g="provider="+b.protocolName+"&username="+h+"&password="+e+"&contact_url="+d+"&base_url=http://"+window.location.hostname+"/&referer=share3x/import.php&delt="+a;var f=new Request({method:"post",url:"/api/importContacts_ws.php",data:g,onFailure:function(){logError("import contacts","Ajax Failure")},onSuccess:(function(n,p){try{var o=JSON.decode(n)}catch(m){logError("import contacts",n)}if(o.status==="SUCCESS"&&o.data){for(var l=0;l<o.data.contacts.length;l++){if(!("service" in o.data.contacts[l])){var q=Widget.Contact.guessServiceForAddress(o.data.contacts[l].address,b.protocolName);if(!q){q=b.protocolName}o.data.contacts[l].service=q}}if(this.userIsSignedIn()){var j=null;var k=null;j=(function(){this.fireEvent("importContactsSucceeded",{nContacts:o.data.contacts.length,rawData:o.data.contacts});this.user.removeEvent("addContactsToAccountSucceeded",j);this.user.removeEvent("addContactsToAccountFailed",k)}).bind(this);this.user.addEvent("addContactsToAccountSucceeded",j);k=(function(){this.fireEvent("importContactsFailed");this.user.removeEvent("addContactsToAccountSucceeded",j);this.user.removeEvent("addContactsToAccountFailed",k)}).bind(this);this.user.addEvent("addContactsToAccountFailed",k);this.user.addContactsToAccount(o.data.contacts)}else{this.user.addContactsLocally(o.data.contacts);this.fireEvent("importContactsSucceeded",{nContacts:o.data.contacts.length,rawData:o.data.contacts})}}else{if(o.errorMessage=="LOGIN_FAILED :: Invalid credentials"){widget.popModalWorkingSheet();widget.pushModalErrorSheet("Invalid Username or password.")}else{logError("import contacts",JSON.encode(o));this.fireEvent("importContactsFailed")}}}).bind(this)});f.send();this.fireEvent("importContactsRequested")},login:function(b,h,e,d,a){if(b.protocolName=="sharethis"){widget.signIn();return true}Cookie.dispose("import",{domain:".sharethis.com",path:"/"});Cookie.dispose("import_delt",{domain:".sharethis.com",path:"/"});if(d){widget.popModalWorkingSheet()}var g="provider="+b.protocolName+"&username="+h+"&password="+e+"&contact_url="+d+"&base_url=http://"+window.location.hostname+"/&referer=share3x/import.php&delt="+a;var f=new Request({method:"post",url:"/api/importContacts_ws.php",data:g,onFailure:function(){logError("import contacts","Ajax Failure")},onSuccess:(function(n,p){try{var o=JSON.decode(n)}catch(m){logError("import contacts",n)}if(o.status==="SUCCESS"&&o.data){for(var l=0;l<o.data.contacts.length;l++){if(!("service" in o.data.contacts[l])){var q=Widget.Contact.guessServiceForAddress(o.data.contacts[l].address,b.protocolName);if(!q){q=b.protocolName}o.data.contacts[l].service=q}}if(this.userIsSignedIn()){var j=null;var k=null;j=(function(){this.fireEvent("importContactsSucceeded",{nContacts:o.data.contacts.length,rawData:o.data.contacts});this.user.removeEvent("addContactsToAccountSucceeded",j);this.user.removeEvent("addContactsToAccountFailed",k)}).bind(this);this.user.addEvent("addContactsToAccountSucceeded",j);k=(function(){this.fireEvent("importContactsFailed");this.user.removeEvent("addContactsToAccountSucceeded",j);this.user.removeEvent("addContactsToAccountFailed",k)}).bind(this);this.user.addEvent("addContactsToAccountFailed",k);this.user.addContactsToAccount(o.data.contacts)}else{this.user.addContactsLocally(o.data.contacts);this.fireEvent("importContactsSucceeded",{nContacts:o.data.contacts.length,rawData:o.data.contacts})}}else{if(o.errorMessage=="LOGIN_FAILED :: Invalid credentials"){widget.popModalWorkingSheet();widget.pushModalErrorSheet("Invalid Username or password.")}else{logError("import contacts",JSON.encode(o));this.fireEvent("importContactsFailed")}}}).bind(this)});f.send();this.fireEvent("importContactsRequested")},updatePreview:function(a){if(this.shareables[a].icon!==""){$("icon").set("html",'<img src="'+this.shareables[a].icon+'" width="100" />')}if(this.shareables[a].url!==""){$("title").set("html",'<a href="'+this.shareables[a].url+'" target="_blank">'+this.shareables[a].title+"</a>")}else{$("title").set("html",this.shareables[a].title)}$("summary").set("html",this.shareables[a].summary);$("content").set("html",this.shareables[a].content)},saveToShareBox:function(b,h){if(b=="Separated by commas"){b=""}var a=[{type:"sharethis.com",address:(glo_destinationAddress?glo_destinationAddress:"")}];if(typeof b=="string"){b=b.replace(/\s*,\s*/g,",").split(",").join(",")}else{if(typeof b=="object"&&"length" in b){b=b.join(",")}}var e=glo_title;try{e=decodeURIComponent(glo_title)}catch(g){}if(!h||!h.length||h.length==0){h=[{type:"default",url:getSharURL(),title:e,thumbnail:glo_thumb,embed:encodeURIComponent(Url.decode(glo_content)),description:(glo_description?glo_description:""),tags:(b?b:"")}]}var d=(glo_userEmail&&glo_userEmail.length?encodeURIComponent(glo_userEmail):"");var f=new Request({method:"post",url:"/api/createDestination_ws.php",data:{publisher:glo_publisher,objects:encodeURIComponent(JSON.encode(h)),destinations:encodeURIComponent(JSON.encode(a)),sessionID:glo_sessionID,destinationType:"Social","return":"JSON",sender:d},onFailure:function(){logError("save to sharebox","Ajax Failure")},onSuccess:(function(l,m){try{var j=JSON.decode(l)}catch(k){logError("save to sharebox",l)}if(j.status){switch(j.status){case"SUCCESS":widget.fireEvent("saveToShareBoxSucceeded");break;case"FAILURE":widget.fireEvent("saveToShareBoxFailed");logError("save to sharebox",j);default:break}}else{logError("save to sharebox",JSON.encode(j));widget.fireEvent("saveToShareBoxFailed")}}).bind(this)});f.send()},extractDomainFromURL:function(b,a){var d=b.replace(/(\w+):\/\/([^\/:]+)(:\d*)?([^# ]*)/,"$2");if(!a&&d.toLowerCase().indexOf("www.")==0){d=d.substring(4)}return d},setCookie:function(d,f){var e=new Date;var h=e.getFullYear();var j=e.getMonth()+2;var g=e.getDate();var b=d+"="+escape(f);if(h){var a=new Date(h,j,g);b+="; expires="+a.toGMTString()}b+="; domain="+escape(".sharethis.com")+";path=/";document.cookie=b},getCookie:function(b){var a=document.cookie.match("(^|;) ?"+b+"=([^;]*)(;|$)");if(a){return(unescape(a[2]))}else{return false}},deleteCookie:function(a){var d="/";var b=".sharethis.com";document.cookie=a+"="+((d)?";path="+d:"")+((b)?";domain="+b:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"},validationFailed:function(a){widget.pushModalErrorSheet(a.replace(/\n/g,"<br/>"))},truncateText:function(f,e,a){var a=a||8;var d=a*2.5;var b=((f.length*a)-(e-d));if(b>0){return f.substring(0,f.length-Math.ceil(b/a))+"&hellip;"}return f},_deferTimers:{},deferWhile:function(a,d,b){if(this._deferTimers[a]>=0){clearTimeout(this._deferTimers[a])}this._deferTimers[a]=setTimeout((function(){this._deferTimers[a]=-1;d()}).bind(this),(b||10))},_frozenFocusHandler:function(a){if(a.target.hasClass("frozen")){a.target.blur()}},freezeTextInput:function(a){a.disabled=true;a.addClass("frozen");a.addEvent("focus",this._frozenFocusHandler);a.blur()},unfreezeTextInput:function(a){a.disabled=false;a.removeClass("frozen");a.removeEvent("focus",this._frozenFocusHandler)},_profilers:[],pushProfiler:function(a){this._profilers.push({start:$time(),message:a})},popProfiler:function(){if(Browser.Engine.trident){var d=this._profilers.pop();var b="";for(var a=0;a<this._profilers.length;a++){b+="   "}alert(b+d.message+" ["+($time()-d.start)+"]")}else{var d=this._profilers.pop();var b="";for(var a=0;a<this._profilers.length;a++){b+="   "}}}});if(!window.console||!console.firebug){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=function(){}}}var glo_tabs="web,post,email";var glo_send_services="email,myspace,aim,sms";var glo_tabArray=[];glo_tabArray=glo_tabs.split(",");var glo_charset="utf-8";var glo_services="";var glo_default_services="myspace,digg,sms,windows_live,delicious,stumbleupon,reddit,google_bmarks,linkedin,bebo,ybuzz,blogger,yahoo_bmarks,mixx,technorati,friendfeed,propeller,wordpress,newsvine,xanga,blinklist,twine,twackle,diigo,fark,faves,mister_wong,current,livejournal,kirtsy,slashdot,oknotizie,care2,aim,meneame,simpy,blogmarks,n4g,bus_exchange,funp,sphinn,fresqui,dealsplus,typepad,yigg";var glo_top_services="email,facebook,twitter,sharebox";var glo_send_servicesArray=[];var glo_default_swArray=[];glo_default_swArray=glo_default_services.split(",");var glo_style="default";var glo_publisher="";var glo_headerbg="#999999";var glo_headerTitle="";var glo_headerfg="#ffffff";var glo_inactivebg="#D2D2D2";var glo_inactivefg="#424242";var glo_linkfg="#222";var glo_embeds=false;var glo_popup=false;var glo_offsetLeft=0;var glo_offsetTop=0;var glo_isLoggedIn=false;var glo_authToken="";var glo_userName="";var glo_userEmail="";var glo_facebook="";var glo_aim="";var glo_greyBoxNum=0;var glo_contProto=[];var glo_contName=[];var glo_contAdd=[];var glo_contRes=[];var glo_contResNum=0;var glo_swArray=[];var glo_swArray_more=[];var glo_msgArray=[];var glo_hostname="";var glo_location="";var glo_url="";var glo_title="";var glo_type="default";var glo_content="";var glo_summary="";var glo_icon="";var glo_category="";var glo_updated="";var glo_published="";var glo_author="";var glo_totalRegSW=0;var glo_tpDraft=1;var glo_bloggerDraft=1;var glo_guid="";var glo_guid_index=null;var glo_title_array=[];var glo_summary_array=[];var glo_content_array=[];var glo_url_array=[];var glo_icon_array=[];var glo_category_array=[];var glo_updated_array=[];var glo_published_array=[];var glo_author_array=[];var glo_type_array=[];var glo_tags_array=[];var glo_thumb_array=[];var glo_description_array=[];var glo_last_search="";var glo_thumb="";var glo_tags="";var glo_description="";var glo_num_diggs=0;var glo_digg_comments=0;var glo_pageOptions=false;var glo_swDiv="";var glo_oldQS="";var glo_destinations="";var glo_page_url="";var glo_page_title="";var glo_jsonStr="";var glo_jsonArray=[];var glo_destinationAddress="";var glo_destinationType="Social";var glo_options_popup=false;var displayNum=20;var glo_last_url="";var glo_last_url2="";var glo_initRun=false;var domReady=false;var bufferArgs=[];var bufferValue=[];var bufferRunArgs=[];var glo_hash_flag=false;var glo_sessionID=null;var glo_fpc=null;var glo_thumbImageTag="";var glo_browser="";var glo_toolbar=false;var glo_tracking="";var glo_googleProfileId="";var googlePubTracker="";var glo_omnitureURL="";var glo_sharURL="";var import_cookie="";var signin_cookie="";var import_cookie_tid;var signin_cookie_tid;var import_cookie_cycles=0;var signin_cookie_cycles=0;var glo_ads=false;var glo_adtag_header="";var glo_adtag_footer="";var glo_page="";var glo_post_page=[];var glo_credentials=[];var glo_pUrl="";function css_browser_selector(e){var f=e.toLowerCase(),m=function(b){return f.indexOf(b)>-1},l="gecko",d="webkit",k="safari",j=document.getElementsByTagName("html")[0],a=[(!(/opera|webtv/i.test(f))&&/msie\s(\d)/.test(f))?("ie ie"+RegExp.$1):m("firefox/2")?l+" ff2":m("firefox/3")?l+" ff3":m("gecko/")?l:/opera(\s|\/)(\d+)/.test(f)?"opera opera"+RegExp.$2:m("konqueror")?"konqueror":m("chrome")?d+" "+k+" chrome":m("applewebkit/")?d+" "+k+(/version\/(\d+)/.test(f)?" "+k+RegExp.$1:""):m("mozilla/")?l:"",m("j2me")?"mobile":m("iphone")?"iphone":m("ipod")?"ipod":m("mac")?"mac":m("darwin")?"mac":m("webtv")?"webtv":m("win")?"win":m("freebsd")?"freebsd":(m("x11")||m("linux"))?"linux":"","js"];c=a.join(" ");j.className+=" "+c;return c}var glo_browser=css_browser_selector(navigator.userAgent);var tstArray=[];function fragObj(a,b){this.frag=a;this.qs=b}function readyTest(){for(var b=0;b<tstArray.length;b++){var a=tstArray[b].frag+" = \n"+tstArray[b].qs;alert(a)}}function setGlobals(b,e){var d="";if(e===0){d="No"}if(e===1){d="Yes"}try{e=decodeURIComponent(e)}catch(a){}try{e=decodeURIComponent(e)}catch(a){}switch(b){case"tabs":glo_tabs=e;glo_tabArray=e.split(",");tab_servicesChanged();break;case"charset":glo_charset=e;break;case"services":glo_servces=e;glo_swArray=e.split(",");break;case"style":glo_style=e;break;case"publisher":glo_publisher=e;break;case"headerbg":glo_headerbg=e;$$(".header-color").setStyle("background-color",e);break;case"inactivebg":glo_inactivebg=e;$$(".nav-inactive-color").setStyle("background-color",e);break;case"inactivefg":glo_inactivefg=e;$$(".nav-inactive-color").setStyle("color",e);break;case"linkfg":glo_linkfg=e;setTimeout("widget.fireEvent('linkForegroundColorChanged', glo_linkfg)",10);break;case"embeds":glo_embeds=e;break;case"popup":glo_popup=e;break;case"offsetLeft":glo_offsetLeft=e;break;case"offsetTop":glo_offsetTop=e;break;case"auth":glo_authToken=e;break;case"userEmail":glo_userEmail=e;$("textAuthInfoEmail").set("html",e);break;case"userName":glo_userName=e;break;case"facebook":glo_facebook=e;break;case"aim":glo_aim=e;break;case"contProto":glo_contProto.push(e);break;case"contName":glo_contName.push(e);break;case"contAdd":glo_contAdd.push(e);break;case"contName":glo_contRes.push(e);break;case"contResNum":glo_contResNum=e;break;case"loggedIn":glo_isLoggedIn=e;if(glo_isLoggedIn===true){$("boxToYourAddr").addClass("hidden");$$(".guest").addClass("hidden")}else{$("boxToYourAddr").removeClass("hidden");$$(".guest").removeClass("hidden")}break;case"hostname":glo_hostname=encodeURIComponent(e);break;case"location":glo_location=encodeURIComponent(e);break;case"url":if(e!==glo_url&&e!==undefined){if(typeof(e)!=="string"){try{glo_url=e.href}catch(a){}}else{glo_url=e}glo_thumbImageTag="http://sharethis.com/share/thumb?url="+glo_url;$("previewUrl").set("text",widget.extractDomainFromURL(glo_url));getDiggs(glo_url);createSharURL(glo_url,true)}break;case"title":glo_title=e;if(glo_title==""||glo_title=="undefined"){glo_title=decodeURIComponent(glo_url)}try{e=decodeURIComponent(e)}catch(a){}if(e.length>80){e=e.slice(0,77);e+="..."}$("previewTitle").set("text",e);widget.fireEvent("shareableTitleChanged",glo_title);break;case"type":glo_type=e;break;case"icon":glo_icon=e;if(e.length>5){glo_thumbImageTag=e}break;case"category":glo_category=e;break;case"updated":glo_updated=e;break;case"published":glo_published=e;break;case"author":glo_author=e;break;case"summary":glo_summary=e;break;case"content":glo_content=encodeURIComponent(e);break;case"glo_tpDraft":glo_tpDraft=e;break;case"glo_bloggerDraft":glo_bloggerDraft=e;break;case"guid":if(glo_guid===""&&e!==null&&e!=="null"){glo_guid=e;getObjects()}break;case"guid_index":glo_guid_index=e;setValues();break;case"glo_title_array":glo_title_array.push(e);break;case"glo_type_array":glo_type_array.push(e);break;case"glo_summary_array":glo_summary_array.push(e);break;case"glo_content_array":glo_content_array.push(e);break;case"glo_url_array":glo_url_array.push(e);break;case"glo_icon_array":glo_icon_array.push(e);break;case"glo_category_array":glo_category_array.push(e);break;case"glo_updated_array":glo_updated_array.push(e);break;case"glo_published_array":glo_published_array.push(e);break;case"glo_author_array":glo_author_array.push(e);break;case"glo_thumb":glo_thumb=e;break;case"glo_tags":glo_tags=e;break;case"glo_description":glo_description=e;glo_description=encodeURIComponent(glo_description);widget.fireEvent("shareableDescriptionChanged",glo_description&&glo_description!="undefined"?glo_description:"");break;case"glo_thumb_array":glo_thumb_array.push(e);break;case"glo_tags_array":glo_tags_array.push(e);break;case"glo_description_array":glo_description_array.push(e);break;case"pageTitle":glo_page_title=e;break;case"pageURL":glo_page_url=e;break;case"hash_flag":if(e=="true"){glo_hash_flag=true}else{glo_hash_flag=false}break;case"sessionID":glo_sessionID=e;break;case"fpc":glo_fpc=e;break;case"headerTitle":glo_headerTitle=e;widget.fireEvent("headerTitleChanged",e);break;case"headerfg":glo_headerfg=e;widget.fireEvent("headerFGColorChanged",e);break;case"post_services":setGlobals("services",e);break;case"send_services":glo_send_servicesArray=e;send_servicesChanged(e);break;case"glo_toolbar":glo_toolbar=e;$("close_button").set("style","display:inline");break;case"tracking":glo_tracking=e;break;case"googleProfileId":glo_googleProfileId=e;break;case"omnitureURL":glo_omnitureURL=e;break;case"ads":if(e=="true"){glo_ads=true}else{glo_ads=false}break;case"adtag_header":glo_adtag_header=e;if(e!=""){$("header_ad").setStyle("height","40px");$("header_ad").removeClass("hidden")}break;case"adtag_footer":glo_adtag_footer=e;if(e!=""){$("footer_ad").removeClass("hidden")}break;case"page":glo_page=e;if(glo_page=="send"||glo_page.match("post|")){if(glo_page=="post|twitter"){createSharURL(glo_url,true);widget.fireEvent("twitterClicked",getSharURL())}widget.showPage(glo_page)}else{if(glo_page=="import"){widget.showPage("import");event.stop()}else{widget.showPage("home")}}break;case"pUrl":glo_pUrl=e;default:break}}function addToOptions(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}tstArray.push(new fragObj(d[0],d[1]));setGlobals(d[0],d[1])}function addToOptionsBuffer(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}tstArray.push(new fragObj(d[0],d[1]));bufferArgs.push(d[0]);bufferValue.push(d[1])}function checkBufferArg(b){var d=false;for(var a=0;a<bufferRunArgs.length;a++){if(bufferRunArgs[a]==b){d=true}}return d}function processBuffer(){bufferArgs.reverse();bufferValue.reverse();for(var a=0;a<bufferArgs.length;a++){if(checkBufferArg(bufferArgs[a])===false){bufferRunArgs.push(bufferArgs[a]);setGlobals(bufferArgs[a],bufferValue[a])}}createSwList();switch(glo_tracking){case"google":case"omniture":var b=new Request({method:"post",url:"/api/getPublisherDomains_ws.php",data:"publisher="+glo_publisher+"&return=json",onFailure:function(){logError("glo_tracking","Ajax Failure")},onSuccess:function(h,k){try{var e=JSON.decode(h)}catch(d){logError("glo_tracking",h)}if(e.status==="SUCCESS"){var j=document.referrer;var l=new RegExp("^(http|https)://([^/]*)");var n=j.match(l);var f=n[2];for(var g=0;g<e.data.domain.length;g++){if(f==e.data.domain[g].name){if(e.data.domain[g].google_analytics!=""&&glo_tracking=="google"){setGlobals("googleProfileId",e.data.domain[g].google_analytics);var m=new Element("script").set("src","http://www.google-analytics.com/ga.js").set("type","text/javascript").addEvent("load",function(){googlePubTracker=_gat._getTracker(glo_googleProfileId)}).inject($("container"),"after")}if(e.data.domain[g].omniture!=""&&glo_tracking=="omniture"){setGlobals("omnitureURL",e.data.domain[g].omniture)}}}}else{logError("glo_tracking",JSON.encode(e))}}});b.send();break}if(glo_ads==true){var b=new Request({method:"post",url:"/api/getPublisherDomains_ws.php",data:"publisher="+glo_publisher+"&return=json",onFailure:function(){logError("add Request","Ajax Failure")},onSuccess:function(h,k){try{var e=JSON.decode(h)}catch(d){logError("add request",h)}if(e.status==="SUCCESS"){var j=document.referrer;var l=new RegExp("^(http|https)://([^/]*)");var m=j.match(l);var f=m[2];for(var g=0;g<e.data.domain.length;g++){if(f==e.data.domain[g].name){setGlobals("adtag_header",e.data.domain[g].adtag_widgetheader);setGlobals("adtag_footer",e.data.domain[g].adtag_widgetfooter)}}}else{logError("add Request","Ajax Failure")}}});b.send()}}function send_servicesChanged(e){var a=[];a=e.split(",");var b=false;var g=false;var f=false;for(var d=0;d<a.length;d++){if(a[d]=="email"){b=true}else{if(a[d]=="aim"){g=true}else{if(a[d]=="sms"){f=true}}}}if(b==false||g==false||f==false){var h=[];$each(glo_default_swArray,function(j,k){if(j=="aim"&&g==false){}else{if(j=="sms"&&f==false){}else{h.push(j)}}});glo_default_swArray=h;if(b==false){glo_top_services="facebook,twitter,sharebox"}createSwList()}return"services_changed"}function tab_servicesChanged(){var a=false;var d=false;var e=false;for(var b=0;b<glo_tabArray.length;b++){if(glo_tabArray[b]=="email"){a=true}}if(a==false){var f=[];$each(glo_default_swArray,function(g,h){if(g=="aim"&&e==false){}else{if(g=="sms"&&d==false){}else{f.push(g)}}});glo_default_swArray=f;glo_top_services="facebook,twitter,sharebox";createSwList()}return"services_changed"}function FragmentPump(){var a="";this.initialize=function(){FragmentPump.fragTimer=setInterval("fragmentPump.checkFragment()",5)};this.startint=function(){setInterval(this.checkFragment.bind(this),250)};this.checkFragment=function(){var j=document.location.hash.substring(1);if(j.length>0&&j!==glo_oldQS){var d=j.split("/");glo_oldQS=j;var h=d.shift();h="fragmentPump."+h;var b="";for(var f=0;f<d.length;f++){b=b+'"'+d[f]+'"';if(f<(d.length-1)){b=b+","}}var e=h+"("+b+")";var g=new Function(e);g()}};this.init=function(){if(glo_initRun===false){glo_initRun=true;for(var d=0;d<arguments.length;d++){var b=d+1;if(arguments[d]!=""&&arguments[d]!=" "){addToOptionsBuffer(arguments[d])}}glo_pageOptions=true;if(domReady===true){processBuffer()}glo_initRun=true}};this.test=function(){readyTest()};this.data=function(){for(var b=0;b<arguments.length;b++){addToOptions2(arguments[b])}};this.show=function(){gaLog("Widget","widget_open");if(glo_initRun==false){return false}for(var b=0;b<arguments.length;b++){addToOptions(arguments[b])}};this.popup=function(){clearInterval(fragmentPump.fragTimer);clearInterval(FragmentPump.fragTimer);glo_options_popup=true;displayNum=24;for(var d=0;d<arguments.length;d++){var b=d+1;addToOptionsBuffer(arguments[d])}if(domReady===true){processBuffer()}glo_initRun=true};this.widget=function(){if(arguments.length){var b=arguments[0].split("=");for(var d=0;d<b.length;d+=2){switch(b[d]){case"screen":widget.showPage(b[d+1]);$("header_ad").empty();$("footer_ad_body").empty();break}}}};this.initialize()}var fragmentPump=new FragmentPump();function addToOptions2(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}if(d[0]=="pageHost"){setGlobals("hostname",d[1])}else{if(d[0]=="pagePath"){setGlobals("location",d[1])}}tstArray.push(new fragObj(d[0],d[1]));if(d[1]=="done"){if(glo_initRun===false){document.location.hash=glo_initFrag}glo_jsonStr=glo_jsonArray.join("");glo_jsonArray=[];glo_title_array=[];glo_type_array=[];glo_summary_array=[];glo_content_array=[];glo_url_array=[];glo_icon_array=[];glo_category_array=[];glo_updated_array=[];glo_published_array=[];glo_author_array=[];glo_thumb_array=[];try{}catch(e){}processFrag()}else{if(d[0]=="jsonData"){glo_jsonArray.push(d[1])}}}function forgetUser(){setGlobals("loggedIn",false);$("boxToYourAddr").removeClass("hidden");setGlobals("auth","");setGlobals("userName","");setGlobals("userEmail","");setGlobals("facebook","");setGlobals("aim","");setGlobals("contProto",[]);setGlobals("contName",[]);setGlobals("contAdd",[]);setGlobals("contResNum",0);emptyInputs();widget.deleteCookie("ShareUT");glo_contProto=[];glo_contName=[];glo_contAdd=[];glo_contRes=[];glo_contResNum=0}function emptyInputs(){$$("input[type=text]").set("value","");$$("input[type=password]").set("value","");$$("input[type=password]").set("value","");$$("textarea").set("value","");$("post_select_container").set("html","")}function gaLog(b,e,a,d){if(typeof(pageTracker)!="undefined"){pageTracker._trackEvent(b,e,a,d)}}function cleanURL(e){var d=window.location.hash;var b=new RegExp("STS=","i");var a=d.match(b);if(a!=null){var f=e.split("#");return f[0]}else{return e}}function logSW(b){var e="";if(glo_toolbar!=false){e="toolbar"}else{if(glo_page!="home"&&glo_page!=""){e="chicklet"}else{e="button"}}var d="http://l.sharethis.com/log?event=click&source="+e+"&publisher="+encodeURIComponent(glo_publisher)+"&hostname="+encodeURIComponent(glo_hostname)+"&location="+encodeURIComponent(glo_location)+"&destinations="+b+"&ts"+(new Date()).getTime()+"&title="+glo_title+"&url="+cleanURL(glo_url)+"&sessionID="+glo_sessionID+"&fpc="+glo_fpc+"&sharURL="+glo_sharURL;var a=new Image(1,1);a.src=d;a.onload=function(){return};if(glo_tracking=="google"&&glo_googleProfileId!=""){url="/ShareThis/social/"+b+"/"+glo_title;if(googlePubTracker!=""){googlePubTracker._trackPageview(url)}}if(glo_tracking=="omniture"&&glo_omnitureURL!=""){url=glo_omnitureURL+"?sms_st=social&sms_ss="+b+"&sms_sa="+encodeURIComponent(glo_title);tracker=new Element("iframe").set("src",url).set("style","position:absolute;top:0;left:0;width:0;height:0;visibility:hidden").inject($("container"),"after")}glo_destinationType="Social";sendDestination(b)}function postYahooUpdate(d,b){if(widget.user.thirdparty_token!=""&&widget.user.yahoo_feed!=""){var a=new Request({method:"post",url:"/api/postYahooUpdate.php",asynch:true,data:{yahoo_token:widget.user.thirdparty_token,title:d,link:b,description:"Shared using ShareThis","return":"JSON"},onFailure:function(){logError("post yahoo update","Ajax Failure")},onSuccess:(function(g,h){try{var e=JSON.decode(g)}catch(f){logError("post yahoo update",g)}if(e.status){switch(e.status){case"SUCCESS":break;case"FAILURE":logError("post yahoo update",e);default:break}}else{logError("poost yahoo update",JSON.encode(e))}}).bind(this)});a.send()}}function logEvent(a,e){var g="";if(glo_toolbar!=false){g="toolbar"}else{if(glo_page!="home"&&glo_page!=""){g="chicklet"}else{g="button"}}var f="http://l.sharethis.com/log?event="+e;f+="&source="+g;f+="&publisher="+encodeURIComponent(glo_publisher);f+="&hostname="+encodeURIComponent(glo_hostname);f+="&location="+encodeURIComponent(glo_location);f+="&destinations="+a;f+="&ts"+(new Date()).getTime();f+="&title="+encodeURIComponent(glo_title);f+="&url="+encodeURIComponent(cleanURL(glo_url));f+="&sessionID="+glo_sessionID;f+="&fpc="+glo_fpc;f+="&sharURL="+encodeURIComponent(glo_sharURL);var d=new Image(1,1);d.src=f;d.onload=function(){return};if(glo_tracking=="google"&&glo_googleProfileId!=""){destinations=a.split(",");for(var b=0;b<destinations.length;b++){url="/ShareThis/"+e+"/"+destinations[b]+"/"+glo_title;if(googlePubTracker!=""){googlePubTracker._trackPageview(url)}}}if(glo_tracking=="omniture"&&glo_omnitureURL!=""){destinations=a.split(",");for(var b=0;b<destinations.length;b++){url=glo_omnitureURL+"?sms_st="+e+"&sms_ss="+destinations[b]+"&sms_sa="+encodeURIComponent(glo_title);tracker=new Element("iframe").set("src",url).set("style","position:absolute;top:0;left:0;width:0;height:0;visibility:hidden").inject($("container"),"after")}}if(e=="post"){glo_destinationType="Post";sendDestination(a)}}function genTopServices(){var a=new Element("div",{id:"top_services"});var b=glo_top_services.split(",");$each(b,function(e){var d=widget.getServiceLink(e);d.addClass("top_service");d.inject(a)});a.replaces($("top_services"))}function createSwList(){genTopServices();var e=[];var a=glo_default_services;var d=glo_default_swArray;var f=widget.user.getShareServiceHistory().map(function(h){return h.service});var g=glo_swArray;if(!f.length&&!g.length){setGlobals("services",a)}var b=true;$each(d,function(h,j){var l=widget.getServiceLink(d[j]);var m=g.indexOf(d[j]);var k=f.indexOf(d[j]);e.push({getContent:function(){return l},hasPublisherPref:(m>-1),hasUserPref:(b?(k>-1):false),stIndex:j,publisherIndex:m,userIndex:k,tag:d[j]})});widget.carousel.setDataSource(e);if(glo_pageOptions==true){setTimeout("widget.fireEvent('linkForegroundColorChanged', glo_linkfg)",10)}}function popupOpen(a){var f="";var e=a.getElementsByTagName("a");for(var d=0;d<e.length;d++){var b=e[d];f=b.href}window.open(f,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1");return false}function popupOpen2(a){var d=a.href;try{window.open(d,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1")}catch(b){}return false}function getObjects(){var a=new Request({method:"post",url:"/api/getCache_ws.php",data:"key="+glo_guid+"&return=json",onFailure:function(){logError("getObjects","Ajax Failure")},onSuccess:getObjects_onSuccess});a.send()}function getObjects_onSuccess(e,g){try{var a=JSON.decode(e)}catch(b){logError("getObjects",e)}if(a.status=="SUCCESS"){var f=Url.decode(a.data);var d=JSON.decode(f);for(i=0;i<d.length;i++){setGlobals("glo_title_array",d[i].title);setGlobals("glo_type_array",d[i].type);setGlobals("glo_summary_array",d[i].summary);setGlobals("glo_content_array",d[i].content);setGlobals("glo_url_array",d[i].url);setGlobals("glo_icon_array",d[i].icon);setGlobals("glo_category_array",d[i].category);setGlobals("glo_updated_array",d[i].updated);setGlobals("glo_published_array",d[i].published);setGlobals("glo_author_array",d[i].author);setGlobals("glo_thumb_array",d[i].icon);if(d[i].tags){setGlobals("glo_tags_array",d[i].tags)}if(d[i].description){setGlobals("glo_description_array",d[i].description)}}setValues();if(glo_page=="post|twitter"){createSharURL(glo_url,true);widget.fireEvent("twitterClicked",getSharURL())}}else{logError("getObjects","Ajax Failure")}}function processFrag(){if(glo_browser.test("ff")==false){try{glo_jsonStr=decodeURIComponent(glo_jsonStr)}catch(err){}}var tmp=glo_jsonStr;var newResp=[];try{newResp=eval(tmp)}catch(err){tmp=decodeURIComponent(tmp);newResp=eval(tmp)}for(var i=0;i<newResp.length;i++){setGlobals("glo_title_array",newResp[i].title);setGlobals("glo_type_array",newResp[i].type);setGlobals("glo_summary_array",newResp[i].summary);setGlobals("glo_content_array",newResp[i].content);setGlobals("glo_url_array",newResp[i].url);setGlobals("glo_icon_array",newResp[i].icon);setGlobals("glo_category_array",newResp[i].category);setGlobals("glo_updated_array",newResp[i].updated);setGlobals("glo_published_array",newResp[i].published);setGlobals("glo_author_array",newResp[i].author);setGlobals("glo_thumb_array",newResp[i].icon);if(newResp[i].tags){setGlobals("glo_tags_array",newResp[i].tags)}if(newResp[i].description){setGlobals("glo_description_array",newResp[i].description)}}setValues()}var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){return this._utf8_decode(unescape(a))},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};function setValues(){if(glo_guid_index!==null&&glo_url_array.length>0){setGlobals("url",glo_url_array[glo_guid_index]);setGlobals("title",glo_title_array[glo_guid_index]);setGlobals("type",glo_type_array[glo_guid_index]);setGlobals("summary",glo_summary_array[glo_guid_index]);setGlobals("content",glo_content_array[glo_guid_index]);setGlobals("icon",glo_icon_array[glo_guid_index]);setGlobals("category",glo_category_array[glo_guid_index]);setGlobals("updated",glo_updated_array[glo_guid_index]);setGlobals("published",glo_published_array[glo_guid_index]);setGlobals("author",glo_author_array[glo_guid_index]);setGlobals("glo_tags",glo_tags_array[glo_guid_index]);setGlobals("glo_thumb",glo_thumb_array[glo_guid_index]);setGlobals("glo_description",glo_description_array[glo_guid_index]);createSwList();widget.fireEvent("shareableValuesUpdated");if(glo_ads==true){var a=(new Date()).getTime();if(glo_adtag_header!=""){$("header_ad").set("html",glo_adtag_header.replace(/\[timestamp\]/g,a))}if(glo_adtag_footer!=""){$("footer_ad_body").set("html",glo_adtag_footer.replace(/\[timestamp\]/g,a))}}}}function searchName(b){var e=[];var f=new RegExp("^"+b);for(var d=0;d<widget.user.contacts.length&&e.length<widget.maxContactSearchResults;d++){var a=widget.user.contacts[d].name.toLowerCase();if(f.test(a)){e.push(d)}}return e}function searchName2(b){var e=[];var f=new RegExp("^ "+b);for(var d=0;d<widget.user.contacts.length&&e.length<widget.maxContactSearchResults;d++){var a=widget.user.contacts[d].name.toLowerCase();if(f.test(a)){e.push(d)}}return e}function searchName3(e){var h=[];if(e.search(/ /)>=0){var d="";var a="";var b=e.toLowerCase();b=b.split(" ");if(b.length>1){d=b[0];a=b[1]}var j=new RegExp("^"+d);var f=new RegExp(" "+a,"gi");for(var g=0;g<widget.user.contacts.length&&h.length<widget.maxContactSearchResults;g++){b=widget.user.contacts[g].name.toLowerCase();if(j.test(b)&&f.test(b)){h.push(g)}}}return h}function searchName4(d){var f=[];var b="";var a="";d=d.toLowerCase();for(var e=0;e<widget.user.contacts.length&&f.length<widget.maxContactSearchResults;e++){tmp_name=widget.user.contacts[e].name.toLowerCase();var g=new RegExp(" "+d,"gi");if(g.test(tmp_name)){f.push(e)}}return f}function searchName5(e){var h=[];var d="";var a="";var b=e.toLowerCase();if(b.length>1){d=b[0];a=b.substring(1)}var j=new RegExp("^"+d);var f=new RegExp(" "+a,"gi");for(var g=0;g<widget.user.contacts.length&&h.length<widget.maxContactSearchResults;g++){b=widget.user.contacts[g].name.toLowerCase();if(j.test(b)&&f.test(b)){h.push(g)}}return h}function searchAdd(e){var j=false;if(e>=0){var d="\\+?1?"+e+"[0-9]*";var h=new RegExp(d);j=true}else{if(e[0]=="@"){var h=new RegExp(e,"gi")}else{var h=new RegExp("^"+e)}}var g=0;var f=[];for(var g=0;g<widget.user.contacts.length&&f.length<widget.maxContactSearchResults;g++){var b=widget.user.contacts[g].address.toLowerCase();if(h.test(b)){f.push(g)}}return f}function txtGreyBox(b,m){var h=glo_contProto[b];var a=glo_contName[b];var d=glo_contAdd[b];var j=glo_contAdd[b];var g="greyBox_"+b;var e="addBox_"+b;var k="paren_"+g;var l="";var f="";if(h==="EMAIL"){h="E-mail"}if(h==="AIM"){h="AIM"}if(h==="SMS"){h="SMS"}if(glo_greyBoxNum%2===0){l+='<div id="'+k+'" class="boxRecipientsItem even">'}else{l+='<div id="'+k+'" class="boxRecipientsItem odd">'}l+='<span class="txtRecipientsItemDisplay">'+a+"</span>";l+='			<span class="txtRecipientsItemUsing"> using '+h+"</span>";if(m===true&&glo_isLoggedIn===true){l+='	<div id="'+e+'" class="boxRecipientsItemAdd" onclick="showAddAnother(this);"/></div>'}l+='			<div id="'+g+'" class="boxRecipientsItemDelete" onclick="delGreyItem(this);"/></div>';l+="</div>";hideSuggest();return l}function delGreyItem(a){var e=document.getElementById("boxAddressList");var b=document.getElementById("paren_"+a.id);var f=a.id;f=f.replace(/greyBox_/,"");removeFromQueue(f);e.removeChild(b);if(glo_msgArray.length==0){$("boxAddressList").addClass("hidden")}}function hideSuggest(){$("boxToMessage").setStyle("z-index","10");$("boxToYourAddr").setStyle("z-index","10");$("txtTo").set("value","");glo_selected_item=0;$$(".activeItem").removeClass("activeItem")}function showSuggest(){$("boxToMessage").setStyle("z-index","1");$("boxToYourAddr").setStyle("z-index","1")}function hoverSelection(a){var b=a.id;$$(".activeItem").removeClass("activeItem");$(b).addClass("activeItem")}function addToSenders(a){var d=a.id;d=d.replace(/uniq_/,"");addToMsg(d);var b="";glo_greyBoxNum=$$("div[id^=paren_greyBox_]").length;b+=txtGreyBox(d);$("boxAddressList").set("html",$("boxAddressList").get("html")+b);$("boxAddressList").setStyle("display","block");hideSuggest();$("txtTo").value=""}function addToSenders2(b){addToMsg(b);var a="";glo_greyBoxNum=$$("div[id^=paren_greyBox_]").length;a+=txtGreyBox(b,true);$("boxAddressList").set("html",$("boxAddressList").get("html")+a);$("boxAddressList").setStyle("display","block");hideSuggest();$("txtTo").value=""}function clearMsgQueue(){glo_msgArray.empty()}function addToMsg(a){glo_msgArray.push(a)}function removeFromQueue(a){glo_msgArray.erase(a)}function processSendQueue(){var a=[];var b=[];glo_msgArray.each(function(d){if(d.service=="sms"){var e=d.address.replace(/[^\d]/g,"");if(e[0]!="1"){e="1"+e}d.address=e}a.push({type:d.service,name:d.name,address:d.address});b.push(d.service)});glo_destinations=b.join(",").toLowerCase();a=JSON.encode(a);createMessage(a)}function createMessage(b){glo_msgArray=[];var n=false;if(glo_isLoggedIn===false){var e=$("txtYourAddr").value;if(isEmail(e)){glo_userEmail=e}else{alert("Please enter your valid E-mail address");n=true}}if(!b.length){alert("Please enter a recipient");n=true}var j=glo_userEmail;var d=glo_title;try{d=decodeURIComponent(glo_title)}catch(f){}var l=d;if(glo_url==""||glo_url=="undefined"||glo_url==undefined){glo_url=glo_pUrl}if(l==""||l=="undefined"){l=decodeURIComponent(glo_url)}glo_type="";var k=$("txtMessage").value;var a=glo_publisher;glo_content=Url.decode(glo_content);glo_content=encodeURIComponent(glo_content);if(!glo_description||glo_description==undefined||glo_description=="undefined"){glo_description=""}if(!glo_summary||glo_summary==undefined||glo_summary=="undefined"){glo_summary=""}if(!glo_tags||glo_tags=="undefined"){glo_tags=""}var m=[];m[0]={type:glo_type,url:glo_url,sharURL:getSharURL(),title:glo_title,thumbnail:glo_thumb,embed:glo_content,description:glo_summary,tags:glo_tags};m=JSON.encode(m);var h="sender="+encodeURIComponent(j)+"&subject="+encodeURIComponent(l)+"&comment="+encodeURIComponent(k)+"&publisher="+a+"&objects="+encodeURIComponent(m)+"&recipients="+encodeURIComponent(b)+"&sessionID="+glo_sessionID+"&return=JSON";if(!n){var g=new Request({method:"post",url:"/api/createMessage_ws.php",data:h,onFailure:function(){logError("createMessage","Ajax Failure")},onSuccess:createMessage_onSuccess});g.send();widget.fireEvent("createMessageRequested");postYahooUpdate(glo_title,getSharURL())}}function createMessage_onSuccess(b,e){logEvent(glo_destinations,"share");try{var d=JSON.decode(b)}catch(a){logError("createMessage",b)}if(d.status==="SUCCESS"){emptyInputs();glo_msgArray=[];widget.fireEvent("createMessageSucceeded")}else{logError("createMessage",JSON.encode(d));widget.fireEvent("createMessageFailed",d.statusMessage)}}var glo_selected_item=0;function selectActive(d){$$(".activeItem").removeClass("activeItem");var b=document.getElementById(d);b.addClass("activeItem")}function determineType(e,d){if(e!==""){var a="";var g=0;var b=$("txtUsing").value;if(b==="ALL"){if(isEmail(e)){a="EMAIL"}else{if(isAIM(e)){a="AIM"}else{if(isPhone(e)){a="SMS"}}}}else{if(b==="SMS"){if(isPhone(e)){a="SMS"}else{if(!d){alert("Not a valid Phone Number")}a="";document.getElementById("txtTo").value=""}}else{if(b==="AIM"){if(isAIM(e)){a="AIM"}else{if(!d){alert("Not a valid AIM Screen Name")}a="";document.getElementById("txtTo").value=""}}else{if(b==="EMAIL"){if(isEmail(e)){a="EMAIL"}else{a="";if(!d){alert("Not a valid E-mail address")}}}}}}if(document.getElementById("txtTo").value!==""&&(a=="EMAIL"||a=="AIM"||a=="SMS")&&a!=="undefined"&&a!==undefined){setGlobals("contProto",a);setGlobals("contName",e);setGlobals("contAdd",e);var f=glo_contAdd.length-1;return f}else{return false}if(!d){document.getElementById("txtTo").focus()}}}function isEmail(a){if(a.match(/^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|coop|info|museum|name))$/)){return true}else{return false}}function isPhone(a){a=a.replace(/[^\d]/g,"");if(a.length===10||a.length===11){if(a.match(/^1?[2-9]\d{9}$/)){return true}else{return false}}else{return false}}function isAIM(a){if(a.match(/^[a-z][a-z0-9]{2,15}$/i)){return true}else{return false}}function register(){var e=$("registerEmailInput").value;var h=$("registerNameInput").value;var a=$("registerNickInput").value;var d=$("registerPasswordInput").value;var b=$("registerPassword2Input").value;var g="";if(e==""){g+="Please enter an E-mail address.<br/>"}if(!isEmail(e)){g+="Please enter a valid E-mail address.<br/>"}if(h==""){g+="Please enter your Name.<br/>"}if(!a.length){g+="Please enter a username.<br/>"}if(d==""){g+="Please enter a password.<br/>"}else{if(d.length<6){g+="Password must be at least 6 characters.<br/>"}}if(d!==b){g+="Please confirm that your passwords match.<br/>"}if(g.length){widget.validationFailed(g.replace(/<br\/>/gi,"\n"))}else{var j="email="+e+"&password="+d+"&name="+h+"&nickname="+a;var f=new Request({method:"post",url:"/api/createUser_ws.php",data:j,onFailure:function(){logError("register","Ajax Failure")},onSuccess:register_OnSuccess.bind(this)});widget.fireEvent("registerUserRequested");f.send()}}function register_OnSuccess(b,e){try{var d=JSON.decode(b)}catch(a){logError("register",b)}if(d.status==="SUCCESS"){widget.user.acquireAuth(d.data.token);$$(".working").addClass("hidden");$$(".success").removeClass("hidden");$("registerSubmit").removeClass("hidden");widget.fireEvent("registerUserSucceeded",widget.user);emptyInputs()}else{if(d.errorMessage){widget.fireEvent("registerUserFailed",d.errorMessage)}else{if(d.statusMessage==="USER_ALREADY_EXISTS"){widget.fireEvent("registerUserFailed","E-mail address or Username is already in use.")}else{logError("register","Ajax Failure");widget.fireEvent("registerUserFailed","Could not complete registration.")}}}}function getDiggs(a){if(a!==""&&a!==" "&&a!==glo_last_url&&a!=="undefined"&&a!==undefined){var d="url="+a;var b=new Request({method:"post",url:"/api/getDiggs_ws.php",data:d,onFailure:function(){logError("get diggs","Ajax Failure")},onSuccess:getDiggs_onSuccess});glo_last_url=a;b.send()}}function getDiggs_onSuccess(d,f){try{var e=JSON.decode(d)}catch(b){logError("get diggs",d)}glo_num_diggs=widget.nDiggs=e.data.diggs;glo_digg_comments=widget.nDiggComments=e.data.comments;var a=$("post_digg_link");a.set("title",widget.nDiggs+" Diggs, "+widget.nDiggComments+" Comments");a.set("text","Digg ("+widget.nDiggs+")")}function addHashTracking(d){if(glo_hash_flag&&(!d.match("#")&&glo_sessionID!=null)){var a=glo_sessionID.split(".");var b=parseFloat(a[0]).toString(36)+"."+parseFloat(a[1]).toString(36);return d+"#STS="+b+"&shr=1"}else{return d}}function createSharURL(a,d){if(a!==""&&a!==" "&&a!==glo_last_url2&&a!==undefined&&a!=="undefined"){var e="url="+encodeURIComponent(addHashTracking(a))+"&sessionID="+glo_sessionID+"&fpc="+glo_fpc;var b=new Request({method:"post",url:"/api/createSharURL_ws.php",data:e,onFailure:function(){logError("createSharURL","Ajax Failure")},onSuccess:createSharURL_onSuccess});if(d){b.options.async=false}glo_last_url2=a;b.send()}}function createSharURL_onSuccess(d,f){try{var e=JSON.decode(d);var a=e.data.sharURL}catch(b){logError("createSharURL",d);var a=glo_url}glo_sharURL=a;widget.fireEvent("sharURLAcquired")}function getSharURL(){if(!glo_sharURL||glo_sharURL==undefined||glo_sharURL=="undefined"){return glo_url}else{return glo_sharURL}}function HexToR(a){return parseInt((cutHex(a)).substring(0,2),16)}function HexToG(a){return parseInt((cutHex(a)).substring(2,4),16)}function HexToB(a){return parseInt((cutHex(a)).substring(4,6),16)}function cutHex(a){return(a.charAt(0)==="#")?a.substring(1,7):a}function luminescence(e){var f={};if(e.length===7){f=[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]}else{if(e.length===4){f=[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]}}var k=f[0],j=f[1],d=f[2];var h=Math.min(k,Math.min(j,d));var a=Math.max(k,Math.max(j,d));return(h+a)/2}var closetimeout;function suggestAutoClose(){closetimeout=setTimeout("hideSuggest()",750)}function suggestCancelClose(){if(closetimeout){clearTimeout(closetimeout)}}function sendDestination(f){var h=glo_destinationAddress;glo_type="default";glo_content=Url.decode(glo_content);glo_content=encodeURIComponent(glo_content);if(glo_url==""||glo_url=="undefined"||glo_url==undefined){glo_url=glo_pUrl}if(!glo_description||glo_description==undefined||glo_description=="undefined"){glo_description=""}if(!glo_tags||glo_tags=="undefined"){glo_tags=""}var b=glo_title;try{b=decodeURIComponent(glo_title)}catch(d){}var l="";var j="";l=[{type:glo_type,url:glo_url,sharURL:getSharURL(),title:b,thumbnail:glo_thumb,embed:glo_content,description:glo_description,tags:glo_tags}];l=JSON.encode(l);j=[{type:f,address:h}];j=JSON.encode(j);var e="";if(glo_userEmail==""){e=""}else{e="&sender="+encodeURIComponent(glo_userEmail)}var g="publisher="+glo_publisher+"&objects="+encodeURIComponent(l)+"&destinations="+encodeURIComponent(j)+"&destinationType="+glo_destinationType+"&sessionID="+glo_sessionID+"&return=json"+e;var a="/api/createDestination_ws.php?"+g;var k=new Image(1,1);k.src=a;k.onload=function(){return};postYahooUpdate(b,getSharURL())}function populateSavedCredentials(a){if(typeof(glo_credentials)=="undefined"||glo_credentials.length<1){return}for(var b=0;b<=glo_credentials.length;b++){if(glo_credentials[b]&&glo_credentials[b].service==a){try{$("post_remember_me").checked=true;if(!$("post_url").hasClass("hidden")){widget.freezeTextInput($("post_url"));$("post_url").value=glo_credentials[b].url}widget.freezeTextInput($("post_username"));widget.freezeTextInput($("post_password"));$("post_username").value=glo_credentials[b].username;$("post_password").value=glo_credentials[b].password}catch(d){}}}}function logError(e,d){var b="http://l.sharethis.com/error?event="+e+"&publisher="+encodeURIComponent(glo_publisher)+"&ts"+(new Date()).getTime()+"&title="+encodeURIComponent(glo_title)+"&url="+encodeURIComponent(cleanURL(glo_url))+"&pUrl="+encodeURIComponent(glo_pUrl)+"&error="+encodeURIComponent(d)+"&sessionID="+glo_sessionID+"&fpc="+glo_fpc+"&sharURL="+glo_sharURL;var a=new Image(1,1);a.src=b;a.onload=function(){return}}Widget.Page=new Class({Implements:Events,id:"",pages:{},widget:null,domContainer:null,shown:false,firstShow:true,initialize:function(b,a){this.widget=b;if(a){for(var d in a){if(typeof a[d]!="function"){this[d]=a[d]}}}if(this.id.length){this.domContainer=$(this.id)}if(this.pages){this.pages=b.initializePages(this.pages)}},onShow:function(){this.shown=true;if(this.firstShow){this.firstShow=false}},onHide:function(){this.shown=false},isShown:function(){return this.shown},onReady:function(){},bindReturnKeyToSubmission:function(){this.domContainer.getElements("input[type=text], input[type=password]").each((function(a){a.addEvent("keyup",(function(b){if(b.key=="enter"&&!widget.showingAlert){this.submitForm()}}).bind(this))}).bind(this))},post_bindReturnKeyToSubmission:function(a){$("post_template").getElements("input[type=text], input[type=password]").each((function(b){b.removeEvents("keyup");b.addEvent("keyup",(function(d){if(d.key=="enter"&&!widget.showingAlert){widget.pages.post.pages[a].submitForm()}}).bind(this))}).bind(this))},submitForm:function(){},bindHelpText:function(a,d){var b=a.getStyle("color");if(!a.get("value").length){a.set("value",d);a.setStyle("color","#888")}a.addEvent("blur",(function(){if(!this.get("value").length){this.set("value",d);this.setStyle("color","#888")}}).bind(a));a.addEvent("focus",(function(){if(this.get("value")==d){this.set("value","");this.setStyle("color",b)}}).bind(a))}});Widget.implement({pages:{home:{id:"home_page",twitterMenuOpen:false,showTwitterMenu:function(){$("twitter_menu").removeClass("hidden");this.twitterMenuOpen=true;var a=null;a=(function(b){if(b.target!=$("twitter_direct_message")&&b.target!=$("twitter_update_status")&&b.target!=$("post_twitter_link")){this.hideTwitterMenu();this.domContainer.removeEvent("click",a);this.domContainer.getElement(".carousel").getElements("a").each(function(d){d.removeEvent("click",a)})}}).bind(this);this.domContainer.addEvent("click",a);this.domContainer.getElement(".carousel").getElements("a").each(function(b){b.addEvent("click",a)})},hideTwitterMenu:function(){$("twitter_menu").addClass("hidden");this.twitterMenuOpen=false},onShow:function(){this.parent()},onHide:function(){this.parent();this.hideTwitterMenu()},onReady:function(){$("twitter_update_status").addEvent("click",function(a){widget.showPage("post|twitter");a.stop()});widget.user.addEvent("infoChanged",(function(){createSwList()}).bind(this));widget.carousel=this.carousel=new Widget.Carousel(this.domContainer.getElement(".carousel"),(!glo_tabArray.contains("email")?Widget.Carousel.initialState_more:Widget.Carousel.initialState_less));this.parent()}},sharebox:{id:"sharebox_page",onReady:function(){$("sharebox_submit").addEvent("click",function(a){gaLog("Sharebox","save_click",$("sharebox_tags").get("value"));widget.saveToShareBox($("sharebox_tags").get("value"));a.stop()});if(glo_tags_array&&glo_tags_array.length){$("sharebox_tags").set("value",glo_tags_array.join(","))}widget.addEvent("shareableURLChanged",(function(a){if(a==""){a=glo_url}var b=widget.extractDomainFromURL(a);$("sharebox_previewUrl").set("text",b);if(a.length){$("sharebox_previewThumb").removeClass("hidden");$("sharebox_previewThumb").set("src",glo_thumbImageTag)}else{$("sharebox_previewThumb").addClass("hidden")}$("sharebox_preview").removeClass("hidden")}).bind(this));widget.addEvent("shareableTitleChanged",(function(b){try{b=decodeURIComponent(b)}catch(a){}$("sharebox_previewTitle").set("text",b)}).bind(this));widget.addEvent("shareableDescriptionChanged",(function(a){$("sharebox_previewDescription").set("text",a)}).bind(this));this.parent();widget.addEvent("saveToShareBoxSucceeded",function(){widget.showPage("done");$("done_message").set("text","This item was successfully saved to your ShareBox.")});widget.addEvent("saveToShareBoxFailed",function(){widget.pushModalErrorSheet("Could not save to your ShareBox.")})},onShow:function(){if(this.firstShow){this.bindHelpText($("sharebox_tags"),"Separated by commas")}widget.user.addEvent("signedOut",this.runAway.bind(this));this.parent()},onHide:function(){widget.user.removeEvent("signedOut",this.runAway.bind(this))},runAway:function(){if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}}},register:{id:"register_page",onShow:function(){this.parent()},onReady:function(){$("registerSubmit").addEvent("click",(function(){this.submitForm()}).bind(this));widget.addEvent("registerUserRequested",function(){widget.pushModalWorkingSheet("Creating your account&hellip;")});widget.addEvent("registerUserSucceeded",function(){widget.popModalWorkingSheet();setTimeout(function(){if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}},10)});widget.addEvent("registerUserFailed",function(a){widget.popModalWorkingSheet();widget.pushModalErrorSheet(a)});this.bindReturnKeyToSubmission();this.parent()},submitForm:function(){register()}},send:{id:"send_page",toField:null,_resizeShortcutsOnShow:false,buildShortcutList:function(b){$("recent_recipients").getChildren().each(function(a){if(a.nodeName.toLowerCase()!="h4"){a.destroy()}});for(var f=0;f<3&&f<b.length;f++){var g=new Element("span",{"class":"shortcut"});var d=new Element("a",{href:"#",title:b[f].address+" ("+b[f].service+")"});d.set("html",b[f].name);d.addEvent("click",(function(){gaLog("Send","recents_click",f+1,f+1);var a=b[f];return(function(j){var h=widget.user.searchContactsExact(a.service.toLowerCase(),a.address);if(h){h.select()}else{var e=widget.user.addContactsLocally([a]);setTimeout(function(){e[0].select()},1)}widget.showPage("send");j.stop()})})());$("recent_recipients").grab(g.grab(d))}if(this.isShown()){this.resizeShortcuts()}else{if(b.length){this._resizeShortcutsOnShow=true}else{$("recent_recipients").addClass("hidden")}}},hideShortcutList:function(){$("recent_recipients").getChildren().each(function(a){if(a.nodeName.toLowerCase()!="h4"){a.destroy()}});$("recent_recipients").addClass("hidden")},resizeShortcuts:function(){$("recent_recipients").removeClass("hidden");$("recent_recipients").getChildren().getLast().addClass("last");var b=[];var a=0;$("recent_recipients").getChildren().each(function(g){var e=g.getElement("a");var f=g.getSize().x;if(e){b.push({anchor:e,width:f})}a+=f});while(a>295){b.sort(function(f,e){return e.width-f.width});var d=b[0].anchor.get("html");b[0].anchor.set("html",d.substring(0,d.length-3)+"&hellip;");b[0].width=b[0].anchor.getSize().x;a=0;$("recent_recipients").getChildren().each(function(e){a+=e.getSize().x})}},updateCharacterCounter:function(){var a=widget.maxSendMessageLength;if(this.hasTwitterRecipients()){a=140;$("boxToYourAddrInfo").style.display="block"}else{if(this.hasAIMRecipients()){$("boxToYourAddrInfo").style.display="block"}}$("spanMessageCounter").set("html",a-$("txtMessage").value.length)},hasTwitterRecipients:function(){var b=false;var a=widget.user.getSelectedContacts();a.each(function(d){if((d.service&&d.service.toLowerCase()=="twitter")||(d.type&&d.type.toLowerCase()=="twitter")){b=true}});return b},hasAIMRecipients:function(){var b=false;var a=widget.user.getSelectedContacts();a.each(function(d){if((d.service&&d.service.toLowerCase()=="aim")||(d.type&&d.type.toLowerCase()=="aim")){b=true}});return b},onShow:function(){if(this.firstShow){this.bindHelpText($("txtYourAddr"),"Your Email Address")}this.updateCharacterCounter();$("privacyLink").removeClass("hidden");this.parent();this.toField.onPageShown();if(this._resizeShortcutsOnShow){this.resizeShortcuts();this._resizeShortcutsOnShow=false}},onHide:function(){this.parent();$("privacyLink").addClass("hidden");widget.user.contactServiceFilters=[];this.toField.onPageHidden()},onReady:function(){this.toField=new Widget.ToField(widget,$("send_to_field"));$("previewCloseLink").addEvent("click",function(a){gaLog("Send","preview_close_click");$("preview").addClass("hidden");$("linkPreview").removeClass("hidden");$("previewCloseLink").addClass("hidden");a.stop()});$("linkPreview").addEvent("click",function(a){gaLog("Send","preview_open_click");$("preview").removeClass("hidden");$("previewThumb").set("html","<img width='100' src='"+glo_thumbImageTag+"'/>");$("linkPreview").addClass("hidden");$("previewCloseLink").removeClass("hidden");a.stop()});$("btnShareSend").addEvent("click",(function(){gaLog("Send","send_btn_click");var a=widget.user.getSelectedContacts();if($("contact_search_field")){if($("contact_search_field").value.length>0){widget.pages.send.toField._selectHighlightedResult();widget.pages.send.toField.hideSearchResults()}}if(a.length<1){alert("Please enter a recipient in the 'To' field ")}else{if(a.length<25){a.each(function(b){addToMsg(b)});processSendQueue()}else{alert("Please enter less than 25 recipients")}}}).bind(this));$("txtMessage").addEvent("keypress",(function(f){f=new Event(f);var d=true;var b=$("txtMessage");var a=widget.maxSendMessageLength;if(glo_sharURL&&this.hasTwitterRecipients()){a=140}var e=$("spanMessageCounter");d=widget.limitCharacters(b,a,e,f);return d}).bind(this));$("txtMessage").addEvent("keyup",(function(){this.updateCharacterCounter()}).bind(this));widget.user.addEvent("signedIn",function(){$("from_box").addClass("hidden")});widget.user.addEvent("signedOut",function(){$("from_box").removeClass("hidden")});widget.addEvent("createMessageRequested",(function(){widget.pushModalWorkingSheet()}).bind(this));widget.addEvent("createMessageSucceeded",(function(){widget.popModalWorkingSheet();widget.showPage("done");widget.user.getUserAccountInfo()}).bind(this));widget.addEvent("createMessageFailed",(function(){widget.popModalWorkingSheet();widget.pushModalErrorSheet("Could not send your message.")}).bind(this));widget.user.addEvent("recipientHistoryChanged",(function(a){widget.deferWhile("recipientHistoryIsChanging",(function(){if(widget.user.isSignedIn()&&glo_tabArray.contains("email")){this.buildShortcutList(a.recipients)}}).bind(this))}).bind(this));widget.user.addEvent("signedOut",(function(){this.hideShortcutList()}).bind(this));this.parent()}},"import":{id:"import_page",nImportsOnShow:0,onReady:function(){$("import_list").getElements("li").each(function(b,a){b.getElement("a").addEvents({click:function(d){widget.setImportContactService(b.getChildren()[0].get("class"));d.stop()}})});$("import_contacts_submit").addEvent("click",(function(d){gaLog("Import","import_btn_click",widget.currentImportContactService.protocolName);Cookie.dispose("import",{domain:".sharethis.com",path:"/"});Cookie.dispose("import_delt",{domain:".sharethis.com",path:"/"});var a=widget.currentImportContactService;if(a.protocolName=="aol"||a.protocolName=="yahoo"||a.protocolName=="gmail"){var e=$("import_contacts_username").get("value");var b=$("import_contacts_password").get("value");this.submitForm()}else{widget.pushModalWorkingSheet("Waiting for Authorization&hellip;");window.open("/share3x/import.php?provider="+a.protocolName,"import_contacts","scrollbars=yes,directories=no,menubar=yes,toolbar=yes,height=600,width=900");this.pollImportCookie()}d.stop()}).bind(this));widget.addEvent("importContactsRequested",function(){widget.pushModalWorkingSheet("Importing contacts&hellip;")});widget.addEvent("importContactsSucceeded",function(a){widget.popModalWorkingSheet();$("send_title").set("html","Email");widget.showPage("send");widget.displayNotification("Success! "+a.nContacts+" contacts imported.");emptyInputs()});widget.addEvent("importContactsFailed",function(){widget.popModalWorkingSheet();widget.pushModalErrorSheet("Could not retrieve your contacts.")});widget.addEvent("importContactServiceChanged",(function(d){if(this.isShown()){var a=widget.contactSources[d];$("regAuth").setStyle("display","none");$("oauthImport").setStyle("display","block");switch(d){case"gmail":$("regAuth").setStyle("display","block");$("oauthImport").setStyle("display","none");break;case"yahoo":$("regAuth").setStyle("display","block");$("oauthImport").setStyle("display","none");break;case"myspace":$("oauthImport").getElement("label").set("text","We'll take you to Myspace where you'll be asked to let ShareThis access your friend list.");break;case"msn":$("oauthImport").getElement("label").set("text","We'll take you to MSN/Hotmail where you'll be asked to let ShareThis access your address book.");break;case"aol":$("regAuth").setStyle("display","block");$("oauthImport").setStyle("display","none");break}var b=this.domContainer.getElement(".mbox");b.getElementById("h4").set("html",a.title);b.getElementById("h4").set("class",d);var e=null;$("import_list").getElements("li").each(function(f){if(f.getElement("a").hasClass(d)){e=f}});if(e){this.pointImportPointerAt(e)}}}).bind(this));this.bindReturnKeyToSubmission();this.parent()},pollImportCookie:function(){import_cookie_tid=setInterval('import_cookie = Cookie.read("import");if(import_cookie == -1) { clearInterval(import_cookie_tid);widget.popModalWorkingSheet();widget.pushModalErrorSheet("Contact Import Failed.");import_cookie_cycles = 0;Cookie.dispose("import", {domain: ".sharethis.com", path: "/"});Cookie.dispose("import_delt", {domain: ".sharethis.com", path: "/"});} else if(import_cookie) { clearInterval(import_cookie_tid);import_cookie_cycles = 0;contact_url = import_cookie;delt = Cookie.read("import_delt");Cookie.dispose("import", {domain: ".sharethis.com", path: "/"});Cookie.dispose("import_delt", {domain: ".sharethis.com", path: "/"});widget.importContacts( widget.currentImportContactService, "", "", escape(contact_url), delt );} else if(import_cookie_cycles++ > 120) { clearInterval(import_cookie_tid);widget.popModalWorkingSheet();widget.pushModalErrorSheet("Authorization Timed Out.");import_cookie_cycles = 0;}',1000)},submitForm:function(){var a=widget.currentImportContactService;var d=$("import_contacts_username").get("value");var b=$("import_contacts_password").get("value");widget.importContacts(widget.currentImportContactService,d,b,"","")},onShow:function(){this.nImportsOnShow=widget.user.contacts.length;if(this.firstShow){setTimeout(function(){widget.setImportContactService("gmail")},1)}$("privacyLink_import").removeClass("hidden");this.parent()},onHide:function(){$("privacyLink_import").addClass("hidden");this.parent()},pointImportPointerAt:function(a){var e=a.getPosition(a.getParent()).y;var d=$$(".mboxpoint")[0];var b=$$(".mbox")[0];d.set("tween",{duration:0});d.tween("top",e+(a.getSize().y/2)-(d.getSize().y/2)+5);$("import_list").getElements("li").each(function(f){if(f!==a){f.removeClass("selected")}else{f.addClass("selected")}})}},login:{id:"login_page",onReady:function(){$("login_list").getElements("li").each(function(b,a){b.getElement("a").addEvents({click:function(d){widget.setLoginService(b.getChildren()[0].get("class"));d.stop()}})});$("login_submit").addEvent("click",(function(a){widget.pages.login.processLogin()}).bind(this));widget.addEvent("loginRequested",function(){});widget.addEvent("loginSucceeded",function(a){});widget.addEvent("loginFailed",function(){widget.popModalWorkingSheet();widget.pushModalErrorSheet("Unable to Sign In")});widget.addEvent("loginServiceChanged",(function(d){var b=widget.loginSources[d];$("loginAuth").setStyle("display","none");$("oauthLogin").setStyle("display","block");$("login_service_box").setStyle("display","none");$("createAccount").setStyle("display","none");switch(d){case"gmail":$("loginAuth").setStyle("display","block");$("oauthLogin").setStyle("display","none");break;case"yahoo":$("login_service_box").setStyle("display","block");$("oauthLogin").getElement("label").set("text","We'll take you to Yahoo where you'll be asked to link your Yahoo account to ShareThis.");$("login_with").set("text","Sign In with Yahoo");break;case"myspace":$("oauthLogin").getElement("label").set("text","We'll take you to Myspace where you'll be asked to let ShareThis access your friend list.");break;case"msn":$("oauthLogin").getElement("label").set("text","We'll take you to MSN/Hotmail where you'll be asked to let ShareThis access your address book.");break;case"aol":$("loginAuth").setStyle("display","block");$("oauthLogin").setStyle("display","none");break;case"sharethis":$("login_with").set("text","Sign In with ShareThis");$("loginAuth").setStyle("display","block");$("oauthLogin").setStyle("display","none");$("createAccount").setStyle("display","block");break}var a=this.domContainer.getElement(".mbox2");var e=null;$("login_list").getElements("li").each(function(f){if(f.getElement("a").hasClass(d)){e=f}});if(e){this.pointImportPointerAt(e)}}).bind(this));this.bindReturnKeyToSubmission();this.parent()},processLogin:function(){gaLog("Login","login_btn_click",widget.currentLoginService.protocolName);Cookie.dispose("signin",{domain:".sharethis.com",path:"/"});var a=widget.currentLoginService;if(a.protocolName=="sharethis"){var e=$("login_username").get("value");var b=$("login_password").get("value");this.submitForm()}else{var d=$("input_service_checkbox").checked?1:"";widget.pushModalWorkingSheet("Waiting for Authorization&hellip;");window.open("/auth.php?provider="+a.protocolName+"&yahoo_feed="+d,"3rd_party_signin","scrollbars=yes,directories=no,menubar=yes,toolbar=yes,height=500,width=700");this.pollSigninCookie()}return true},pollSigninCookie:function(){signin_cookie_tid=setInterval('signin_cookie = Cookie.read("signin");if(signin_cookie == -1) { clearInterval(signin_cookie_tid);widget.popModalWorkingSheet();widget.pushModalErrorSheet("Signin Failed.");signin_cookie_cycles = 0;Cookie.dispose("signin", {domain: ".sharethis.com", path: "/"});} else if(signin_cookie) { clearInterval(signin_cookie_tid);signin_cookie_cycles = 0;widget.user.acquireAuth(signin_cookie);Cookie.dispose("signin", {domain: ".sharethis.com", path: "/"});} else if(signin_cookie_cycles++ > 120) { clearInterval(signin_cookie_tid);widget.popModalWorkingSheet();widget.pushModalErrorSheet("Authorization Timed Out.");signin_cookie_cycles = 0;}',1000)},submitForm:function(){var a=widget.currentLoginService;var d=$("login_username").get("value");var b=$("login_password").get("value");widget.login(widget.currentLoginService,d,b,"","")},onShow:function(){if(this.firstShow){}$("privacyLink_login").removeClass("hidden");$("footerReg").addClass("hidden");this.parent()},onHide:function(){$("privacyLink_login").addClass("hidden");$("footerReg").removeClass("hidden");this.parent()},pointImportPointerAt:function(b){var e=b.getPosition(b.getParent()).y;var d=$$(".mboxpoint2")[0];var a=$$(".mbox2")[0];d.set("tween",{duration:0});d.tween("top",e+(b.getSize().y/2)-(d.getSize().y/2)+5);$("login_list").getElements("li").each(function(f){if(f!==b){f.removeClass("selected")}else{f.addClass("selected")}})}},done:{id:"done_page",onReady:function(){$("doneScreenOk").addEvent("click",function(a){widget.user.deselectContacts();clearMsgQueue();if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}a.stop()});this.parent()},onHide:function(){$("done_message").set("text","Your message was successfully shared!")}},post:{id:"post_page",onShow:function(){$("privacyLink").removeClass("hidden")},onHide:function(){$("privacyLink").addClass("hidden");this.parent()},onReady:function(){widget.addEvent("postToServiceRequested",function(a){widget.pushModalWorkingSheet('<span class="'+a+'">Posting your share to '+widget.services[a].title+"</span>")});widget.addEvent("postToServiceSucceeded",function(a){logEvent(a,"post");widget.popModalWorkingSheet();widget.showPage("done")});widget.addEvent("postToServiceFailed",function(b,a){widget.popModalWorkingSheet();widget.pushModalErrorSheet(a)});this.parent()},pages:{blogger:{id:"post_template",desc:"Post this to your blog.",onReady:function(){this.parent()},onShow:function(){widget.addEvent("postToServiceNeedsMoreInfo",function(e,f,g){var h=[];var d=[];var a="";for(var b=0;b<g.blogs.length;b++){h.push(g.blogs[b].blogname);d.push(g.blogs[b].blogid)}a='<select id="post_select">';for(b=0;b<h.length;b++){a+='<option value="'+d[b]+'">'+h[b]+"</option>"}a+="</select>";this.freezeTextInput($("post_username"));this.freezeTextInput($("post_password"));$("post_publish_btn").removeClass("hidden");$("post_draft_btn").addClass("hidden");$("post_submit_btn").addClass("hidden");$("post_select_container").set("html",a);$("post_select_box").removeClass("hidden");widget.popModalWorkingSheet();widget.displayNotification(f)});$("post_draft_btn").addEvent("click",function(){gaLog("Post","draft_btn_click","blogger");setGlobals("glo_bloggerDraft",0);widget.postBlogger()});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","blogger");setGlobals("glo_bloggerDraft",1);widget.postBlogger()});$("post_publish_btn").addEvent("click",function(){gaLog("Post","submit_btn_click","blogger");widget.postBlogger()});this.post_bindReturnKeyToSubmission("blogger")},submitForm:function(){setGlobals("glo_bloggerDraft",1);widget.postBlogger()}},livejournal:{id:"post_template",desc:"Post this to Livejournal.",onReady:function(){},onShow:function(){$("post_message").value="optional";$("post_message").addEvent("focus",function(){if($("post_message").value==="optional"){$("post_message").value=""}});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","livejournal");widget.postLive_journal()});this.post_bindReturnKeyToSubmission("livejournal");this.parent()},submitForm:function(){widget.postLive_journal()}},twitter:{id:"post_template",desc:"Post this to your Twitter status.",statusMessage:null,onReady:function(){widget.addEvent("twitterClicked",(function(){var d=glo_title;try{d=decodeURIComponent(glo_title)}catch(b){}this.statusMessage=d+" - "+getSharURL();var a=0;while(this.statusMessage.length>140){this.statusMessage=glo_title.substr(0,glo_title.length-a++)+"... "+getSharURL()}$("post_message").value=this.statusMessage;this.updateCharacterCounter()}).bind(this));this.parent()},onShow:function(){$("post_message").addEvent("keypress",(function(f){f=new Event(f);var d=true;var b=$("post_message");var a=140;var e=$("post_character_counter");if("enter"===f.key&&status.length<=140){widget.postTwitter()}else{d=widget.limitCharacters(b,a,e,f)}return d}).bind(this));$("post_message").addEvent("keyup",(function(){this.statusMessage=$("post_message").value;this.updateCharacterCounter()}).bind(this));$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","twitter");widget.postTwitter()});this.post_bindReturnKeyToSubmission("twitter");$("post_message").value=this.statusMessage;this.updateCharacterCounter()},updateCharacterCounter:function(){$("post_character_counter").set("html",140-$("post_message").value.length)},submitForm:function(){widget.postTwitter()}},typepad:{id:"post_template",desc:"Post this to your Typepad blog.",onReady:function(){this.parent()},onShow:function(){widget.addEvent("postToServiceNeedsMoreInfo",function(e,f,g){if(e=="typepad"){var h=[];var d=[];var a="";for(var b=0;b<g.blogs.length;b++){h.push(g.blogs[b].blogName);d.push(g.blogs[b].blogid)}a="<select id='post_select'>";for(b=0;b<h.length;b++){a+='<option value="'+d[b]+'">'+h[b]+"</option>"}a+="</select>";this.freezeTextInput($("post_username"));this.freezeTextInput($("post_password"));$("post_publish_btn").removeClass("hidden");$("post_draft_btn").addClass("hidden");$("post_submit_btn").addClass("hidden");$("post_select_container").set("html",a);$("post_select_box").removeClass("hidden");widget.popModalWorkingSheet();widget.displayNotification(f)}});$("post_draft_btn").addEvent("click",function(){gaLog("Post","draft_btn_click","typepad");setGlobals("glo_tpDraft",0);widget.postTypePad()});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","typepad");setGlobals("glo_tpDraft",1);widget.postTypePad()});$("post_publish_btn").addEvent("click",function(){gaLog("Post","submit_btn_click","typepad");widget.postTypePad()});this.post_bindReturnKeyToSubmission("typepad")},submitForm:function(){setGlobals("glo_tpDraft",0);widget.postTypePad()}},wordpress:{id:"post_template",desc:"Post this to your WordPress blog.",onReady:function(){this.parent()},onShow:function(){$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","wordpress");widget.postWordpress()});this.post_bindReturnKeyToSubmission("wordpress")},submitForm:function(){widget.postWordpress()}}}}},pageHistory:[],_currentPage:null,showSharebox:function(){},showPage:function(f,e,b){if(f==null){return}if(!e&&f!=this.pageHistory.getLast()){this.pageHistory.push(f)}f=(typeof f=="string"?f.split("|"):f);e=(e?e:widget);var d=f.shift();if(d=="null"){return}if(b){this.fireEvent("pageShown",e.pages[d])}else{for(var a in e.pages){if(a==d){$(e.pages[a].id).removeClass("hidden");this.fireEvent("pageShown",e.pages[a]);this._currentPage=e.pages[a]}else{if(!$(e.pages[a].id).hasClass("hidden")){$(e.pages[a].id).addClass("hidden");this.fireEvent("pageHidden",e.pages[a])}}}}if(f.length){if(d=="post"){this.initPost(f[0]);this.showPage(f,e.pages[d],true)}else{this.showPage(f,e.pages[d],false)}}},initPost:function(d){glo_post_page=d;$("post_url").set("value","");$("post_username").set("value","");$("post_password").set("value","");$("post_message").set("value","");$("post_remember_me").checked=false;$("post_forget_me").checked=false;this.unfreezeTextInput($("post_url"));this.unfreezeTextInput($("post_username"));this.unfreezeTextInput($("post_password"));$("post_url").disabled=false;$("post_username").disabled=false;$("post_password").disabled=false;$("post_message").removeEvents("focus");$("post_message").removeEvents("keypress");$("post_message").removeEvents("keyup");widget.removeEvents("postToServiceNeedsMoreInfo");if(document.getElementById("post_select")){$("post_select_container").empty()}var b=new Array("post_url_box","post_message_box","post_character_counter_div","post_select_box","post_draft_btn","post_submit_btn","post_publish_btn");b.each(function(e){if(!$(e).hasClass("hidden")){$(e).addClass("hidden")}});var a=new Array("post_submit_btn","post_draft_btn","post_submit_btn");a.each(function(e){$(e).removeEvents("click")});$("post_title").set("html",widget.services[d].title);$("post_title").set("class",d);$("post_desc").set("html",widget.pages.post.pages[d].desc);switch(d){case"twitter":$("post_message_label").set("html","Message:");$("post_character_counter_div").removeClass("hidden");$("post_message_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"livejournal":$("post_message_label").set("html","Comment:");$("post_message_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"blogger":$("post_draft_btn").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"wordpress":$("post_url_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"typepad":$("post_draft_btn").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break}populateSavedCredentials(d)},showPreviousPage:function(){if(this.pageHistory.length>1){this.pageHistory.pop();this.showPage(this.pageHistory.getLast())}},hideOverlays:function(){$$(".overlay").addClass("hidden")},initializePages:function(e){var b={};for(var a in e){var d=new Class($extend({Extends:Widget.Page},e[a]));b[a]=new d(this);this.addEvent("pageShown",(function(f){return function(g){if(g==f){g.onShow()}}})(b[a]),true);this.addEvent("pageHidden",(function(f){return function(g){if(g==f){g.onHide()}}})(b[a]),true)}return b},readyPages:function(b){for(var a in b){b[a].onReady();if("pages" in b[a]){this.readyPages(b[a].pages)}}},getCurrentPage:function(){return this._currentPage},getCurrentTopLevelPage:function(){for(var a in widget.pages){if(widget.pages[a].isShown()){return widget.pages[a]}}return null},_lastFocus:null,captureLastFocus:function(a){this._lastFocus=a},getCurrentFocus:function(){return this._lastFocus},_modalCovers:[],_workingCovers:[],displayNotification:function(d){var a=widget.getCurrentTopLevelPage().domContainer;var b=new Element("div",{"class":"notification_sheet collapsed"});b.grab(new Element("div",{style:"font-weight:bold; text-align:center; margin:5px auto; width:337x"}).set("html",d));a.grab(b);setTimeout(function(){b.get("tween").addEvent("complete",function(){b.destroy()});b.set("tween",{duration:"normal"});b.tween("height","0px");setTimeout(function(){b.destroy()},1000)},2500);b.set("tween",{duration:"short"});b.tween("height","30px")},pushModalSheet:function(l,g,h){var d=$("container");var k=new Element("div",{"class":"modal_sheet faded_out"});var b=new Element("div",{"class":"smoke"});var e=new Element("div",{"class":"modal_message_container"});var j=d.getSize().y-(2*parseInt(d.getStyle("border-width")));k.grab(b);k.setStyles("height",j);b.setStyle("height",j);e.grab(new Element("div",{"class":g}).set("html",l));e.grab(new Element("div",{"class":"button_new",html:"<span>OK</span>"}).addEvent("click",function(m){widget.popModalSheet();if(typeof h=="function"){h()}m.stop()}));e.setStyles({height:j,top:"40px"});d.grab(k.grab(e));k.set("tween",{duration:"short"});var a=this.getCurrentFocus();if(a){a.blur()}var f=function(m){if(m.key=="enter"||m.key=="esc"){widget.popModalSheet()}};k.get("tween").addEvent("complete",function(){document.addEvent("keyup",f)});this._modalCovers.push({latentFocus:a,cover:k,keyHandler:f});k.fade("hide").fade("in")},popModalSheet:function(){if(this._modalCovers.length){var a=this._modalCovers.pop();document.removeEvent("keyup",a.keyHandler);a.cover.destroy();if(a.latentFocus){a.latentFocus.focus()}}},pushModalErrorSheet:function(a,b){this.pushModalSheet(a,"error",b)},pushModalNotificationSheet:function(b,a){this.pushModalSheet(b,"notification",a)},popModalNotificationSheet:function(){this.popModalSheet()},popModalErrorSheet:function(){this.popModalSheet()},pushModalWorkingSheet:function(g){var d=$("container");var e=new Element("div",{"class":"modal_sheet faded_out"});var f=new Element("div",{"class":"smoke"});var b=new Element("div",{"class":"spinner_container"});var a=d.getSize().y-(2*parseInt(d.getStyle("border-width")));e.grab(f);e.setStyles("height",a);f.setStyle("height",a);b.grab(new Element("div",{"class":"working_text"}).set("html",g));b.grab(new Element("div",{"class":"loading32"}));b.setStyles({height:a});d.grab(e.grab(b));e.set("tween",{duration:"short"});e.fade("hide").fade("in");this._workingCovers.push(e)},popModalWorkingSheet:function(){if(this._workingCovers.length){this._workingCovers.pop().destroy()}}});Widget.implement({services:{aim:{title:"AIM",submitUrl:"http://connect.aim.com/share/?url={url}&title={title}",destination:"aim.com"},sms:{title:"Text",onClick:function(a){$("send_title").set("html","Text");widget.showPage("send");a.stop()},type:"sms"},email:{title:"Email",onClick:function(a){$("send_title").set("html","Email");widget.showPage("send");a.stop()},type:"email"},sharebox:{title:"Save",onClick:function(b){if(widget.userIsSignedIn()){widget.fireEvent("shareableURLChanged",glo_thumb);widget.showPage("sharebox")}else{widget.showPage("register");widget.displayNotification("You must register to save items to a ShareBox.");var a=leftPage=null;a=function(){widget.fireEvent("shareableURLChanged",glo_thumb);widget.showPage("sharebox");widget.removeEvent("signInComplete",a);widget.removeEvent("pageHidden",leftPage)};leftPage=function(d){widget.removeEvent("signInComplete",a);widget.removeEvent("pageHidden",leftPage)};widget.addEvent("signInComplete",a);widget.addEvent("pageHidden",leftPage)}b.stop()},type:"sharebox"},bebo:{title:"Bebo",submitUrl:"http://www.bebo.com/c/share?Url={url}&Title={title}",destination:"bebo.com"},blinklist:{title:"Blinklist",submitUrl:"http://blinklist.com/index.php?Action=Blink/addblink.php&Url={url}&Title={title}",destination:"blinklist.com"},blogmarks:{title:"Blogmarks",submitUrl:"http://blogmarks.net/my/new.php?mini=1&url={url}&title={title}",destination:"blogmarks.net"},blogger:{title:"Blogger",onClick:function(a){widget.showPage("post|blogger");a.stop()},type:"post"},bus_exchange:{title:"Add to BX",submitUrl:"http://bx.businessweek.com/api/add-article-to-bx.tn?url={url}",destination:"bx.businessweek.com",aTitle:"Business Exchange"},care2:{title:"Care2",submitUrl:"http://www.care2.com/news/compose?share[link_url]={url}&share[title]={title}",destination:"care2.com"},current:{title:"Current",submitUrl:"http://current.com/clipper.htm?url={url}&title={title}&src=st",destination:"current.com"},dealsplus:{title:"Dealspl.us",submitUrl:"http://dealspl.us/add.php?ibm=1&url={url}",destination:"dealspl.us"},delicious:{title:"Delicious",submitUrl:"http://del.icio.us/post?url={url}&title={title}",destination:"del.icio.us"},digg:{title:"Digg",submitUrl:"http://digg.com/submit?phase=2&url={url}&title={title}",destination:"digg.com"},diigo:{title:"Diigo",submitUrl:"http://secure.diigo.com/post?url={url}&title={title}",destination:"secure.diigo.com"},facebook:{title:"Facebook",submitUrl:"http://www.facebook.com/share.php?u={url}&t={title}",destination:"facebook.com"},fark:{title:"Fark",submitUrl:"http://cgi.fark.com/cgi/farkit.pl?u={url}&h={title}",destination:"cgi.fark.com"},faves:{title:"Faves",submitUrl:"http://www.faves.com/Authoring.aspx?u={url}&t={title}",destination:"faves.com"},fresqui:{title:"Fresqui",submitUrl:"http://fresqui.com/enviar?url={url}&title={title}",destination:"ocio.fresqui.com"},friendfeed:{title:"FriendFeed",submitUrl:"http://friendfeed.com/share?url={url}&title={title}",destination:"friendfeed.com"},funp:{title:"Funp",submitUrl:"http://funp.com/pages/submit/add.php?title={title}&url={url}&via=tools",destination:"funp.com"},google_bmarks:{title:"G Bookmarks",submitUrl:"http://www.google.com/bookmarks/mark?op=edit&bkmk={url}&title={title}",destination:"google.com"},hi5:{title:"Hi5",onClick:function(a){widget.showPage("post|hi5");a.stop()},type:"post"},kirtsy:{title:"Kirtsy",submitUrl:"http://www.kirtsy.com/submit.php?url={url}",destination:"kirtsy.com"},linkedin:{title:"LinkedIn",submitUrl:"http://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&summary=&source=",destination:"linkedin.com"},livejournal:{title:"LiveJournal",onClick:function(a){widget.showPage("post|livejournal");a.stop()},type:"post"},meneame:{title:"Meneame",submitUrl:"http://meneame.net/submit.php?url={url}",destination:"meneame.net"},mister_wong:{title:"Mr Wong",submitUrl:"http://www.mister-wong.com/index.php?action=addurl&bm_url={url}&bm_description={title}",destination:"mister-wong.com"},mixx:{title:"Mixx",submitUrl:"http://www.mixx.com/submit?page_url={url}",destination:"mixx.com"},myspace:{title:"MySpace",submitUrl:"http://www.myspace.com/Modules/PostTo/Pages/?l=3&u={url}&t={title}&c={content}%3Cp%3EPowered+by+%3Ca+href%3D%22http%3A%2F%2Fsharethis.com%22%3EShareThis%3C%2Fa%3E%3C%2Fp%3E",destination:"myspace.com"},n4g:{title:"N4G",submitUrl:"http://www.n4g.com/tips.aspx?url={url}&title={title}",destination:"ng4.com"},newsvine:{title:"Newsvine",submitUrl:"http://www.newsvine.com/_tools/seed&save?popoff=0&u={url}&h={title}",destination:"newsvine.com"},oknotizie:{title:"Oknotizie",submitUrl:"http://oknotizie.alice.it/post?url={url}&title={title}",destination:"oknotizie.alice.it"},propeller:{title:"Propeller",submitUrl:"http://www.propeller.com/submit/?U={url}&T={title}",destination:"propeller.com"},reddit:{title:"Reddit",submitUrl:"http://reddit.com/submit?url={url}&title={title}",destination:"reddit.com"},slashdot:{title:"Slashdot",submitUrl:"http://slashdot.org/bookmark.pl?url={url}&title={title}",destination:"slashdot.org"},simpy:{title:"Simpy",submitUrl:"http://www.simpy.com/simpy/LinkAdd.do?href={url}&title={title}",destination:"simpy.com"},sphinn:{title:"Sphinn",submitUrl:"http://sphinn.com/index.php?c=post&m=submit&link={url}",destination:"sphinn.com"},stumbleupon:{title:"Stumbleupon",submitUrl:"http://www.stumbleupon.com/submit?url={url}&title={title}",destination:"stumbleupon.com"},technorati:{title:"Technorati",submitUrl:"http://www.technorati.com/faves?add={url}",destination:"technorati.com",dontUseEncodedURL:"Encoded URLs are not allowed"},twackle:{title:"Twackle",submitUrl:"http://www.twackle.com/chicklet?site={url}",destination:"twackle.com"},twine:{title:"Twine",submitUrl:"http://www.twine.com/bookmark/basic?u={url}",destination:"twine.com"},twitter:{title:"Twitter",onClick:function(a){page=widget.pages.home;createSharURL(glo_url,true);widget.fireEvent("twitterClicked",glo_url);widget.showPage("post|twitter");a.stop()},type:"post",useSharURL:"Shar URLs are allowed"},typepad:{title:"TypePad",onClick:function(a){widget.showPage("post|typepad");a.stop()},type:"post"},windows_live:{title:"Live",submitUrl:"https://favorites.live.com/quickadd.aspx?marklet=1&mkt=en-us&url={url}&title={title}&top=1",destination:"favorites.live.com"},wordpress:{title:"WordPress",onClick:function(a){widget.showPage("post|wordpress");a.stop()},type:"post"},xanga:{title:"Xanga",submitUrl:"http://www.xanga.com/private/editorx.aspx?t={title}&u={url}&s={content}",destination:"xanga.com"},yahoo_bmarks:{title:"Y! Bookmarks",submitUrl:"http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u={url}&t={title}",destination:"bookmarks.yahoo.com"},ybuzz:{title:"Buzz Up!",submitUrl:"http://buzz.yahoo.com/buzz?targetUrl={url}&headline={title}&src=sharethis",destination:"buzz.yahoo.com"},yigg:{title:"Yigg",submitUrl:"http://www.yigg.de/neu?exturl={url}&exttitle={title}",destination:"yigg.de"}},contactSources:{aim:{title:"AIM",protocolName:"aim"},aol:{title:"AOL",protocolName:"aol"},gmail:{title:"GMail",protocolName:"gmail"},hotmail:{title:"Hotmail",protocolName:"hotmail"},msn:{title:"MSN",protocolName:"hotmail"},twitter:{title:"Twitter",protocolName:"twitter"},yahoo:{title:"Yahoo!",protocolName:"yahoo"},facebook:{title:"Facebook",protocolName:"facebook"}},loginSources:{aim:{title:"AIM",protocolName:"aim"},aol:{title:"AOL",protocolName:"aol"},gmail:{title:"GMail",protocolName:"gmail"},hotmail:{title:"Hotmail",protocolName:"hotmail"},msn:{title:"MSN",protocolName:"hotmail"},twitter:{title:"Twitter",protocolName:"twitter"},yahoo:{title:"Yahoo!",protocolName:"yahoo"},facebook:{title:"Facebook",protocolName:"facebook"},sharethis:{title:"ShareThis",protocolName:"sharethis"}}});Widget.implement({getServiceType:function(a){if("type" in this.services[a]){return this.services[a].type}return"web"},getServiceLink:function(e){var b=this.services[e];if(!b){return}var f="javascript:void(0)";var g="";if(b.aTitle){g=b.aTitle}if("submitUrl" in b&&b.submitUrl.length){var h=b.useSharURL?getSharURL():addHashTracking(glo_url);if(b.dontUseEncodedURL){f=b.submitUrl.replace("{title}",glo_title).replace("{url}",h).replace("{content}",glo_content)}else{f=b.submitUrl.replace("{title}",encodeURIComponent(glo_title)).replace("{url}",encodeURIComponent(h)).replace("{content}",glo_content)}}var d=new Element("a",{"class":e,rel:"external",style:"color:"+glo_linkfg+";",target:(glo_options_popup?"_top":("linkTarget" in b?b.linkTarget:"_blank")),href:f,title:g,id:"post_"+e+"_link"});d.addEvent("click",(function(a){gaLog("Home","chicklet_click",e);if("destination" in b){logSW(b.destination);if(widget.user){widget.user.logServiceUse(e)}}if("onClick" in b){b.onClick.bind(b)(a,f)}else{widget.showPage("done")}if(f!="javascript:void(0)"){if(glo_options_popup==true){popupOpen2(this);a.stop()}}}).bind(d));d.appendText(b.title);return d},getDummyServiceLink:function(){var b=new Element("a",{href:"javascript:void(0);"});return b.appendText(" ")}});Widget.Contact=new Class({Implements:Events,service:"",name:"",address:"",id:"",selected:false,added:false,widget:null,inventName:false,_isAContact:true,toString:function(){var a="";if(widget.user.contactSortMode=="name"){a=this["service"]}else{if(widget.user.contactSortMode=="service"){a=this["name"]}}return(this[widget.user.contactSortMode]+" - "+a).toLowerCase()},initialize:function(b,a){this.widget=b;for(var d in a){if(a[d]){this[d]=a[d]}}},select:function(){this.selected=true;this.fireEvent("selected",true)},deselect:function(){this.selected=false;this.fireEvent("selected",false)},toggleSelect:function(){if(this.selected==false){this.select()}else{if(this.selected==true){this.deselect()}}},setName:function(a){this.name=a;this.fireEvent("nameChanged",this.name)},setAddress:function(a){this.address=a;this.fireEvent("addressChanged",this.address)},setService:function(a){this.service=a;this.fireEvent("serviceChanged",this.service)},isEqualTo:function(a){if(a.address&&a.service){return a.address.toLowerCase()==this.address.toLowerCase()&&a.service==this.service}return false}});Widget.Contact.guessServiceForAddress=function(a,b){if(b){switch(b){case"gmail":return"email";break;case"aim":return"aim";break;case"myspace":return"myspace";break;case"aol":return"email";break;case"msn":return"email";break;case"yahoo":return"email";break;case"hotmail":return"email";break;break}}if(!a.test(/[^\d\-\(\)]/)){return"sms"}else{if(a.indexOf("@")>=0){return"email"}}return null};Widget.Contact.generateNameFromAddress=function(a){if(a.indexOf("@")!=-1){return a.substr(0,a.indexOf("@"))}else{if(a.test(/[^\d\-\(\)]/)){return a}}return""};Widget.Carousel=new Class({Implements:Events,initialize:function(d,b){if($type(d)=="element"){this.domContainer=$(d)}else{if($type(d)=="string"){this.domContainer=$(d)}}var a=this;$("fwd_arrow").addEvent("click",function(e){gaLog("Home","carousel_fwd_arrow","Carousel Forward Arrow");if(a.getNumPages()>1){a.advance()}e.stop()});$("back_arrow").addEvent("click",function(e){gaLog("Home","carousel_back_arrow","Carousel Backward Arrow");if(a.getNumPages()>1){a.rewind()}e.stop()})},autoSize:function(){if(this.totalDummies>6){this.nRows=2;this.createPaginator();this.domContainer.getElement(".view").setStyle("height","44px")}},setDataSource:function(a){this.data=a;this.page=0;this.paginatorExists=false;this.data.sort(function(e,d){if(e.hasUserPref&&d.hasUserPref){return e.userIndex-d.userIndex}if(e.hasUserPref){return -1}if(d.hasUserPref){return 1}if(e.hasPublisherPref&&d.hasPublisherPref){return e.publisherIndex-d.publisherIndex}if(e.hasPublisherPref){return -1}if(d.hasPublisherPref){return 1}return e.stIndex-d.stIndex});this.render()},setNumRows:function(a){this.nRows=a;this.render()},setNumColumns:function(a){this.nCols=a;this.render()},_buildPage:function(f){if(this.paginatorExists==false){this.createPaginator()}this.autoSize();this.highlightNum(f+1);f=this.getEffectivePageNum(f);var e=this.getVisibleData();var g=new Element("div",{"class":"group"});var d=(this.nRows*this.nCols);for(var b=(f*d);b<(f*d)+d;b++){if(b<e.length){var a=e[b].getContent();g.grab(a)}}return g},getNumPages:function(){var a=this.getVisibleData();return Math.ceil(a.length/(this.nRows*this.nCols))},getVisibleData:function(){if(this.isShowingMore){return this.data}else{var k=[];var g=(this.nRows*this.nCols);var f=(this.data.length&&(this.data[0].hasPublisherPref));var d=false;this.totalDummies=0;for(var e=0;e<this.data.length;e++){var a=(e>1)&&(this.data[e-1].hasPublisherPref);var h=this.data[e].hasPublisherPref||this.data[e].hasUserPref;if(!this.isShowingMore&&!d&&(e<g)&&f&&!h){var b=e;while(b<g){k.push({isDummy:function(){return true},getContent:function(){return widget.getDummyServiceLink()}});b++;this.totalDummies++}d=true}k.push(this.data[e])}return k}},getEffectivePageNum:function(b){var a=this.getVisibleData();var d=this.getNumPages();if(b<0){b=d+b}if(b>=d){b=b%d}return b},render:function(){if(this.paginatorExists==false){this.createPaginator()}this.fireEvent("renderBegin");var a=this.domContainer.getElement("div.view").getElement("div.groups");$each(a.getChildren(),function(b){b.dispose()});a.grab(this._buildPage(this.page));this.fireEvent("renderComplete")},createPaginator:function(){var a=this.getNumPages();var d=a*20+36;d+="px";$("paginator").setStyle("width",d);var f="";for(var e=0;e<a;e++){var b=e+1;f+="<div class=\"circles\" onclick=\"gaLog('Home', 'carousel_paging_dot', 'Carousel Paging Dot'); widget.carousel.goToPage("+b+');" title="Go To Page # '+b+'"></div> '}$("circle_container").set("html",f);this.highlightNum(this.page+1);this.paginatorExists=true},highlightNum:function(d){var g=this.getNumPages();if(d>g){d=1}if(d<1){d=4}var e=d-1;if($("paginator")){var b=$("circle_container").getChildren();b.removeClass("circles-selected");b.addClass("circles");b[e].addClass("circles-selected");b[e].removeClass("circles");var f="("+d+"/"+this.getNumPages()+")"}},goToPage:function(a){this.page=a-1;this.render();this.highlightNum(a)},advance:function(){if(this.rotating){return}this.rotating=true;this.fireEvent("advanceBegin");var b=this.domContainer.getElement("div.view").getElement("div.groups");var f=b.getElement("div.group");var e=this._buildPage(this.page+1);b.grab(e);var d=f.getSize().x;var a=this;b.get("tween").removeEvents("complete").addEvent("complete",function(){f.dispose();b.setStyle("left",0);a.page=a.getEffectivePageNum(a.page+1);a.fireEvent("advanceComplete");a.rotating=false});b.tween("left",-d)},rewind:function(){if(this.rotating){return}this.rotating=true;this.fireEvent("rewindBegin");var b=this.domContainer.getElement("div.view").getElement("div.groups");var e=b.getElement("div.group");var f=this._buildPage(this.page-1);var d=e.getSize().x;b.setStyle("left",-d);b.grab(f,"top");var a=this;b.get("tween").removeEvents("complete").addEvent("complete",function(){e.dispose();a.page=a.getEffectivePageNum(a.page-1);a.fireEvent("rewindComplete");a.rotating=false});b.tween("left",0)},domContainer:null,nRows:4,nCols:3,page:0,isShowingMore:false,data:[],rotating:false});Widget.Carousel.initialState_more=0;Widget.Carousel.initialState_less=1;Widget.User=new Class({Implements:Events,email:"",name:"",authToken:"",userID:"",thirdparty_token:"",shareHistory:{services:{},recipients:[]},contacts:[],contactsAD:[],contactsEH:[],contactsIL:[],contactsMP:[],contactsQT:[],contactsUZ:[],_selectedContacts:[],contactSortMode:"name",contactServiceFilters:[],widget:null,credentials:[],_deferringContactSelectionChangedTimer:-1,initialize:function(b){this.widget=b;var d=b.getCookie("ServiceHistory");if(d){d=JSON.decode(d);for(var a in d){this.setShareServiceHistory(d[a])}}},setShareServiceHistory:function(a){this.shareHistory.services[a.service]=a},getShareServiceHistory:function(){var b=[];for(var a in this.shareHistory.services){b.push($extend({},this.shareHistory.services[a]))}b.sort(function(e,d){return d.count-e.count});return b},clearShareServiceHistory:function(){this.shareHistory.services={}},addRecentRecipient:function(a){this.shareHistory.recipients.push(a);this.fireEvent("recipientHistoryChanged",{recipients:this.shareHistory.recipients})},getRecentRecipients:function(){return this.shareHistory.recipients},clearRecentRecipients:function(){this.shareHistory.recipients=[]},isSignedIn:function(){return this.authToken&&this.authToken.length},acquireAuth:function(a){if(this.authToken.length){this.signOut()}this.authToken=a;widget.setCookie("ShareUT",this.authToken);widget.setCookie("ServiceHistory",JSON.encode({}));setGlobals("auth",a);setGlobals("loggedIn",true);this.fireEvent("signedIn");this.getUserAccountInfo();this.getContactsOnAccount()},signIn:function(d,a){var b=new Request({method:"post",url:"/api/getAuth_ws.php",data:"username="+d+"&password="+a+"&return=json",onFailure:function(){logError("signin","Ajax Failure")},onSuccess:(function(g){try{var e=JSON.decode(g)}catch(f){logError("signin",g)}if(e.status==="SUCCESS"){this.acquireAuth(e.data.token)}else{if(e.statusMessage==="INVALID_USERNAME_OR_PASSWORD"){this.fireEvent("signInFailed","Email/Username or Password is incorrect. Please try again.")}else{if(e.statusMessage==="DATABASE_FAILED"){this.fireEvent("signInFailed","Unable to connect to ShareThis authentication server.");logError("signin","unable to connect to db")}else{this.fireEvent("signInFailed","Email/Username or Password is incorrect. Please try again.")}}}}).bind(this)});b.send();this.fireEvent("signInRequested")},signOut:function(){glo_credentials=[];this.contacts=[];this._selectedContacts=[];this.clearShareServiceHistory();this.clearRecentRecipients();this.contactSortMode="name";this.email="";this.name="";this.userID="";this.thirdparty_token="";this.fireEvent("contactsChanged");this.fireEvent("contactSelectionChanged");this.authToken="";this.fireEvent("signedOut")},getUserAccountInfo:function(){if(this.isSignedIn()){var a=new Request({method:"post",url:"/api/getUserInfo_ws.php",data:"token="+this.authToken+"&return=json",onFailure:function(){logError("get user info","Ajax Failure")},onSuccess:(function(e){try{var b=JSON.decode(e)}catch(d){logError("get user info",e)}if(b.status==="SUCCESS"){setGlobals("userName",b.data.name);setGlobals("userEmail",b.data.email);this.name=b.data.name;this.email=b.data.email;this.userID=b.data.userID;this.credentials=b.data.credentials;this.thirdparty_token=b.data.thirdparty_token;glo_credentials=this.credentials;if(b.data.socialShares){b.data.socialShares.each((function(f){if(f.name&&f.count){this.setShareServiceHistory({service:f.name.toLowerCase(),count:parseInt(f.count)})}}).bind(this))}if(b.data.recipients){b.data.recipients.each((function(f){this.addRecentRecipient(f)}).bind(this))}this.fireEvent("infoChanged",this)}else{logError("get user info",JSON.encode(b));setTimeout((function(){this.signOut()}).bind(this),1)}}).bind(this)});this.clearRecentRecipients();this.clearShareServiceHistory();a.send()}},getContactsOnAccount:function(){var a=new Request({method:"post",url:"/api/getContacts_ws.php",data:"token="+this.authToken+"&return=json",onFailure:function(){logError("get contacts","Ajax Failure")},onSuccess:(function(f,g){try{var d=JSON.decode(f)}catch(e){logError("get contacts",f)}if(d.status==="SUCCESS"&&d.data){var b=d.data;this.contacts=[];this._selectedContacts=[];this.addContactsLocally(b);this.fireEvent("getContactsSucceeded",b)}else{logError("get contacts",JSON.encode(d));this.fireEvent("getContactsFailed")}}).bind(this)});a.send();this.fireEvent("getContactsRequested")},addContactsToAccount:function(b){var d=encodeURIComponent(JSON.encode(b));var a=new Request({method:"post",url:"/api/addContacts_ws.php",data:"token="+this.authToken+"&contacts="+d+"&return=json",onFailure:function(){logError("add contacts","Ajax Failure")},onSuccess:(function(j){try{var e=JSON.decode(j)}catch(g){logError("add contacts",j)}if(e.status=="SUCCESS"){var h=null;h=(function(){this.fireEvent("addContactsToAccountSucceeded");this.removeEvent("getContactsSucceeded",h)}).bind(this);this.addEvent("getContactsSucceeded",h);this.getContactsOnAccount()}else{logError("add contacts",JSON.encode(e));this.fireEvent("addContactsToAccountFailed")}}).bind(this)});this.fireEvent("addContactToAccountRequested");a.send()},addContactsLocally:function(k){var l=[];for(var b=0;b<k.length;b++){var d=this.isSignedIn();var h=false;if(!d){for(var a=0;a<this.contacts.length;a++){if(this.contacts[a].isEqualTo(k[b])){h=true;break}}}if(!h||d){var f=null;if(k[b]._isAContact){f=k[b];var g=(new Date()).getTime();g+=Math.random();if(f.id==""){f.id=g}}else{var e=k[b];var g=(new Date()).getTime();g+=Math.random();f=new Widget.Contact(this,{service:e.service?e.service.toLowerCase():"email",name:e.name?e.name:"",address:e.address?e.address:"",id:e.id?e.id:g})}f.addEvent("selected",(function(j){return(function(m){if(m){this._selectedContacts.include(j)}else{this._selectedContacts.erase(j)}widget.deferWhile("contactSelectionIsChanging",(function(){this.fireEvent("contactSelectionChanged")}).bind(this))}).bind(this)}).bind(this)(f));this.contacts.push(f);l.push(f);setGlobals("contProto",k[b].service?k[b].service.toUpperCase():"email");setGlobals("contName",k[b].name);setGlobals("contAdd",k[b].address)}}this.fireEvent("contactsChanged");return l},setContactSortMode:function(a){this.contactSortMode=a},searchContacts:function(b){var e=[];if(!b.length){return e}var a=[searchName,searchName2,searchName3,searchAdd,searchName4,searchName5];if(typeof b=="number"){e.combine(searchAdd(b))}for(var d=0;d<a.length&&e.length<widget.maxContactSearchResults;d++){e.combine(a[d](b))}if(this.contactServiceFilters.length){e=e.filter((function(f){return this.contactServiceFilters.indexOf(this.contacts[f].service)>=0}).bind(this))}return e.map((function(f){return this.contacts[f]}).bind(this))},searchContactsExact:function(b,d){var a=this.contacts.length;for(var e=0;e<a;e++){if(this.contacts[e].service==b&&this.contacts[e].address==d){return this.contacts[e]}}return null},getSelectedContacts:function(){return this._selectedContacts},deselectContacts:function(){for(var a=0;a<this._selectedContacts.length;a++){this._selectedContacts[a].deselect()}},hasContactsOnService:function(b){for(var a=0;a<this.contacts.length;a++){if(this.contacts[a].service==b){return true}}return false},logServiceUse:function(a,b){b=(typeof b=="undefined")?1:b;if(this.shareHistory.services[a]){this.shareHistory.services[a].count+=b}else{this.shareHistory.services[a]={service:a,count:b}}widget.setCookie("ServiceHistory",JSON.encode(this.shareHistory.services))}});Widget.MirrorContact=new Class({Extends:Widget.Contact,added:false,respondToLiveUpdate:true,isMirror:true,select:function(){if(!this.added){this.respondToLiveUpdate=false;this.widget.user.addContactsLocally([this]);this.added=true}this.parent()},toString:function(){var a="";if(widget.user.contactSortMode=="name"){a=this["service"]}else{if(widget.user.contactSortMode=="service"){a=this["name"]}}return(this[widget.user.contactSortMode]+" - "+a).toLowerCase()}});Widget.ToField=new Class({Implements:Events,contacts:[],domContainer:null,inputElement:null,inputElementContainer:null,widget:null,highlightedResult:null,resultsElement:null,mirrorInputResultItem:null,mirrorContact:null,searchResults:[],searchText:"",selectedTokens:[],_windowKeyDownHandler:null,_mouseOverSearchResultsList:false,_searchResultsShown:false,initialize:function(b,a){this.widget=b;this.domContainer=a;b.user.addEvent("contactSelectionChanged",this._handleWidgetSelectionChanged.bind(this));b.user.addEvent("contactsChanged",this._handleWidgetContactsChanged.bind(this));a.addEvent("mousedown",this._handleMouseDown.bind(this));a.addEvent("mouseup",this._handleMouseUp.bind(this));this.addEvent("contactsChanged",this._render.bind(this),true);this.addEvent("searchTextChanged",this._handleSearchTextChanged.bind(this),true);this._getInputField();this._getMirrorContact();this._render()},getRecipients:function(){return $A(this.contacts)},showSearchResults:function(){var a=this._getSearchResultsList();a.tween("opacity",0.9);this._searchResultsShown=true},hideSearchResults:function(){var a=this._getSearchResultsList();this.highlightedResult=null;a.tween("opacity",0);this._searchResultsShown=false},setSearchText:function(a){this.searchText=a;this.fireEvent("searchTextChanged",this.searchText)},_handleSearchTextChanged:function(a){if(a.length){this._search(a)}else{this.hideSearchResults()}},_search:function(h){this.searchResults=widget.user.searchContacts(h);var f=this._getSearchResultsList();f.getChildren().each((function(j){this._disposeSearchResult(j)}).bind(this));this.searchResults=this.searchResults.filter(function(j){return !j.selected});if(this.searchResults.length==0){this.searchResults.unshift(this._getMirrorContact())}f.setStyle("height","auto");var b=$("send_to_field");var d=widget.getCurrentPage().domContainer;var a=b.getCoordinates(d).bottom+b.getScroll().y;var g=d.getSize().y-a-15;for(var e=0;e<this.searchResults.length;e++){f.grab(this._createSearchResult(this.searchResults[e]));if(f.getSize().y>g){f.setStyle("height",g+"px")}else{f.setStyle("height","auto")}}this.showSearchResults();this._highlightResult(0)},_getMirrorContact:function(){if(this.mirrorContact){return this.mirrorContact}var d=new Widget.MirrorContact(this.widget,{service:"email",name:"",address:"",id:""});this.mirrorContact=d;var b=function(e){if(d.respondToLiveUpdate){d.setAddress(e);d.setName(e);d.setService(Widget.Contact.guessServiceForAddress(e)||"email")}};var a=this;d.addEvent("selected",function(e){var g=arguments.callee;setTimeout(function(){d.removeEvent("selected",g)},1);a.removeEvent("searchTextChanged",b);a.mirrorContact=null});this.addEvent("searchTextChanged",b);return this.mirrorContact},_highlightResult:function(d,f,j){var e=this._getSearchResultsList();if(typeof d=="number"){f=this.searchResults[d]||this._getMirrorContact();d=e.getElements("li")[d]}if(this.highlightedResult){this.highlightedResult.removeClass("highlight")}this.highlightedResult=d;if(this.highlightedResult){this.highlightedResult.addClass("highlight");if(j==undefined||j==Widget.ToField.scrollBehavior_scroll){var b=this.highlightedResult.getPosition(e).y;var h=this.highlightedResult.getSize().y;var g=e.getScroll().y;var a=e.getSize().y;b+=(Browser.Engine.trident?g:0);if(b<g){e.scrollTo(0,b)}if(b+h>g+a){e.scrollTo(0,g+((b+h)-(g+a)))}}}},_getHighlightedResultIndex:function(){if(this.highlightedResult&&this.highlightedResult._stContact){for(var a=0;a<this.searchResults.length;a++){if(this.searchResults[a]==this.highlightedResult._stContact){return a}}}return -1},_highlightPrevResult:function(){var a=this._getHighlightedResultIndex();if(a>0){this._highlightResult(a-1)}},_highlightNextResult:function(){var a=this._getHighlightedResultIndex();if(a>=0&&a<this.searchResults.length-1){this._highlightResult(a+1)}},_disposeSearchResult:function(b){for(var a in b._stEventHandlers.self){b.removeEvent(a,b._stEventHandlers.self[a])}for(var a in b._stEventHandlers.contact){b._stContact.removeEvent(a,b._stEventHandlers.contact[a])}b.destroy()},_createSearchResult:function(b){var f=new Element("li",{"class":"search_result",id:"search_result_"+b.id});var e=new Element("div",{"class":(b.service.length?b.service:"email")});var d=new Element("div",{"class":"address"});d.set("text","<"+b.address+">");var a=(b.name.indexOf("@")==-1?b.name:b.name.substr(0,b.name.indexOf("@")));e.set("text",a);b.addEvent("addressChanged",function(g){d.set("text","<"+g+">")});b.addEvent("nameChanged",function(g){e.set("text",(g.length?g:""))});f._stEventHandlers={self:{mouseenter:(function(g){this._highlightResult(f,b,Widget.ToField.scrollBehavior_dontScroll)}).bind(this),mouseleave:(function(g){setTimeout((function(){if(this.highlightedResult==f){f.removeClass("highlight");this.highlightedResult=null}}).bind(this),100)}).bind(this),click:(function(g){b.select();this.hideSearchResults()}).bind(this)},contact:{serviceChanged:function(g){e.set("class",g)}}};f._stContact=b;f.grab(e).grab(d).addEvent("mouseenter",f._stEventHandlers.self.mouseenter).addEvent("mouseleave",f._stEventHandlers.self.mouseleave).addEvent("click",f._stEventHandlers.self.click);b.addEvent("serviceChanged",f._stEventHandlers.contact.serviceChanged);if(b.isMirror){f.addClass("mirror")}return f},_selectHighlightedResult:function(){if(this.highlightedResult&&this.highlightedResult._stContact){if(this.highlightedResult._stContact.address.length){this.highlightedResult._stContact.select();this.hideSearchResults()}}setTimeout((function(){this._insertInputField()}).bind(this),10)},_getSearchResultsList:function(){if(this.resultsElement){return this.resultsElement}this.resultsElement=new Element("ul",{id:"search_results","class":"search_results"});this.domContainer.getParent().grab(this.resultsElement,"bottom");this.resultsElement.set("tween",{duration:250});this.resultsElement.addEvent("mouseenter",(function(a){this._mouseOverSearchResultsList=true}).bind(this));return this.resultsElement},_getInputField:function(){if(this.inputElementContainer){return this.inputElementContainer}this.inputElementContainer=new Element("div",{id:"contact_search_field_container"});this.inputElement=new Element("input",{type:"text",id:"contact_search_field","class":"contact_search_field"});this.inputElement.addEvent("keydown",(function(a){switch(a.key){case"up":widget.pages.send.toField._highlightPrevResult();a.stop();break;case"down":widget.pages.send.toField._highlightNextResult();a.stop();break;case"enter":widget.pages.send.toField._selectHighlightedResult();a.stop();break;case"esc":this.hideSearchResults();a.stop();break}switch(a.code){case 188:widget.pages.send.toField._selectHighlightedResult();a.stop();break}}).bind(this));this.inputElement.addEvent("keyup",(function(a){var b=this.inputElement.get("value");if(this.searchText!=b){this.setSearchText(b)}}).bind(this));this.addEvent("searchTextChanged",(function(a){this.set("value",a)}).bind(this.inputElement));this.inputElement.addEvent("blur",(function(){if($("contact_search_field").value.length){widget.pages.send.toField._selectHighlightedResult();widget.pages.send.toField.hideSearchResults()}}),this);this.inputElement.addEvent("focus",(function(){if(widget.pages.send.toField.searchText.length){widget.pages.send.toField.showSearchResults()}}),this);this.inputElementContainer.grab(this.inputElement);return this.inputElement},_mouseInResultsListScrollBar:function(a){var b=this._getSearchResultsList().getCoordinates();return false;return(a.page.x>=b.left&&a.page.x<=b.right&&a.page.y>=b.top&&a.page.y<=b.bottom)},_deleteSelectedTokens:function(){for(var a=0;a<this.selectedTokens.length;a++){this.selectedTokens[a].contact.deselect()}this.selectedTokens.empty()},_handleMouseDown:function(a){if(a.target==this.domContainer){this._insertInputField();a.stop()}},_insertInputField:function(){var b=this._getInputField();this.domContainer.appendChild(b);this.domContainer.scrollTo(0,this.domContainer.getScrollSize().y);var a=widget.pages.send.toField.inputElement.id;setTimeout((function(){var e=$("contact_search_field_container").firstChild.id;var d=document.getElementById(e);if(e=="contact_search_field"&&d&&glo_browser.test("ie")==false){d.select()}}),500)},_handleMouseUp:function(a){},_handleWidgetContactsChanged:function(){this._handleWidgetSelectionChanged();this._render()},_handleWidgetSelectionChanged:function(){var b=widget.user.getSelectedContacts();this.contacts=[];for(var a=0;a<b.length;a++){this.contacts.push(b[a])}this.fireEvent("contactsChanged");this.setSearchText("");widget.pages.send.updateCharacterCounter()},_clearList:function(){this.domContainer.getChildren().each(function(a){if(a.hasClass("token")){a.destroy()}else{a.dispose()}})},_createToken:function(a,d){var b='<a class="token" href="javascript:void(0);" >';b+='<span title= "'+a.name+"<"+a.address+'>" class="'+(a.service.length?a.service:"email")+'">';b+='<img class="token_x" id="token_img" src="">'+widget.truncateText(a.name,130);b+="</span></span></a>";return b},_attachTokenBehavior:function(d,a){$extend(d,{contact:a,pageCoordinateIsOverX:function(e){var g=this.getSize().x-20;var f=this.getPosition().x;return(e-f>g)}});d.addEvent("click",(function(e){if(d.pageCoordinateIsOverX(e.page.x)&&d.contact){d.contact.deselect()}}).bind(this));var b=(function(e){if(d.pageCoordinateIsOverX(e.page.x)){}else{}}).bind(this);d.addEvent("mousemove",b);d.onselectstart=function(){return false};d.unselectable="on";d.style.MozUserSelect="none"},_getContentsHeight:function(){var b=0;var a=0;this.domContainer.getChildren().each(function(d){if(d.getPosition().y!=a){b+=d.getSize().y}a=d.getPosition().y});return b},_render:function(){this._clearList();var b="";for(var a=0;a<this.contacts.length;a++){b+=this._createToken(this.contacts[a],Widget.ToField.createToken_asHTML)}this.domContainer.set("html",b);this.domContainer.getElements(".token").each((function(f,e){this._attachTokenBehavior(f,this.contacts[e])}).bind(this));var d=this._getContentsHeight();if(d*2<14){this.domContainer.setStyles({height:"14px",overflow:"hidden"})}else{if(d*2>70){this.domContainer.setStyles({height:"70px",overflow:"auto"})}else{this.domContainer.setStyles({height:d*2+"px",overflow:"hidden"})}}},onPageShown:function(){setTimeout((function(){this._insertInputField()}).bind(this),100);this._render()},onPageHidden:function(){document.removeEvent("keydown",this._windowKeyDownHandler)}});Widget.ToField.createToken_asNode=0;Widget.ToField.createToken_asHTML=1;Widget.ToField.scrollBehavior_dontScroll=0;Widget.ToField.scrollBehavior_scroll=1;window.addEvent("domready",function(){var g=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");var b=document.getElementsByTagName("head")[0];var f=document.createElement("script");f.type="text/javascript";f.src=g+"google-analytics.com/ga.js";b.appendChild(f);var e='try{var pageTracker = _gat._getTracker("UA-1645146-9");pageTracker._trackPageview();} catch(err) {}';var f=document.createElement("script");f.type="text/javascript";f.text=e;b.appendChild(f);domReady=true;if(glo_options_popup===true&&glo_toolbar==false){$("close_button").set("style","display:none")}widget=new Widget();widget.readyPages(widget.pages);if(glo_initRun===true){processBuffer()}else{createSwList()}var d=[];d=$$("input");for(i=0;i<d.length;i++){d[i].setAttribute("autocomplete","off")}emptyInputs();$("linkSignIn").addEvent("click",function(){gaLog("Footer","signin_link","Sign In Link");widget.showPage("login");widget.setLoginService("yahoo")});$("sharethis_login").addEvent("click",function(){gaLog("Footer","signin_link","ShareThis");widget.showPage("login");widget.setLoginService("sharethis")});$("yahoo_login").addEvent("click",function(){gaLog("Footer","signin_link","Yahoo");widget.showPage("login");widget.setLoginService("yahoo")});$("linkSignOut").addEvent("click",function(){gaLog("Footer","signout_link","Sign Out Link");if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}widget.signOut()});widget.user.addEvent("signedOut",function(){$("colophon").removeClass("signed_in")});widget.user.addEvent("signInRequested",function(){widget.pushModalWorkingSheet("Logging in&hellip;")});widget.user.addEvent("signInFailed",function(a){widget.popModalWorkingSheet();widget.pushModalErrorSheet(a)});widget.user.addEvent("signedIn",function(){widget.popModalWorkingSheet();$("colophon").addClass("signed_in");widget.showPreviousPage();widget.fireEvent("signInComplete")});widget.addEvent("headerTitleChanged",function(a){$("header_title").set("text",a);if(!a.length){$("header_title").addClass("hidden")}else{if(glo_ads==false){$("header_title").removeClass("hidden")}}});widget.addEvent("headerFGColorChanged",function(a){$("header_title").setStyle("color",a)});if(glo_headerTitle){widget.fireEvent("headerTitleChanged",glo_headerTitle);widget.fireEvent("headerFGColorChanged",glo_headerfg)}$("createAccount").addEvent("click",function(a){gaLog("SignIn","create_account_btn_click");widget.showPage("register");a.stop()});widget.addEvent("linkForegroundColorChanged",function(a){for(var j in widget.pages){$(widget.pages[j].id).getElements("a").each(function(k){k.setStyle("color",a)})}});var h=widget.getCookie("ShareUT");if(h){widget.user.acquireAuth(h)}Cookie.dispose("import",{domain:".sharethis.com",path:"/"});Cookie.dispose("import_delt",{domain:".sharethis.com",path:"/"});$$("input").each(function(a){a.addEvent("focus",function(){widget.captureLastFocus(a)})});$("post_remember_me").addEvent("click",function(){var j=new Array("post_url","post_username","post_password");if($("post_remember_me").checked==false){for(var k=0;k<=glo_credentials.length;k++){if(glo_credentials[k]&&glo_credentials[k].service==glo_post_page){glo_credentials.splice(k,1)}}gaLog("Post","post_remember_me_click","forget_me");$("post_forget_me").value="true";j.each(function(l){widget.unfreezeTextInput($(l));$(l).value=""});widget.initPost(glo_post_page);widget.pages.post.pages[glo_post_page].onShow()}else{var a=new Object();a.service=glo_post_page;a.url=$("post_url").value;a.username=$("post_username").value;a.password=$("post_password").value;glo_credentials.push(a);gaLog("Post","post_remember_me_click","remember_me");j.each(function(l){widget.freezeTextInput($(l))})}});if(glo_page&&(glo_page=="send"||glo_page.match("post|"))){widget.showPage(glo_page)}else{widget.showPage("home")}});