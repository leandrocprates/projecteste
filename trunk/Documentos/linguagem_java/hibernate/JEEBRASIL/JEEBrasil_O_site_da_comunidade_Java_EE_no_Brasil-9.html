<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0038)http://www.jspbrasil.com.br/mostrar/12 -->
<HTML><STYLE>#gview-cmenu {
  position: absolute;
  border: 1px solid #ccc;
  background: #fff;
  margin: 0;
  padding: 0;
  top: 0;
  left: 0;
  z-index: 10000;
  list-style-type: none;
  -webkit-box-shadow: 0 3px 5px rgba(0, 0, 0, .5);
}

#gview-cmenu:focus {
  outline: none;
}

.gview-cmenu-item {
  margin: 0;
  padding: 5px 7px;
  cursor: default;
  font-size: 13px;
  font-family: arial, san-serif;
  color: #000;
  -webkit-user-select: none;
}

.gview-cmenu-item:hover {
  background-color: #F0F7F9;
}

.gview-cmenu-item:first-child {
  border-bottom: 1px solid #ddd;
}

.gview-hidden {
  display: none;
}
</STYLE><HEAD><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<TITLE>JEEBrasil -- O site da comunidade Java EE no Brasil</TITLE>

<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/prototype.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/effects.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/validation.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/votacao.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/form.js"></SCRIPT>

<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/layout.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/rating.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/style.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/forms.css" rel="stylesheet" type="text/css">
</HEAD><BODY>

<DIV id="page">

<!-- Cabeçalho -->
<DIV id="header">

	<DIV id="header-top">
		<H1> <A href="http://www.jspbrasil.com.br/">JEE<SPAN class="greenText">Brasil</SPAN></A> </H1>
		<H2> O site da comunidade Java EE no Brasil </H2>
	
		<DIV id="encontre">
			<H3> Encontre </H3>
			<FORM action="http://www.jspbrasil.com.br/find" method="post" id="buscaForm">
				<P>
				<INPUT id="campo" name="busca" type="text" size="26">
				<A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="$(&#39;buscaForm&#39;).submit();"> Buscar </A>
				</P>
			</FORM>
		</DIV>
	</DIV>
	
	<DIV id="menu">
		<UL>
			<LI> <A href="http://www.jspbrasil.com.br/">Home</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/noticias">Notícias</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/eventos">Eventos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/artigos">Artigos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tutoriais">Tutoriais</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tags">Tags</A> </LI>			
			<LI> <A href="http://www.jspbrasil.com.br/apresentacoes">Apresentações</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/quemsomos">Quem Somos</A> </LI>	
			<LI id="areaRestrita"> <A href="http://www.jspbrasil.com.br/admin"><IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/chave.gif" alt="Administra&ccedil;&atilde;o"></A></LI>			
		</UL>
	</DIV>
	
</DIV>

<DIV id="content">


	<DIV id="fullPanel">
		<DIV id="rightPanel">
			<H4 class="informacoes"> Informações </H4>
			<TABLE>
				<TBODY><TR>
					<TH> Tipo: </TH>
					<TD> Tutorial </TD>
				</TR>
				<TR>
					<TH> Data de Publicação: </TH>
					<TD> 03/11/2005 </TD>
				</TR>
				<TR>
					<TH> Revisado em:</TH>
					<TD> 03/11/2005 </TD>
				</TR>
			</TBODY></TABLE>
			<H4 class="nota" id="user-note">
				
				Vote!
				
				
			</H4>
			<UL class="star-rating" id="voting">
				<LI class="current-rating" id="current-rating" style="width: 93.75px">Currently 3,8/5 Stars.</LI>
				
				<LI><A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="javascript:votar(12,1, &#39;&#39;);" title="muito ruim" class="one-star">1</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="javascript:votar(12,2, &#39;&#39;);" title="ruim" class="two-stars">2</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="javascript:votar(12,3, &#39;&#39;);" title="mais ou menos" class="three-stars">3</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="javascript:votar(12,4, &#39;&#39;);" title="bom" class="four-stars">4</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/12#" onclick="javascript:votar(12,5, &#39;&#39;);" title="muito bom" class="five-stars">5</A></LI>
				
			</UL>
			
			<H4 class="tagsRelacionadas">Tags Relacionadas</H4>
			<P class="tags">
				
				<A href="http://www.jspbrasil.com.br/tags/hibernate">hibernate</A>
				
				<A href="http://www.jspbrasil.com.br/tags/framework">framework</A>
				
				<A href="http://www.jspbrasil.com.br/tags/persistencia">persistencia</A>
				
			</P>
			<H4 class="comentarios"><A href="http://www.jspbrasil.com.br/mostrar/12#comentarios">Comentários ( 9 )</A></H4>
			<H4 class="imprimir">Imprimir</H4>
		</DIV>

		<DIV id="tituloPublicacao">
			<H3> Mapeando Associações com Hibernate - Parte 1 </H3>
			<P class="autores">
				por:<BR>
				</P><P class="autor">
				
				Raphaela Galhardo Fernandes (raphaela@jeebrasil.com.br)<BR>
				
				Gleydson Lima (gleydson@jeebrasil.com.br)<BR>
				
				</P>
			<P></P>

			<P class="resumo">
			Este tutorial apresenta os mapeamentos no Hibernate de relacionamentos entre entidades. Os mapeamentos apresentados são: 1-para-n, n-para-1 e n-para-n. O próximo tutorial consiste na segunda parte do tutorial sobre Associações, onde serão mapeadas associações n-para-n com atributos e 1-para-1.
			</P>

			<H4>  </H4>
		</DIV>

		<DIV id="corpoPublicacao">
			<H4>Associações</H4>

<P>
O termo associação é utilizado para se referir aos relacionamentos entre as entidades. Os relacionamentos n-para-n, n-para-1 e 1-para-n são os mais comuns entre as entidades de um banco de dados. 
</P>
<P>
Todos os exemplos apresentados nesta seção baseiam-se no diagrama de classes mostrado na Figura 1 do Tutorial "Primeiro Exemplo com Hibernate".
</P>

<H5>Associações 1-n (one-to-many)</H5>

<P>
Para exemplificar o relacionamento 1-n, considere o relacionamento entre a entidade <STRONG>Centro</STRONG> e a entidade <STRONG>Universidade</STRONG> da Figura 1. O relacionamento diz que uma universidade possui um conjunto de <STRONG>n</STRONG> centros e um centro está associado a apenas uma única universidade. Considere as classes de domínio Java de uma universidade e de um centro, respectivamente, mostradas nas Listagens 1 e 2.
</P>


<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/img-01.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 1 - Relacionamento entre Centro e Universidade
</P>



<PRE>package br.com.jeebrasil.dominio;
import java.util.Collection;
public class Universidade implements Serializable{
	private int id;
	private String nome;
        private Endereco endereco;
	private Collection centros;
	
	//Implementação dos métodos setter e getter
	...	
}
</PRE>
<P class="legenda">
Listagem 1 - Classe de Domínio: Universidade
</P>



<PRE>package br.com.jeebrasil.dominio;
import java.util.Collection;
public class Centro implements Serializable{
	private int id;
	private String nome;
      private Universidade universidade;
      //departamentos -&gt; Atributo mapeado das mesma forma que a
      //coleção centros em Universidade
	private Collection departamentos;
	
	//Implementação dos métodos setter e getter
}
</PRE>
<P class="legenda">
Listagem 2 - Classe de Domínio: Centro
</P>


<P>
A classe de domínio <STRONG>Universidade</STRONG> é a que possui um mapeamento do tipo 1-n. O seu mapeamento pode ser visto na Listagem 3. Neste momento, as informações do endereço da universidade foram desconsideradas.
</P>



<PRE>...
&lt;hibernate-mapping&gt;
    &lt;class name="br.com.jeebrasil.dominio.Universidade"   
           table="UNIVERSIDADE"&gt;
        &lt;id name="id" column="ID_UNVERSIDADE" type="int"&gt;
            &lt;generator class="increment"/&gt;
        &lt;/id&gt;         
        &lt;property name="nome"/&gt;     
   		
	  &lt;!-- Mapeamento da Coleção de centros --&gt;
	  &lt;set name="centros" inverse="true" lazy="true"&gt;
		&lt;key column="ID_UNIVERSIDADE"/&gt;
		&lt;one-to-many class="br.com.jeebrasil.dominio.Centro"/&gt;
	  &lt;/set&gt;	       	
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;  
</PRE>
<P class="legenda">
Listagem 3 - Mapeamento 1-n: tabela universidade
</P>

<P>
Observa-se que para realizar o mapeamento 1-n, ou seja, da coleção <STRONG>centros</STRONG> foi utilizada uma tag <STRONG>set</STRONG>. Um <EM>set</EM> ou um conjunto representa uma coleção de objetos não repetidos que podem ou não estar ordenados. O atributo <STRONG>name</STRONG> define a propriedade que está sendo tratada para realizar o relacionamento 1-n. O atributo <STRONG>key</STRONG> representa a coluna da tabela relacionada (<STRONG>Centro</STRONG>) que possui a chave estrangeira para a classe <STRONG>Universidade</STRONG>. O nome da coluna da chave estrangeira (<STRONG>ID_UNIVERSIDADE</STRONG>) é informado no atributo column. Na tag <STRONG>&lt;one-to-many&gt;</STRONG> informa-se a classe a qual pertence à coleção de objetos, no caso <STRONG>br.com.jeebrasil.dominio.Centro</STRONG>.
</P>

<P>
A tag <STRONG>set</STRONG> também apresenta um atributo denominado <STRONG>inverse</STRONG>. Esse atributo é utilizado para que o Hibernate saiba como tratar a associação entre duas tabelas. Quando um lado da associação define o atributo <STRONG>inverse</STRONG> como <STRONG>true</STRONG>, indica que a ligação do relacionamento entre a associação será de responsabilidade do "outro lado" da associação.
</P>

<P>
Considerando o relacionamento entre uma universidade e seus centros, no mapeamento do conjunto de centros em universidade, o atributo <STRONG>inverse</STRONG> é igual a <STRONG>true</STRONG>. Dessa forma, a criação ou atualização do relacionamento entre um centro e uma universidade será feita durante a persistência ou atualização de um objeto <STRONG>Centro</STRONG>. 
</P>

<P>
A partir do exemplo apresentado na Listagem 4, cria-se uma instância da classe <STRONG>Universidade</STRONG> e define-se um valor para o atributo nome. Em seguida, uma instância da classe <STRONG>Centro</STRONG> também é criada, definindo o atributo nome e o atributo universidade (como sendo a instância de <STRONG>Universidade</STRONG> anteriormente criada). Por fim, o objeto <STRONG>Centro</STRONG> criado é adicionado à coleção de centros do objeto <STRONG>Universidade</STRONG>, o qual é persistido.
</P>


<PRE>...
Universidade univ = new Universidade()
univ.setNome("Universidade Federal do Rio Grande do Norte");

Centro centro = new Centro();
centro.setNome("Centro de Tecnologia");
centro.setUniversidade(univ);

univ.setCentros(new HashSet<CENTRO>());
univ.getCentros().add(centro);

session.save(univ);
...
</CENTRO></PRE>
<P class="legenda">
Listagem 4 - Exemplificando uso do atributo inverse
</P>

<P>
A Listagem 5 apresenta o que acontece se o atributo <STRONG>inverse</STRONG> no mapeamento 1-n for definido como <STRONG>false</STRONG>. O que acontece é que o Hibernate insere uma linha na tabela <STRONG>UNIVERSIDADE</STRONG> e em seguida tenta atualizar o relacionamento entre uma universidade e um centro, no caso a partir de um <STRONG>UPDATE</STRONG> na tabela <STRONG>CENTRO</STRONG>, setando a chave estrangeira para a tabela <STRONG>UNIVERSIDADE</STRONG>. 
</P>


<PRE>Hibernate: insert into UNIVERSIDADE (nome, ID_ENDERECO, ID_UNIVERSIDADE) values (?, ?, ?)
Hibernate: update CENTRO set ID_UNIVERSIDADE=? where ID_CENTRO=?
</PRE>
<P class="legenda">
Listagem 5  SQL gerado pelo Hibernate com atributo inverse=false
</P>

<P>
Verifica-se, então, que com o atributo  <STRONG>inverse</STRONG> sendo igual a  <STRONG>false</STRONG>, o Hibernate tenta atualizar o relacionamento entre uma universidade e um centro logo após a inserção da universidade. Neste caso, como o relacionamento com a universidade está sendo feito com um objeto transiente de um  <STRONG>Centro</STRONG>, o que vai ocorrer é que o Hibernate vai tentar atualizar a chave estrangeira para a tabela  <STRONG>UNIVERSIDADE</STRONG> em uma linha da tabela  <STRONG>CENTRO</STRONG> que não existe, acontecendo o erro exibido na Listagem 6.
</P>

<PRE>ERRO:
Exception in thread "main" org.hibernate.TransientObjectException: object 
references an unsaved transient instance - save the transient instance 
before flushing: br.com.jeebrasil.dominio.Centro ...
</PRE>
<P class="legenda">
Listagem 6  Erro gerado após teste com o atributo inverse=false no relacionamento 1-n em Universidade
</P>


<P>
De acordo com o mapeamento da Listagem 3, o atributo <STRONG>inverse</STRONG> é definido como <STRONG>true</STRONG>. Então, para o código da Listagem 4 vai ser gerado o SQL exibido na Listagem 7. Neste caso, veja que apenas é dado um <STRONG>INSERT</STRONG> na tabela <STRONG>UNIVERSIDADE</STRONG>, ou seja, no momento da inserção de uma universidade o Hibernate não atualiza o relacionamento entre ela e seus centros, pois espera que ele seja feito no momento da inserção/atualização de um objeto <STRONG>Centro</STRONG>.
</P>

<PRE>Hibernate: insert into UNIVERSIDADE (nome, ID_ENDERECO, ID_UNIVERSIDADE) values (?, ?, ?)
</PRE>
<P class="legenda">
Listagem 7 - SQL gerado pelo Hibernate com atributo inverse=true
</P>


<P>
Resumindo, se o atributo <STRONG>inverse</STRONG> não for definido como <STRONG>true</STRONG>, o Hibernate não tem como saber qual dos dois lados foi atualizado, ou seja, vai sempre atualizar os dois lados de uma vez, uma atualização para cada classe da relação, o que seria desnecessário. Caso contrário, o Hibernate passa a saber de qual lado fazer a atualização e fazendo uma única vez.
</P>

<P>
Na tag <STRONG>set</STRONG> também está presente o atributo <STRONG>lazy</STRONG>. Ele é utilizado para resolver o seguinte problema: quando se realiza um <STRONG>select</STRONG> em um objeto <STRONG>Universidade</STRONG> implica em serem feitos <STRONG>n</STRONG> (número de centros da universidade) outros <STRONG>selects</STRONG> para buscar os seus centros. Dessa forma, a resolução do problema é feita apenas definindo o atributo <STRONG>lazy</STRONG> como sendo <STRONG>true</STRONG>. A coleção de centros passa a ser <EM>lazy-loading</EM>, o que significa que somente será recuperada quando solicitada, ou seja, a coleção de centros de uma universidade só seria solicitada caso o programador a acesse através da chamada ao método <STRONG>getCentros()</STRONG>.
</P>

<H5>Associações n-1 (many-to-one)</H5>

<P>
O relacionamento n-1 será apresentado a partir do relacionamento <STRONG>&lt;many-to-one&gt;</STRONG> existente entre a tabela <STRONG>Centro</STRONG> e a tabela <STRONG>Universidade</STRONG>. Neste caso, o relacionamento está presente no mapeamento da classe <STRONG>Centro</STRONG>, como mostrado na Listagem 8.
</P>

<PRE>...
&lt;hibernate-mapping&gt;
    &lt;class name="br.com.jeebrasil.dominio.Centro"   
           table="CENTRO"&gt;            
        &lt;id name="id" column="ID_CENTRO" type="int"&gt;
            &lt;generator class="increment"/&gt;
        &lt;/id&gt;         
        &lt;property name="nome" type="java.lang.String"/&gt;     
   		
	    &lt;!-- Mapeamento da Universidade --&gt;
	    <B>&lt;many-to-one name="universidade" 
        	   class="br.jeebrasil.dominio.Universidade" cascade="none"
               fech="join" update="true" insert="true" lazy="true"
               column="id_universidade"/&gt;
       </B>
	
        &lt;set name="departamentos" lazy="true" inverse="true"&gt;
		&lt;key column="ID_CENTRO"/&gt;
		&lt;one-to-many class="br.com.jeebrasil.dominio.Departamento"/&gt;
	&lt;/set&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;  
</PRE>

<P class="legenda">
Listagem 8 - Mapeamento n-1: tabela centro
</P>


<P>
Como mostrado no mapeamento da classe <STRONG>Centro</STRONG>, o relacionamento n-1 é mapeado a partir da tag <STRONG>&lt;many-to-one&gt;</STRONG>. Essa tag apresenta um conjunto de atributos, que podem assumir os valores apresentados na Listagem 9.
</P>

<PRE> &lt;many-to-one name="propertyName" 
     class="ClassName" column="column_name"
     fetch="join|select" update="true|false" lazy="true|false"
     insert="true|false" cascade="all|none|save-update|delete"
 /&gt;
</PRE>

<P class="legenda">
Listagem  9  Mapeamento n-1: atributos
</P>

<UL>
	<LI><STRONG>name</STRONG>: nome do atributo na classe Java;</LI>
	<LI><STRONG>column</STRONG>: coluna do banco de dados. É uma chave estrangeira;</LI>
	<LI><STRONG>class</STRONG>: nome da classe Java da entidade relacionada;</LI>
	<LI><STRONG>insert</STRONG> e <STRONG>update</STRONG>: indica se o atributo será incluído e alterado ou somente lido;</LI>
	<LI><STRONG>cascade</STRONG>: indica com que ação em cascata o relacionamento será tratado.</LI>
		<UL>
			<LI><STRONG>none</STRONG>: associação é ignorada;</LI>
			<LI><STRONG>save-update</STRONG>:os objetos associados vão ser inseridos ou atualizados automaticamente quando o objeto "pai" for inserido ou atualizado; </LI>
			<LI><STRONG>delete</STRONG>: os objetos associados ao objeto "pai" vão ser deletados;</LI>
			<LI><STRONG>all</STRONG>: junção de delete e save-update;</LI>
			<LI><STRONG>all-delete-orphan</STRONG>: o mesmo que <STRONG>all</STRONG>, mas o Hibernate deleta qualquer objeto que tiver sido retirado da associação;</LI>
			<LI><STRONG>delete-orphan</STRONG>: se o objeto não fizer mais parte da associação, ele removido.</LI>
		</UL>
	<LI><STRONG>fetch</STRONG>: se definido como <STRONG>join</STRONG> é usado para realizar <EM>joins</EM> sem restrição de nulidade (<STRONG>outer-join</STRONG>). Se for <STRONG>select</STRONG>, um novo <EM>select</EM> é feito para recuperar a informação da associação. </LI>
	<LI><STRONG>lazy</STRONG>: se igual a <STRONG>true</STRONG>, o objeto só será recuperado se solicitado; se igual a <STRONG>false</STRONG>, o objeto sempre será recuperado.</LI>
</UL>

<H5>Associações n-n (many-to-many)</H5>

<P>
O relacionamento n-n será feito a partir do relacionamento entre as entidades <STRONG>Departamento</STRONG> e <STRONG>Curso</STRONG> mostrado na Figura 2. 
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/img-02.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 2 - Relacionamento n-n entre Curso e Departamento
</P>

<P>
Um relacionamento n-n implica em existir uma nova tabela para mapear o relacionamento no banco de dados. Vamos denominar essa nova tabela como <STRONG>DEPARTAMENTO_CURSO</STRONG>, como mostrado na Figura 3. Dessa forma, um departamento possui uma coleção de cursos e um curso uma coleção de departamentos. A existência dessas coleções é opcional. Por exemplo, pode ser que em um sistema real não seja necessário saber todos os departamentos de determinado curso, mas se for realmente necessário, o Hibernate apresenta outros mecanismos para a obtenção desta informação.
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-9_files/img-03.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 3 - Tabela de relacionamento DEPARTAMENTO_CURSO 
</P>

<P>
As classes Java das entidades <STRONG>Departamento</STRONG> e <STRONG>Curso</STRONG> estão ilustradas nas Listagens 10 e 11, respectivamente.
</P>

<PRE>package br.com.jeebrasil.dominio;
import java.util.Collection;
public class Departamento implements Serializable{
	private int id;
	private String nome;
	private String sigla;
	private Centro centro;
	private Collection professores;
	private Collection cursos;
	
	//	Implementação dos métodos setter e getter
}
</PRE>

<P class="legenda">
Listagem 10 - Classe de Domínio: Departamento
</P>

<PRE>package br.com.jeebrasil.dominio;
import java.util.Collection;
public class Curso implements Serializable{
	private int id;
	private int codigo;
	private String nome;
	private String sigla;
	private Collection departamentos;
	private Collection alunos;
	
	//Implementação dos métodos setter e getter
}
</PRE>
<P class="legenda">
Listagem 11 - Classe de Domínio: Curso
</P>

<P>
A Listagem 12 apresenta o mapeamento da classe <STRONG>Departamento</STRONG>. Já a Listagem 13, o mapeamento da classe <STRONG>Curso</STRONG>. 
</P>

<PRE>...
&lt;hibernate-mapping&gt;
    &lt;class name="br.com.jeebrasil.dominio.Departamento"  
           table="DEPARTAMENTO"&gt;            
        &lt;id name="id" column="ID_DEPARTAMENTO" type="int"&gt;
            &lt;generator class="increment"/&gt;
        &lt;/id&gt;          
        &lt;property name="nome" type="java.lang.String"/&gt;        
        &lt;property name="sigla" type="java.lang.String
        &lt;many-to-one name="centro"                            
                  class="br.com.jeebrasil.dominio.Centro"
		 	column="ID_CENTRO"
			cascade="save-update"/&gt;		
	  &lt;set name="professores"&gt;
	      &lt;key column="ID_DEPARTAMENTO"/&gt;
		&lt;one-to-many class="br.com.jeebrasil.dominio.Professor"/&gt;
	  &lt;/set&gt;
		
	 &lt;!-- Mapeamento dos cursos --&gt;
	 &lt;set name="cursos" table="DEPARTAMENTO_CURSO" 
            inverse="true"&gt;
		&lt;key column="ID_DEPARTAMENTO"/&gt;
		&lt;many-to-many column="ID_CURSO" 
                   class="br.com.jeebrasil.dominio.Curso"/&gt;
	 &lt;/set&gt;		
   &lt;/class&gt;
&lt;/hibernate-mapping&gt;  
</PRE>

<P class="legenda">
Listagem 12 - Departamento.hbm.xml
</P>

<PRE>...
&lt;hibernate-mapping&gt;
    &lt;class name="br.com.jeebrasil.dominio.Curso"  table="CURSO"&gt;        
        &lt;id name="id" column="ID_CURSO" type="int"&gt;
            &lt;generator class="increment"/&gt;
        &lt;/id&gt;          
        &lt;property name="codigo"/&gt;  
        &lt;property name="nome"/&gt;        
        &lt;property name="sigla"/&gt;      
	  &lt;set name="alunos"&gt;
		&lt;key column="ID_CURSO"/&gt;
		&lt;one-to-many class="br.com.jeebrasil.dominio.Aluno"/&gt;
	&lt;/set&gt;
		
	&lt;!-- Mapeamento dos departamentos--&gt;
	&lt;set name="departamentos" table="DEPARTAMENTO_CURSO"&gt;
		&lt;key column="ID_CURSO"/&gt;
		&lt;many-to-many column="ID_DEPARTAMENTO" 
                       class="br.com.jeebrasil.dominio.Departamento"/&gt;
	&lt;/set&gt;		
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;    
</PRE>
<P class="legenda">
Listagem 13 - Curso.hbm.xml
</P>

<P>
Observa-se que tanto no mapeamento da coleção <STRONG>cursos</STRONG> em <STRONG>Departamento</STRONG> quanto no da coleção <STRONG>departamentos</STRONG> em <STRONG>Curso</STRONG>, o relacionamento n-n é feito a partir de uma tag <STRONG>set</STRONG>. Os mapeamentos das duas coleções apresentam uma tag <STRONG>key</STRONG>, na qual o atributo <STRONG>column</STRONG> indica a chave estrangeira do pai na tabela de relacionamento <STRONG>DEPARTAMENTO_CURSO</STRONG>. Apresentam também a tag <STRONG>many-to-many</STRONG> utilizada para indicar a entidade filha e sua chave estrangeira no relacionamento. A única diferença entre o mapeamento das duas coleções é que na tag <STRONG>set</STRONG> de cursos no mapeamento da entidade <STRONG>Departamento</STRONG> o atributo <STRONG>inverse</STRONG> é igual a <STRONG>true</STRONG>, significando que na tabela <STRONG>DEPARTAMENTO_CURSO</STRONG> só será inserido o relacionamento entre as duas entidades, quando um curso for inserido no banco de dados associado a um departamento.
</P>

<P>
Neste caso, não seria necessário mapear a coleção de cursos em <STRONG>Departamento</STRONG>, pois não está sendo utilizada para popular a tabela de relacionamento. Como já citado, para recuperar a coleção de cursos de um departamento, o Hibernate apresenta outros mecanismos.
</P>

<P>
Em outros relacionamentos n-n, pode ser que seja necessário inserir/atualizar o relacionamento na tabela de relacionamento durante a inserção/atualização de qualquer um dos lados das entidades, portanto, basta que o atributo <STRONG>inverse</STRONG> nas duas coleções seja mapeado como <STRONG>false</STRONG>.
</P>

<P>
O código presente na Listagem 14 cria um instância de um objeto <STRONG>Departamento</STRONG>. Em seguida recupera um objeto persistente da classe <STRONG>Curso</STRONG> com identificador igual a <STRONG>1</STRONG>, adiciona esse objeto <STRONG>Curso</STRONG> na coleção de cursos do objeto <STRONG>Departamento</STRONG> criado e, por fim, persiste o departamento. O SQL gerado é apresentado na Listagem 15. Observa-se que apenas um <STRONG>SELECT</STRONG> na tabela <STRONG>CURSO</STRONG> é feito e um <STRONG>INSERT</STRONG> na tabela <STRONG>DEPARTAMENTO</STRONG>. Não há uma inclusão de linha na tabela de relacionamento <STRONG>DEPARTAMENTO_CURSO</STRONG>, pois o atributo <STRONG>inverse</STRONG> da coleção de cursos no mapeamento da classe <STRONG>Departamento</STRONG> foi definido como <STRONG>true</STRONG>.
</P>

<PRE>Departamento depart = new Departamento();
depart.setNome("Departamento 1");	    
Curso curso = (Curso)session.get(Curso.class, 1);
depart.getCursos().add(curso);
session.save(depart);
</PRE>

<P class="legenda">
Listagem 14 - Persistência de Departamento
</P>

<PRE>Hibernate: select curso0_.ID_CURSO as ID1_0_, curso0_.codigo as  
   codigo1_0_, curso0_.nome as nome1_0_, curso0_.sigla as sigla1_0_, 
   curso0_.ID_COORDENADOR as ID5_1_0_ from CURSO curso0_ where 
   curso0_.ID_CURSO=?
Hibernate: insert into DEPARTAMENTO (nome, sigla, ID_CENTRO, ID_CHEFE, 
   ID_DEPARTAMENTO) values (?, ?, ?, ?, ?)
</PRE>

<P class="legenda">
Listagem 15 - SQL para comandos da Tabela 14
</P>

<P>
Já o código presente na Listagem 16, cria uma instância da classe <STRONG>Curso</STRONG>, busca o objeto persistente <STRONG>Departamento</STRONG> de identificador <STRONG>1</STRONG> na base de dados, adiciona o departamento a coleção de <STRONG>departamentos</STRONG> do objeto <STRONG>Curso</STRONG> e realiza a a sua persistência. O SQL presente na Listagem 17 mostra que um <STRONG>SELECT</STRONG> foi feito na tabela <STRONG>DEPARTAMENTO</STRONG>, um <STRONG>INSERT</STRONG> na tabela <STRONG>CURSO</STRONG> e um outro <STRONG>INSERT</STRONG> na tabela <STRONG>DEPARTAMENTO_CURSO</STRONG>. Nesse caso, o relacionamento foi persistido, pois no mapeamento da coleção <STRONG>departamentos</STRONG> da classe <STRONG>Curso</STRONG>, como o atributo <STRONG>inverse</STRONG> não foi definido como <STRONG>true</STRONG>, assume-se que ele é <STRONG>false</STRONG>.

</P><PRE>Curso curso = new Curso();
Departamento d = (Departamento)session.get(Departamento.class, 1);
curso.getDepartamentos().add(d);
session.save(curso);
</PRE>

<P class="legenda">
Listagem 16 - Persistência de Curso
</P>

<PRE>Hibernate: select departamen0_.ID_DEPARTAMENTO as ID1_0_, 
   departamen0_.nome as nome4_0_, departamen0_.sigla as sigla4_0_, 
   departamen0_.ID_CENTRO as ID4_4_0_, departamen0_.ID_CHEFE 
   as ID5_4_0_ 
   from DEPARTAMENTO departamen0_ where departamen0_.ID_DEPARTAMENTO=?
Hibernate: insert into CURSO (codigo, nome, sigla, ID_COORDENADOR, 
   ID_CURSO) values (?, ?, ?, ?, ?)
Hibernate: insert into DEPARTAMENTO_CURSO (ID_CURSO, ID_DEPARTAMENTO) 
   values (?, ?)
</PRE>
<P class="legenda">
Listagem 17 - SQL para comandos da Tabela 16
</P>

<H4>Conclusões</H4>

<P>
O mapeamento de relacionamentos entre entidades será freqüente ao se utilizar um framework de mapeamento objeto-relacional. De início, mapeá-los utilizando Hibernate pode parecer uma tarefa difícil e tediosa, porém nada melhor do que a prática para ver que esse poderoso framework ajudará bastante o desenvolvedor e possibilitará redução no tempo de desenvolvimento de uma aplicação. Pratique! 
</P>

<P>
No próximo tutorial será apresentado o mapeamento do relacionamento 1-para-1 e do relacionamento n-para-n com atributos, onde também será apresentado o mapeamento de chaves compostas.
</P>
		   



<H4> Referências</H4>

<OL>
	
<LI>Christian Bauer e Gavin King. Hibernate in Action. 2005.</LI>
<LI>Grupo Hibernate. Hibernate Reference 	Documentation. Version 3.0.5. Obtido 
     em http://www.hibernate.org</LI>
<LI>Gleydson de Azevedo Ferreira Lima. Material Didático. 2005.</LI>
<LI>Nick Heudecker. Introdução ao Hibernate.</LI>
<LI>Maurício Linhares. Introdução ao Hibernate 3.</LI>
<LI>Francesc Rosés Albiol. Introducción a Hibernate. 2003.</LI>
<LI>Fabiano Kraemer, Jerônimo Jardel Vogt. Hibernate, um Robusto Framework de 
     Persistência Objeto-Relacional. 2005.</LI>
</OL>































		</DIV>

		<A name="comentarios"></A>
		
		<DIV id="listaComentarios">
		<H4> Comentários (9) </H4>
			<DL>
				
				<DT>
				Ótimo
				</DT>
					<DD> postado por Aristides Vicente em 29/03/2007 às 23:21</DD>
				
				<DT>
				Muito bom mesmo, de verdade.

Parabéns!!!
				</DT>
					<DD> postado por José Milton em 30/03/2007 às 23:21</DD>
				
				<DT>
				Sinceramente... sem comentários. Muito bom esses tutoriais sobre hibernate. Agora que estou no terceiro, mas estou ancioso para ler todos. Muito bom mesmo. Parabéns!!!
				</DT>
					<DD> postado por Marcio Correia em 10/04/2007 às 23:21</DD>
				
				<DT>
				Parabéns por este e pelos outros artigos sobre Hibernate.
Eu vi vários artigos na web sobre Hibernate. Os artigos de vocês são bem didáticos!!
				</DT>
					<DD> postado por cleriston em 06/07/2007 às 23:21</DD>
				
				<DT>
				Aquele relacionamento da figura está correto mesmo? Não seria o contrário?
				</DT>
					<DD> postado por bigo em 31/10/2007 às 23:21</DD>
				
				<DT>
				ah nao... cabaciei
				</DT>
					<DD> postado por bigo em 31/10/2007 às 23:21</DD>
				
				<DT>
				Achei muito bom o artigo, porém não consegui visualizar como ficaria, em código, a inclusão de mais um departamento para um curso que já está incluso no banco. Não sei se vc me entendeu e até fico grato por um retorno, de qualquer forma o artigo é muito bom.
				</DT>
					<DD> postado por Robson em 11/11/2007 às 23:21</DD>
				
				<DT>
				Tentei rodar o exemplo acima e não funcionou.
				</DT>
					<DD> postado por Victor em 06/12/2007 às 23:21</DD>
				
				<DT>
				Google is the best search engine <A href="http://google9356.com/">Google</A>
				</DT>
					<DD> postado por sLKlVYCSTw em 15/02/2008 às 23:21</DD>
				
			</DL>
		</DIV>
		

	<DIV id="comente">
	<FORM action="http://www.jspbrasil.com.br/comentario" id="form" method="post">
	<FIELDSET>
		<LEGEND>Comente!</LEGEND>
		
		

		<DIV class="notes">
      	<H4>Observações</H4>
      	<P>Os campos em <STRONG>negrito</STRONG> são <STRONG>obrigatórios</STRONG>.</P>
      	<P>Para evitar problemas, este espaço é moderado. Após o envio do comentário será
      	necessário aguardar pela sua aprovação.</P>
    	</DIV> 
		
		<DIV class="obrigatorio">
		<LABEL for="nome">Nome:</LABEL> 
		<INPUT type="text" id="nome" class="required" name="nome" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="email">E-Mail:</LABEL> 
		<INPUT type="text" id="email" class="validate-email" name="email" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="site">Site:</LABEL> 
		<INPUT type="text" id="site" class="validate-url" name="site" size="58" value="">
		</DIV>
		
		<DIV class="obrigatorio">
		<LABEL for="texto">Comentário:</LABEL> 
		<TEXTAREA name="texto" id="texto" class="required" rows="5" cols="55"></TEXTAREA>
		</DIV>
		
	    <P class="botoes">    
			<INPUT type="submit" value="Enviar">
    	</P>
		
	</FIELDSET>

	<INPUT type="hidden" name="publicacao.id" value="12">
	</FORM>
	</DIV>
	<A name="bottom">


</A></DIV><A name="bottom"> <!-- fim de content -->

<SCRIPT type="text/javascript">
	var validForm = new Validation('form');
</SCRIPT>

</A></DIV><A name="bottom"> <!-- Fim de Content -->

</A><DIV id="footer"><A name="bottom">
	</A><A href="http://www.jspbrasil.com.br/quemsomos"> Quem Somos </A> &nbsp;|&nbsp;
	<A href="mailto:sugestoes@jeebrasil.com.br"> Fale Conosco</A>
	<P>Copyright 2006 - JEEBrasil.</P>
</DIV>

</DIV> <!-- fim de page -->



</BODY></HTML>