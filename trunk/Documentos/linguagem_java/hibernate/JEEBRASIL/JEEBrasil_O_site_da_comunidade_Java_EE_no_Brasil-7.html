<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0038)http://www.jspbrasil.com.br/mostrar/15 -->
<HTML><STYLE>#gview-cmenu {
  position: absolute;
  border: 1px solid #ccc;
  background: #fff;
  margin: 0;
  padding: 0;
  top: 0;
  left: 0;
  z-index: 10000;
  list-style-type: none;
  -webkit-box-shadow: 0 3px 5px rgba(0, 0, 0, .5);
}

#gview-cmenu:focus {
  outline: none;
}

.gview-cmenu-item {
  margin: 0;
  padding: 5px 7px;
  cursor: default;
  font-size: 13px;
  font-family: arial, san-serif;
  color: #000;
  -webkit-user-select: none;
}

.gview-cmenu-item:hover {
  background-color: #F0F7F9;
}

.gview-cmenu-item:first-child {
  border-bottom: 1px solid #ddd;
}

.gview-hidden {
  display: none;
}
</STYLE><HEAD><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<TITLE>JEEBrasil -- O site da comunidade Java EE no Brasil</TITLE>

<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/prototype.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/effects.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/validation.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/votacao.js"></SCRIPT>
<SCRIPT type="text/javascript" src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/form.js"></SCRIPT>

<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/layout.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/rating.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/style.css" rel="stylesheet" type="text/css">
<LINK href="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/forms.css" rel="stylesheet" type="text/css">
</HEAD><BODY>

<DIV id="page">

<!-- Cabeçalho -->
<DIV id="header">

	<DIV id="header-top">
		<H1> <A href="http://www.jspbrasil.com.br/">JEE<SPAN class="greenText">Brasil</SPAN></A> </H1>
		<H2> O site da comunidade Java EE no Brasil </H2>
	
		<DIV id="encontre">
			<H3> Encontre </H3>
			<FORM action="http://www.jspbrasil.com.br/find" method="post" id="buscaForm">
				<P>
				<INPUT id="campo" name="busca" type="text" size="26">
				<A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="$(&#39;buscaForm&#39;).submit();"> Buscar </A>
				</P>
			</FORM>
		</DIV>
	</DIV>
	
	<DIV id="menu">
		<UL>
			<LI> <A href="http://www.jspbrasil.com.br/">Home</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/noticias">Notícias</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/eventos">Eventos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/artigos">Artigos</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tutoriais">Tutoriais</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/tags">Tags</A> </LI>			
			<LI> <A href="http://www.jspbrasil.com.br/apresentacoes">Apresentações</A> </LI>
			<LI> <A href="http://www.jspbrasil.com.br/quemsomos">Quem Somos</A> </LI>	
			<LI id="areaRestrita"> <A href="http://www.jspbrasil.com.br/admin"><IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/chave.gif" alt="Administra&ccedil;&atilde;o"></A></LI>			
		</UL>
	</DIV>
	
</DIV>

<DIV id="content">


	<DIV id="fullPanel">
		<DIV id="rightPanel">
			<H4 class="informacoes"> Informações </H4>
			<TABLE>
				<TBODY><TR>
					<TH> Tipo: </TH>
					<TD> Tutorial </TD>
				</TR>
				<TR>
					<TH> Data de Publicação: </TH>
					<TD> 18/12/2005 </TD>
				</TR>
				<TR>
					<TH> Revisado em:</TH>
					<TD> 18/12/2005 </TD>
				</TR>
			</TBODY></TABLE>
			<H4 class="nota" id="user-note">
				
				Vote!
				
				
			</H4>
			<UL class="star-rating" id="voting">
				<LI class="current-rating" id="current-rating" style="width: 125.0px">Currently 5,0/5 Stars.</LI>
				
				<LI><A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="javascript:votar(15,1, &#39;&#39;);" title="muito ruim" class="one-star">1</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="javascript:votar(15,2, &#39;&#39;);" title="ruim" class="two-stars">2</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="javascript:votar(15,3, &#39;&#39;);" title="mais ou menos" class="three-stars">3</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="javascript:votar(15,4, &#39;&#39;);" title="bom" class="four-stars">4</A></LI>
				<LI><A href="http://www.jspbrasil.com.br/mostrar/15#" onclick="javascript:votar(15,5, &#39;&#39;);" title="muito bom" class="five-stars">5</A></LI>
				
			</UL>
			
			<H4 class="tagsRelacionadas">Tags Relacionadas</H4>
			<P class="tags">
				
				<A href="http://www.jspbrasil.com.br/tags/hibernate">hibernate</A>
				
				<A href="http://www.jspbrasil.com.br/tags/framework">framework</A>
				
				<A href="http://www.jspbrasil.com.br/tags/persistencia">persistencia</A>
				
			</P>
			<H4 class="comentarios"><A href="http://www.jspbrasil.com.br/mostrar/15#comentarios">Comentários ( 1 )</A></H4>
			<H4 class="imprimir">Imprimir</H4>
		</DIV>

		<DIV id="tituloPublicacao">
			<H3> Mapeando Coleções com Hibernate </H3>
			<P class="autores">
				por:<BR>
				</P><P class="autor">
				
				Raphaela Galhardo Fernandes (raphaela@jeebrasil.com.br)<BR>
				
				Gleydson Lima (gleydson@jeebrasil.com.br)<BR>
				
				</P>
			<P></P>

			<P class="resumo">
			Este tutorial apresenta o mapeamento de coleções usando o Hibernate.
			</P>

			<H4>  </H4>
		</DIV>

		<DIV id="corpoPublicacao">
			<H4>Introdução</H4>

<P>
O mapeamento de coleções já foi apresentado nos tutoriais sobre associações. Essa seção está destinada a apresentar o mapeamento dos quatro tipos de coleções existentes: <EM>Set</EM>, <EM>Bag</EM>, <EM>List</EM> e <EM>Map</EM>.
</P>

<H4> Set</H4>

<P>
Um <EM>Set</EM> é um conjunto que contém elementos únicos. Como já citado, o seu mapeamento é feito através da tag <EM>set</EM> e possui o conjunto de atributos mostrado na Listagem 1. Esses atributos são semelhantes para os demais tipos de coleções a serem apresentadas.
</P>

<PRE>&lt;set
   name="nomePropriedade”
   table="nomeTabela"
   schema="nomeEsquema"
   lazy="true|false"
   inverse="true|false"
   cascade="all|delete|save-update|delete|delete-orphan|all-delete- 
            orphan"
   sort="unsorted|natural|comparatorClass"
   order-by="nome_coluna asc|desc"
   where="condição sql arbitrária"&gt;
      &lt;key .../&gt;
      &lt;element .../&gt; | &lt;one-to-many .../&gt; | &lt;many-to-many .../&gt;
&lt;/set&gt;
</PRE>
<P class="legenda">
Listagem 1 - - Coleções: Atributos
</P>

<P>
Dos atributos ainda não apresentados nos tutoriais sobre associações estão:
</P>

<UL>
	<LI><B>schema</B>: indica o nome do esquema do banco de dados;</LI>
	<LI><B>sort</B>: a ordenação pode ser feita na classe Java. </LI>
	<LI>
		<UL>
			<LI><B>unsorted</B>: desordenada</LI>
			<LI><B>natural</B>: odenada a partir do método equals(...);</LI>
			<LI><B>comparatorClass</B>: ordenada a partir do método compareTo();</LI>
		</UL>
	</LI>
	<LI><B>order-by</B>: ordenação feita no banco de dados a partir do nome da coluna informada. Pode ser ascendente ou descendente;</LI>	
	<LI><B>where</B>: para informar uma condição arbitrária para a busca da coleção.</LI>
	<LI><B>element</B>: indica que a coleção é formada por um tipo primitivo.</LI>
</UL>

<P>
Exemplos de <B>Set</B> já foram apresentados nos mapeamentos dos relacionamentos. Para exemplificar o mapeamento de um <B>Set</B> de tipos primitivos considere o mapeamento de uma coleção de <B>String</B>’s para armazenar os telefones de um <B>Aluno</B>, como visto na Figura 1. Então no mapeamento <B>Aluno.hbm.xml</B> deve ser inserido o mapeamento mostrado na Listagem 2.
</P>


<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/img-01.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 1 - Coleção de telefones para Aluno
</P>

<PRE>...
&lt;set name="telefones" lazy="true" table="ALUNO_TELEFONE"&gt;
   &lt;key column="ID_ALUNO"/&gt;
   &lt;element type="java.lang.String" 
          column="TELEFONE" not-null="true"/&gt;
&lt;/set&gt;
...
</PRE>
<P class="legenda">
Listagem 2 - Coleções: Set
</P>

<P>
Os telefones do aluno são armazenados na tabela <B>ALUNO_TELEFONE</B>. Para o banco de dados está tabela é separada da tabela <B>ALUNO</B>, mas para o Hibernate, ele cria a ilusão de uma única entidade. A tag <B>key</B> indica a chave estrangeira da entidade pai (<B>ID_ALUNO</B>). A tag <B>element</B> indica o tipo da coleção (<B>String</B>) e a coluna na qual está a informação.
</P>

<P>
Um <B>Set</B> não pode apresentar elementos duplicados, portanto a chave primária de <B>ALUNO_TELEFONE</B> consiste nas colunas <B>ID_ALUNO</B> e <B>TELEFONE</B>.
</P>

<P>
Dado o mapeamento da coleção de telefones de <B>Aluno</B>, observe o exemplo mostrado na Listagem 3. Neste exemplo, cria-se um objeto <B>Aluno</B> que terá o seu nome definido e um único número de telefone inserido em sua coleção de <B>String</B>’s. Por fim, o objeto Aluno é persistido. O resultado é mostrado na Listagem 4, onde primeiro é inserida uma linha na tabela <B>ALUNO</B> e posteriormente uma linha na tabela <B>ALUNO_TELEFONE</B>.
</P>

<PRE>Aluno aluno = new Aluno();
aluno.setNome("João Maria Costa Neto");
aluno.setTelefones(new HashSet<STRING>());
aluno.getTelefones().add("32222529");
		
session.save(aluno);
</STRING></PRE>
<P class="legenda">
Listagem 3 - Exemplo de Mapeamento de Set
</P>

<PRE>Hibernate: insert into ALUNO (MATRICULA, NOME, CPF, 
           ID_CURSO, ID_ALUNO) values (?, ?, ?, ?, ?)
Hibernate: insert into ALUNO_TELEFONE (ID_ALUNO,        
           TELEFONE) values (?, ?)
</PRE>
<P class="legenda">
Listagem 4 - Resultado da execução do código presente na Listagem 3
</P>


<H4>List</H4>

<P>
Um <B>List</B> é uma coleção ordenada que pode conter elementos duplicados. O mapeamento de uma lista requer a inclusão de uma coluna de índice na tabela do banco de dados. A coluna índice define a posição do elemento na coleção, como visto na Figura 2 no mapeamento da coleção de telefones da entidade <B>Aluno</B> como sendo um <B>List</B>. Dessa maneira, o Hibernate pode preservar a ordenação da coleção quando recuperada do banco de dados e for mapeada como um <B>List</B>. Observe o mapeamento da coleção <B>telefones</B> na Listagem 5.
</P>


<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/img-02.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 2 - Coleção de telefones para Aluno: List
</P>


<PRE>...
&lt;list name="telefones" lazy="true" table="ALUNO_TELEFONE"&gt;
   &lt;key column="ID_ALUNO"/&gt;
   &lt;index column="POSICAO"/&gt;
   &lt;element type="java.lang.String" 
          column="TELEFONE" not-null="true"/&gt;
&lt;/list &gt;
...
</PRE>
<P class="legenda">
Listagem 5 – Coleções: List
</P>

<P>
Mapeando a coleção como um <B>List</B>, a chave primária da tabela <B>ALUNO_TELEFONE</B> passa a ser as colunas <B>ID_ALUNO</B> e <B>POSICAO</B>, permitindo a presença de telefones (<B>TELEFONE</B>) duplicados na coleção.
</P>

<H4>Maps

<P>
<B>Maps</B> associam chaves aos valores e não podem conter chaves duplicadas. Eles diferem de <B>Sets</B> no fato de que <B>Maps</B> contêm chaves e valores, ao passo que Sets contêm somente a chave.
</P>

<P>
O mapeamento de um <B>Map</B> é semelhante ao de um <B>List</B>, onde o índice de posição passa a ser a chave. Veja a Figura 3. A Listagem 6 apresenta a coleção de telefones sendo mapeada como um <B>Map</B>. A chave primária da tabela <B>ALUNO_TELEFONE</B> passa a ser as colunas <B>ID_ALUNO</B> e <B>CHAVE</B>, também permitindo a presença de telefones duplicados na coleção.
</P>

<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/img-03.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 3 - Coleção de telefones para Aluno: Map
</P>


<PRE>...
&lt;map name="telefones" lazy="true" table="ALUNO_TELEFONE"&gt;
   &lt;key column="ID_ALUNO"/&gt;
   &lt;index column="CHAVE" type="java.lang.String"/&gt;
   &lt;element type="java.lang.String" 
          column="TELEFONE" not-null="true"/&gt;
&lt;/map&gt;
...
</PRE>
<P class="legenda">
Listagem 6 – Coleções: Map
</P>


</H4><H4>Bag</H4>

<P>
Um <B>Bag</B> consiste em uma coleção desordenada que permite elementos duplicados. Em Java não há implementação de um <B>Bag</B>, contudo o Hibernate fornece um mecanismo de que um <B>List</B> em Java simule o comportamento de um <B>Bag</B>. Pela definição de um <B>List</B>, uma lista é uma coleção ordenada, contudo o Hibernate não preserva a ordenação quando um <B>List</B> é persistido com a semântica de um <B>Bag</B>. Para usar o <B>Bag</B>, a coleção de telefones deve ser definida com o tipo <B>List</B>. Um exemplo de mapeamento de um <B>Bag</B> pode ser visto na Figura 4 e Listagem 7. 
</P>


<P align="center">
<IMG src="./JEEBrasil_O_site_da_comunidade_Java_EE_no_Brasil-7_files/img-04.JPG" alt="JSP" title="JSP">
</P>

<P class="legenda">
Figura 4 - Coleção de telefones para Aluno: Bag
</P>

<P>
Para simular o <B>Bag</B> como <B>List</B>, a chave primária não deve ter associação com a posição do elemento na tabela, assim ao invés da tag <B>index</B>, utiliza-se a tag <B>collection-id</B>, onde uma chave substituta diferente é atribuída a cada linha da tabela na coleção. Entretanto, o Hibernate não fornece nenhum mecanismo para descobrir o valor chave substituta de uma linha em particular.
</P>

<PRE>...
&lt;idbag name="telefones" lazy="true" table="ALUNO_TELEFONE"&gt;
   &lt;collection-id type="long" column="ID_ALUNO_TELEFONE"&gt;
      &lt;generator class="sequence"/&gt;
   &lt;/collection-id&gt;
   &lt;key column="ID_ALUNO"/&gt;
   &lt;element type="java.lang.String" 
          column="TELEFONE" not-null="true"/&gt;
&lt;/idbag&gt;
...
</PRE>
<P class="legenda">
Listagem 7 - Coleções: Bag
</P>

<H4>Conclusões</H4>

<P>
Neste tutorial foram apresentados os mapeamentos de coleções (Bag, Map, List, Set) usando o Hibernate. No próximo tutorial será apresentado o mapeamento de herança utilizando três estratégias distintas: tabela por classe concreta, tabela por hierarquia, tabela por sub-classe. Neste tutorial foram apresentados os mapeamentos de coleções. O próximo tutorial trará o mapeamento de herança, abordando três estratégias distintas.
</P>


<H4> Referências</H4>

<OL>
	
<LI>Christian Bauer e Gavin King. Hibernate in Action. 2005.</LI>
<LI>Grupo Hibernate. Hibernate Reference 	Documentation. Version 3.0.5. Obtido 
     em http://www.hibernate.org</LI>
<LI>Gleydson de Azevedo Ferreira Lima. Material Didático. 2005.</LI>
<LI>Nick Heudecker. Introdução ao Hibernate.</LI>
<LI>Maurício Linhares. Introdução ao Hibernate 3.</LI>
<LI>Francesc Rosés Albiol. Introducción a Hibernate. 2003.</LI>
<LI>Fabiano Kraemer, Jerônimo Jardel Vogt. Hibernate, um Robusto Framework de 
     Persistência Objeto-Relacional. 2005.</LI>
</OL>



























		</DIV>

		<A name="comentarios"></A>
		
		<DIV id="listaComentarios">
		<H4> Comentários (1) </H4>
			<DL>
				
				<DT>
				Obrigado pelo ÓTIMO CONTEÚDO do site !
				</DT>
					<DD> postado por André Seoane em 25/06/2009 às 23:21</DD>
				
			</DL>
		</DIV>
		

	<DIV id="comente">
	<FORM action="http://www.jspbrasil.com.br/comentario" id="form" method="post">
	<FIELDSET>
		<LEGEND>Comente!</LEGEND>
		
		

		<DIV class="notes">
      	<H4>Observações</H4>
      	<P>Os campos em <STRONG>negrito</STRONG> são <STRONG>obrigatórios</STRONG>.</P>
      	<P>Para evitar problemas, este espaço é moderado. Após o envio do comentário será
      	necessário aguardar pela sua aprovação.</P>
    	</DIV> 
		
		<DIV class="obrigatorio">
		<LABEL for="nome">Nome:</LABEL> 
		<INPUT type="text" id="nome" class="required" name="nome" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="email">E-Mail:</LABEL> 
		<INPUT type="text" id="email" class="validate-email" name="email" size="58" value="">
		</DIV>
		
		<DIV class="optional">
		<LABEL for="site">Site:</LABEL> 
		<INPUT type="text" id="site" class="validate-url" name="site" size="58" value="">
		</DIV>
		
		<DIV class="obrigatorio">
		<LABEL for="texto">Comentário:</LABEL> 
		<TEXTAREA name="texto" id="texto" class="required" rows="5" cols="55"></TEXTAREA>
		</DIV>
		
	    <P class="botoes">    
			<INPUT type="submit" value="Enviar">
    	</P>
		
	</FIELDSET>

	<INPUT type="hidden" name="publicacao.id" value="15">
	</FORM>
	</DIV>
	<A name="bottom">


</A></DIV><A name="bottom"> <!-- fim de content -->

<SCRIPT type="text/javascript">
	var validForm = new Validation('form');
</SCRIPT>

</A></DIV><A name="bottom"> <!-- Fim de Content -->

</A><DIV id="footer"><A name="bottom">
	</A><A href="http://www.jspbrasil.com.br/quemsomos"> Quem Somos </A> &nbsp;|&nbsp;
	<A href="mailto:sugestoes@jeebrasil.com.br"> Fale Conosco</A>
	<P>Copyright 2006 - JEEBrasil.</P>
</DIV>

</DIV> <!-- fim de page -->



</BODY></HTML>