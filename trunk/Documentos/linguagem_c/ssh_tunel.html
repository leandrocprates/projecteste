<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="pt" xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head>





  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>
        Como Fazer um túnel com SSH 
        —
        Projeto CyberShark.net
    </title>

    
      
        <!-- base href="http://www.cybershark.net/tutoriais/ssh_tunel" -->
      
    

    <meta name="generator" content="Plone - http://plone.org">


    <!-- Plone ECMAScripts -->
    
        
            
                <script type="text/javascript" src="ssh_tunel_arquivos/ploneScripts5137.js">
                </script>
                
            
            
                <script type="text/javascript" src="ssh_tunel_arquivos/ploneScripts8659.js">
                </script>
                
            
        
    

    
        
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.cybershark.net/portal_css/Plone%20Default/ploneStyles9286.css); --></style>
                    
                    
                
            
            
                
                    <link rel="alternate stylesheet" type="text/css" media="screen" href="ssh_tunel_arquivos/ploneStyles5089.css" title="Small Text">
                    
                    
                
            
            
                
                    <link rel="alternate stylesheet" type="text/css" media="screen" href="ssh_tunel_arquivos/ploneStyles1702.css" title="Large Text">
                    
                    
                
            
            
                
                    
                    
                        <style type="text/css"><!-- @import url(http://www.cybershark.net/portal_css/Plone%20Default/ploneStyles9501.css); --></style>
                    
                    
                
            
        
    
    
    <!-- Internet Explorer CSS Fixes + IE7 for compliance fixes (limited set) -->
    <!--[if lt IE 7]>
        <style type="text/css" media="all">@import url(http://www.cybershark.net/IEFixes.css);</style>
    <![endif]-->

    <link rel="shortcut icon" type="image/x-icon" href="http://www.cybershark.net/favicon.ico">

    <!-- Put this inside iefixstart to apply the IE7 script. It will be very slow, and currently
         breaks with plonePrint.css and plonePresentation.css for unknown reasons.
        <script src="ie7-standard.js" type="text/javascript" tal:attributes="src string:$portal_url/ie7/ie7-standard.js"></script>
    -->


    <link rel="home" href="http://www.cybershark.net/" title="Front page">
    <link rel="search" title="Search this site" href="http://www.cybershark.net/search_form">
    <link rel="author" title="Author information" href="http://www.cybershark.net/author/Pablo%20Costa">
    <link rel="contents" href="http://www.cybershark.net/sitemap" title="Site Map">
    
    

    

    <link rel="up" href="http://www.cybershark.net/tutoriais" title="Up one level">

    

    <!-- Disable IE6 image toolbar -->
    <meta http-equiv="imagetoolbar" content="no">

    
      
      
    

    

      
    
    
    
    


      
      
    

    
      
      
    

  </head><body class="section-tutoriais" dir="ltr">
    <div id="visual-portal-wrapper">

      <div id="portal-top">

        <div id="portal-header">
          <a class="hiddenStructure" accesskey="2" href="http://www.cybershark.net/tutoriais/ssh_tunel#documentContent">Skip to content.</a>

          <a class="hiddenStructure" accesskey="6" href="http://www.cybershark.net/tutoriais/ssh_tunel#portlet-navigation-tree">Skip to navigation</a>

             <ul id="portal-siteactions">

    <li id="siteaction-sitemap"><a href="http://www.cybershark.net/sitemap" accesskey="3" title="Site Map">Site Map</a></li>
    <li id="siteaction-accessibility"><a href="http://www.cybershark.net/accessibility-info" accesskey="0" title="Accessibility">Accessibility</a></li>
    <li id="siteaction-contact"><a href="http://www.cybershark.net/contact-info" accesskey="9" title="Contact">Contact</a></li>

</ul>

             <div id="portal-searchbox">
    <form name="searchform" action="http://www.cybershark.net/search" style="white-space: nowrap;" onsubmit="return liveSearchSubmit()">

        <label for="searchGadget" class="hiddenStructure">Search Site</label>

        <div class="LSBox">
        <input autocomplete="off" id="searchGadget" name="SearchableText" size="15" title="Search Site" accesskey="4" class="visibility:visible" type="text">

        <input class="searchButton" value="Search" type="submit">

        <div class="LSResult" id="LSResult" style="display: none;"><div class="LSShadow" id="LSShadow"></div></div>
        </div>
    </form>

    <div id="portal-advanced-search" class="hiddenStructure">
        <a href="http://www.cybershark.net/search_form" accesskey="5">
            Advanced Search…
        </a>
    </div>

</div>

             <h1 id="portal-logo">
    <a href="http://www.cybershark.net/" accesskey="1">Projeto CyberShark.net</a>
</h1>

             <div id="portal-skinswitcher">
  
</div>
          </div>

          <div id="portal-personaltools-wrapper">

<h5 class="hiddenStructure">Personal tools</h5>

<ul id="portal-personaltools">
   

    
        <li>
            <a href="http://www.cybershark.net/login_form">
               Log in
            </a>
        </li>
    

</ul>
</div>

           <div id="portal-breadcrumbs">

    <span id="breadcrumbs-you-are-here">You 
are here:</span>
    <a href="http://www.cybershark.net/">Home</a>
    <span class="breadcrumbSeparator">
        → 
         
    </span>
    <span dir="ltr">
        
            <a href="http://www.cybershark.net/tutoriais">Dicas e Tutoriais</a>
            <span class="breadcrumbSeparator"> 
                → 
                 
            </span>
            
         
    </span>
    <span dir="ltr">
        
            
            
            <span>Como Fazer um túnel com SSH </span>
         
    </span>
<script type="text/javascript"><!--
google_ad_client = "pub-1880098684576611";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al_s";
google_ad_channel ="0735430825";
google_color_border = "333333";
google_color_bg = "333333";
google_color_link = "CCCCCC";
google_color_text = "FFFFFF";
google_color_url = "FFFFFF";
//--></script>
<script type="text/javascript" src="ssh_tunel_arquivos/show_ads.js">
</script><script src="ssh_tunel_arquivos/test_domain.js"></script><script>google_protectAndRun("ads_core.google_render_ad", google_handleError, google_render_ad);</script><iframe name="google_ads_frame" src="ssh_tunel_arquivos/ads.html" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" width="728" frameborder="0" height="15"></iframe>
</div>
      </div>

      <div class="visualClear"><!-- --></div>

      

      <table id="portal-columns">
        <tbody>
          <tr>
            
            <td id="portal-column-one">
              <div class="visualPadding">
                
                  

    
        

        
            

<dl class="portlet" id="portlet-navigation-tree">
    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
        <a href="http://www.cybershark.net/sitemap" class="tile">Navigation</a>
       
        <span class="portletTopRight"></span>
    </dt>

    <dd class="portletItem lastItem">
        <ul class="portletNavigationTree navTreeLevel0">

            <li class="navTreeItem">
                
                   <div class="visualIcon contenttype-plone-site">
                       <a class="visualIconPadding" href="http://www.cybershark.net/" title="Projeto voluntário de uma comunidade de usuários e amigos.">
                       Home
                       
                       </a>
                   </div>
                
            </li>
            



<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/Members" class="state-published visualIconPadding" title="Container for portal members' home directories">Members</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/tutoriais" class="state-published visualIconPadding" title="">Dicas e Tutoriais</a>
        
    </div>

    <ul class="navTree navTreeLevel2">
        

<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/apache_virtualhosts" class="state-published visualIconPadding" title="">Criando Domínios Virtuais no Apache</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/kernel_freebsd" class="state-published visualIconPadding" title="">Recompilando o kernel e Atualizando seu sistema FreeBSD</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/acl" class="state-published visualIconPadding" title="">Instalando e Manipulando ACL's POSIX em Sistemas Linux</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/ssh_tunel" class="state-published visualIconPadding navTreeCurrentItem" title="">Como Fazer um túnel com SSH </a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/proftpd_aix" class="state-published visualIconPadding" title="">Implementação de servidor ftp com Proftp em AIX </a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/nmon_aix" class="state-published visualIconPadding" title="">Nmon – Análise de performance em servidores Unix AIX</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/compartilhar_internet" class="state-published visualIconPadding" title="">Como compartilhar a sua Conexão Internet</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/amanda_hd" class="state-published visualIconPadding" title="">Backup em HD com Amanda</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/permissoes_unix" class="state-published visualIconPadding" title="">Permissões em Sistemas UNIX</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/squid" class="state-published visualIconPadding" title="">Personalizar páginas de erro do Squid</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/tutoriais/processo-de-auditoria-em-aix" class="state-published visualIconPadding" title="">Processo de auditoria em AIX</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-link">
        
        <a href="http://blog.cybershark.net/unix" class="state-published visualIconPadding" title="Nós mantemos, além desta seção de dicas, um BLOG com dicas de todos os tipos de UNIX. Passe por lá!">Unix Notes</a>
        
    </div>

    
    
</li>


    </ul>
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/artigos" class="state-published visualIconPadding" title="">Artigos</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/projetos" class="state-published visualIconPadding" title="">Projetos</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/cybershark" class="state-published visualIconPadding" title="Quem somos, qual nosso equipamento, dados sobre o projeto em geral.">CyberShark</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/downloads" class="state-published visualIconPadding" title="">Downloads</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/links" class="state-published visualIconPadding" title="">Links</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-link">
        
        <a href="http://webmail.cybershark.net/" class="state-published visualIconPadding" title="Sistema de Webmail do CyberShark.">Webmail</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-link">
        
        <a href="http://blog.cybershark.net/colabore" class="state-published visualIconPadding" title="">Colabore!</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-folder">
        
        <a href="http://www.cybershark.net/Contato" class="state-visible visualIconPadding" title="">Contato</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-link">
        
        <a href="http://blog.cybershark.net/" class="state-published visualIconPadding" title="">Blogs</a>
        
    </div>

    
    
</li>


<li class="navTreeItem visualNoMarker">

    

    <div class="visualIcon contenttype-document">
        
        <a href="http://www.cybershark.net/politica-de-privacidade" class="state-published visualIconPadding" title="Nossa política de privacidade">Política de privacidade</a>
        
    </div>

    
    
</li>




        </ul>
        <span class="portletBottomLeft"></span>
        <span class="portletBottomRight"></span>
    </dd>
</dl>


        

        

        
    

                
                &nbsp;
              </div>
            </td>
            

            
            <td id="portal-column-content">

              
                <div id="content" class="">

                  

                  <div class="documentContent" id="region-content">

                    <a name="documentContent"></a>

                    

    



                    

                    
    

        <div class="documentActions">
    

    <h5 class="hiddenStructure">Document Actions</h5>

    <ul>
    
        <li>
            <a href="http://www.cybershark.net/tutoriais/ssh_tunel/portal_form/sendto_form">

                <img src="ssh_tunel_arquivos/mail_icon.gif" alt="Send this page to somebody" title="Send this page to somebody" id="icon-sendto">
            </a>
        </li>
    
    
        <li>
            <a href="javascript:this.print();">

                <img src="ssh_tunel_arquivos/print_icon.gif" alt="Print this page" title="Print this page" id="icon-print">
            </a>
        </li>
    

    </ul>
    

    
      

    

    

</div>

        <h1 class="documentFirstHeading">Como Fazer um túnel com <span class="highlightedSearchTerm">SSH</span> </h1>
    
        <div>

    <div class="documentByLine">
        

        
          <span class="documentAuthor">
            by
          Pablo Costa

          —
          
          </span>
        

        <span class="documentModified">
            <span>
            last modified
            </span>
            13-06-2007 02:28 PM
        </span>

        

        

        

        
        http://creativecommons.org/licenses/by/2.0/br/deed.pt
        

        <div class="reviewHistory">
    
</div>

    </div>

</div>

        
        
    
        <div class="stx">
            <p>Imagine que você tenha um linux instalado numa intranet com ip não válido,
por exemplo 192.168.1.10, e que nesta rede tenha um firewall rodando um
NAT padrão.</p>
<p>Dai você deseja de fora pela internet acessar este seu linux que se encontra
atrás do firewall. Mas você não tem nenhuma amizade com o administrador da rede
para pedir um redirecionamento de portas, ou ele não permite pelas vias normais.</p>
<p>O que fazer??</p>
<p>Arregaçar as mangas e lançar mãos do interessante truque "<span class="highlightedSearchTerm">SSH</span> PORTFORWARD"</p>
<p>Com isto eu consigo fazer com que uma máquina interna faça um "forward"
de qualquer porta para um maquina externa na internet de modo que eu possa
capturar esta conexão mais tarde.</p>
<p>Primeiramente vou mostrar o modo mais básico de se fazer isto interativamente.
Depois vou ensinar como automatizar pelo crontab.</p>
<p>Vou utilizar da seguinte nomenclatura::
</p><pre>        REMOTEHOST = IP da Maquina na internet que você tem uma conta e roda <span class="highlightedSearchTerm">ssh</span>d
        REMOTEPORT = Porta tcp/ip na maquina remota que vai fazer o forward

        LOCALHOST = IP da Maquina na intranet que vai receber o portforward
        LOCALPORT = Porta tcp/ip da maquina da intranet que vai ser exportada
        user = usuário que você loga na maquina remota
</pre>

<p>Com o <span class="highlightedSearchTerm">ssh</span> instalado você deve executar o seguinte comando:</p>
<p>Exemplo de como fazer um forward local do telnet para um porta numa maquina remota::
</p><pre>        <span class="highlightedSearchTerm">ssh</span> -l user -R REMOTEPORT:LOCALHOST:LOCALPORT REMOTEHOST
</pre>

<p>Traduzindo em números para ficar mais fácil de visualizar::
</p><pre>        <span class="highlightedSearchTerm">ssh</span> -l user -R 2323:192.168.1.10:23 200.200.200.200
</pre>

<p>Vai ser pedida a senha do usuário "user" na máquina de ip 200.200.200.200
Você digita a senha e deixa parado no prompt.</p>
<p>De qualquer outra maquina da internet você pode fazer::
</p><pre>        telnet 200.200.200.200 2323
</pre>

<p>Que você cairá na maquina 192.168.1.10 da intranet. Muito legal !!!</p>
<p>Você não esta restrito a fazer forward somente de portas de sua maquina !! Pode especificar de qualquer uma da rede:</p>
<p>Exemplo::
</p><pre>        <span class="highlightedSearchTerm">ssh</span> -l user -R 2222:192.168.1.99:22 200.200.200.200
</pre>

<p>Dai resgataria a conexão assim::
</p><pre>        <span class="highlightedSearchTerm">ssh</span> -l user -p 2222 200.200.200.200
</pre>

<p>Você tem que às vezes remover o .<span class="highlightedSearchTerm">ssh</span>/know_hosts porque ele acumula chave de dois servidores de <span class="highlightedSearchTerm">ssh</span> diferentes e dá erro. Você pode remover somente a linha referente ao ip 200.200.200.200.</p>
<p>Mas este tipo de conexão é instável e portanto se você quer deixar
isto um pouco mais estável deve fazer algum tipo de monitoramento da
conexão e reiniciá-la quando necessário.</p>
<p>Eu sei que existem softwares para isto como vtun, rstunnel etc, mas tem que compilar e depender
de outras bibliotecas...então elaborei uma solução simples que usa apenas <span class="highlightedSearchTerm">ssh</span> e bash :-)</p>
<p>Agora vou especificar a solução com mais detalhes.</p>
<p>Na máquina da intranet "LOCALHOST" vamos <span class="highlightedSearchTerm">criar</span> uma chave do <span class="highlightedSearchTerm">ssh</span> para ser possível logar sem senha
no REMOTEHOST assim podemos colocar a conexão no crontab:</p>
<p>Tanto no LOCALHOST como no REMOTEHOST vou trabalhar com o usuário "user"</p>
<p>No LOCALHOST execute este comando::
</p><pre>        <span class="highlightedSearchTerm">ssh</span>-keygen -t dsa
</pre>

<p>E dê enter sem colocar senha:
</p><pre>        [root@192.168.1.10 root]# <span class="highlightedSearchTerm">ssh</span>-keygen -t dsa
        Generating public/private dsa key pair.
        Enter file in which to save the key (/root/.<span class="highlightedSearchTerm">ssh</span>/id_dsa):
        Enter passphrase (empty for no passphrase):
        Enter same passphrase again:
        Your identification has been saved in /root/.<span class="highlightedSearchTerm">ssh</span>/id_dsa.
        Your public key has been saved in /root/.<span class="highlightedSearchTerm">ssh</span>/id_dsa.pub.
</pre>

<p>Depois copie o arquivo /root/.<span class="highlightedSearchTerm">ssh</span>/id_dsa.pub no REMOMEHOST em /home/user/.<span class="highlightedSearchTerm">ssh</span>/authorized_keys</p>
<p>O <span class="highlightedSearchTerm">ssh</span>d_config que costuma ficar em /etc/<span class="highlightedSearchTerm">ssh</span>/<span class="highlightedSearchTerm">ssh</span>d_config do REMOTEHOST precisa ter estas configuracoes abaixo
par permitir o portforward::
</p><pre>        RSAAuthentication yes
        PubkeyAuthentication yes
        AuthorizedKeysFile .<span class="highlightedSearchTerm">ssh</span>/authorized_keys
        GatewayPorts yes
        AllowTcpForwarding yes
        --
</pre>

<p>Uma vez feito isto você deve conseguir logar em REMOTEHOST sem senha através do comando: <span class="highlightedSearchTerm">ssh</span> -l user REMOTEHOST</p>
<p>Ultrapassado o passo acima podemos retirar a shell do user no REMOTEHOST. Edite o /etc/passwd:
</p><pre>        user:*:1000:1000::0:0:User &amp;:/home/user:/sbin/nologin
</pre>

<p>Já que para fazer o forward não precisa ter uma shell.</p>
<p>Com isto tudo preparado o comando para se conectar no REMOTEHOST fica assim::
</p><pre>        <span class="highlightedSearchTerm">ssh</span> -l user -n -f -R REMOTEPORT:LOCALHOST:LOCALPORT -N REMOTEHOST
</pre>

<p>Explicando::
</p><pre>        -l : seleciona o usuário que vai logar
        -f : manda o <span class="highlightedSearchTerm">ssh</span> ir para background depois da execução
        -n : desvia o stdin para /dev/null ou seja não aparece nada na terra, nem motd
        -R : Faz o forward
        -N : Não execute nenhum comando no REMOTEHOST (Por isto que podemos por a shell como nologin)
</pre>

<p>Com tudo isto montado eu fiz alguns scripts simples para rodar no crontab e garantir a conexão::
</p><pre>        */1 * * * * /root/bin/online.sh 200.200.200.200
        0 */1 * * * /root/bin/uptime.sh 200.200.200.200
        5 */1 * * * /root/bin/rmlock.sh 200.200.200.200
</pre>

<p>Estes scripts rodam em linux, não testei com freebsd, mas deve dar diferença porque o netstat é diferente.</p>
<p>O online.sh roda de 1 em 1 minuto para verificar se a conexão esta ativa, se não estiver ele reinicia a conexão.</p>
<p>Ele usa como parametro um arquivo para você dizer quais os forward que você quer fazer</p>

<ul>
<li>arquivo deve ter o seguinte nome: REMOTEHOST.<span class="highlightedSearchTerm">ssh</span></li>

</ul>
<p>Exemplo:</p>

<ol>
<li>200.200.200.<span class="highlightedSearchTerm">ssh</span>:
<pre>        #LOCALHOST:LOCALPORT:REMOTEHOST:REMOTEPORT
        127.0.0.1:22:200.200.200.200:2222
        127.0.0.1:23:200.200.200.200:2323
        192.168.1.180:23:200.200.200.200:2301
</pre>
</li>

</ol>
<p>O uptime.sh só para garantir de hora em hora mata todas as conexões e as restabelece.</p>

<ul>
<li>rmlock.sh remove o lock que o uptime.sh faz para impedir de encavalar online.sh com uptime.sh</li>

</ul>
<p>Eu sei que está confuso, mas se alguém um dia for precisar vai entender :-))</p>
<p>Aqui estão os scripts:</p>
<p>online.sh::
</p><pre>        #!/bin/bash
        PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/root/bin

        SERVER="$1"
        FWFILE=/root/bin/$SERVER.<span class="highlightedSearchTerm">ssh</span>

        export LANG=en

        if [ -f /tmp/$SERVER ]
        then
                echo -e "Lock"
                exit
        fi

        if netstat -nt tcp | grep "$SERVER:22" | grep -qi ESTABLISHED;
        then
                true
        else

                #killall -9 <span class="highlightedSearchTerm">ssh</span>
                grep -v \# $FWFILE|\
                while IFS=: read LOCALHOST LOCALPORT REMOTEHOST REMOTEPORT
                do
                        <span class="highlightedSearchTerm">ssh</span> -n -f -l user -R $REMOTEPORT:$LOCALHOST:$LOCALPORT -N $REMOTEHOST
                done
                date | mail -s forward_update user@dominio.com.br
        fi
</pre>

<p>uptime.sh:
</p><pre>        #!/bin/bash

        PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/root/bin

        SERVER="$1"
        FWFILE=/root/bin/$SERVER.<span class="highlightedSearchTerm">ssh</span>

        export LANG=en

        touch /tmp/$SERVER

        netstat -ntp tcp | grep $SERVER |\
        while read line ; do
                set $line
                proc=`echo $7 | cut -d/ -f1`
                kill -9 $proc

        done

        grep -v \# $FWFILE|\
        while IFS=: read LOCALHOST LOCALPORT REMOTEHOST REMOTEPORT
        do
                <span class="highlightedSearchTerm">ssh</span> -n -f -l user -R $REMOTEPORT:$LOCALHOST:$LOCALPORT -N $REMOTEHOST
        done
        date | mail -s forward_update user@dominio.com.br

        rm -f /tmp/$SERVER
</pre>

<p>rmlock.sh:
</p><pre>        #!/bin/bash

        SERVER=$1
        rm -f /tmp/$SERVER
</pre>

<p>E finalmente o ps.sh que server para ver os pid das conexões abertas: usa-se ps.sh 200.200.200.200</p>
<p>ps.sh:
</p><pre>        #!/bin/bash

        export LANG=en

        SERVER=$1
        netstat -ntp tcp | grep $SERVER |\
        while read line ; do
                set $line
                proc=`echo $7 | cut -d/ -f1`
                ps $proc
        done
</pre>

<p></p><hr>
<p>Esse tutorial lhe foi útil? Economizou tempo ou dinheiro? <span class="link-external"><a href="http://www.cybershark.net/colabore">Que tal colaborar com o Cybershark</a></span>? Qualquer dólar ajuda :) <strong>MUITO OBRIGADO!</strong></p>

        </div>

        <div id="relatedItems">
    
        
            
        
    
</div>
    
    


                    
                      
                 
    
        <div class="discussion">
            <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/discussion_reply_form" method="post">
    
                  <input class="standalone" style="margin-bottom: 1.25em;" value="Add Comment" type="submit">
            </form>
            

            
                <div class="comment" style="margin-left: 0em;">
                    
                    <h3>
                        <a name="1105576491">
                        Parabens
                        </a>
                    </h3>
                    <div class="documentByLine">
                        <span>Posted by</span>
                        
                        <span>Anonymous User</span>
                        <span>at</span> 
                        12-01-2005 09:34 PM
                    </div>
                    <div class="commentBody"><p>gostei muito do vosso script, estava precisando disso... estou usando samba por <span class="highlightedSearchTerm">tunel</span> <span class="highlightedSearchTerm">ssh</span> via internet, isso ira me ajudar muito.</p>
<p>PARABENS PELO ARTIGO e SCRIPTS, OBRIGADO
Huandel </p>
</div>
                    <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/talkback/1105576491/discussion_reply_form" method="post" style="display: inline;">
                        <input class="standalone" value="Reply" type="submit">
                    </form>
                    
                </div>
            
            
                <div class="comment" style="margin-left: 2em;">
                    
                    <h3>
                        <a name="1119467220">
                        D++++
                        </a>
                    </h3>
                    <div class="documentByLine">
                        <span>Posted by</span>
                        
                        <span>Anonymous User</span>
                        <span>at</span> 
                        22-06-2005 04:07 PM
                    </div>
                    <div class="commentBody"><p>Simplesmente fantástico</p>
</div>
                    <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/talkback/1119467220/discussion_reply_form" method="post" style="display: inline;">
                        <input class="standalone" value="Reply" type="submit">
                    </form>
                    
                </div>
            
            
                <div class="comment" style="margin-left: 0em;">
                    
                    <h3>
                        <a name="1107433131">
                        Cadastro de usuarios
                        </a>
                    </h3>
                    <div class="documentByLine">
                        <span>Posted by</span>
                        
                        <span>Anonymous User</span>
                        <span>at</span> 
                        03-02-2005 09:18 AM
                    </div>
                    <div class="commentBody"><p>Gostaria
de cadastra usuario no linux via windows, fazer um script que quando
colocar passwd e senha no mesmo tempo sem precisar apertar a tecla
enter. Se alguem poder me ajudar eu agradeço.
Obrigado</p>
</div>
                    <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/talkback/1107433131/discussion_reply_form" method="post" style="display: inline;">
                        <input class="standalone" value="Reply" type="submit">
                    </form>
                    
                </div>
            
            
                <div class="comment" style="margin-left: 0em;">
                    
                    <h3>
                        <a name="1152797946">
                        Ajuda
                        </a>
                    </h3>
                    <div class="documentByLine">
                        <span>Posted by</span>
                        
                        <span>Anonymous User</span>
                        <span>at</span> 
                        13-07-2006 10:39 AM
                    </div>
                    <div class="commentBody"><p>Alguem conhece um servidor <span class="highlightedSearchTerm">ssh</span>d na internet gratuito e com suporte a PORTFORWARD?
Revirei tudo no Google e nao achei nada. Socorro!</p>
</div>
                    <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/talkback/1152797946/discussion_reply_form" method="post" style="display: inline;">
                        <input class="standalone" value="Reply" type="submit">
                    </form>
                    
                </div>
            
            
                <div class="comment" style="margin-left: 2em;">
                    
                    <h3>
                        <a name="1177523603">
                        <span class="highlightedSearchTerm">ssh</span>d gratuito
                        </a>
                    </h3>
                    <div class="documentByLine">
                        <span>Posted by</span>
                        
                        <span>Anonymous User</span>
                        <span>at</span> 
                        25-04-2007 02:53 PM
                    </div>
                    <div class="commentBody"><p>Um servidor <span class="highlightedSearchTerm">ssh</span>d gratuito e com suporte a PORTFORWARD é o Open<span class="highlightedSearchTerm">SSH</span>. :-)</p>
</div>
                    <form name="reply" action="http://www.cybershark.net/tutoriais/ssh_tunel/talkback/1177523603/discussion_reply_form" method="post" style="display: inline;">
                        <input class="standalone" value="Reply" type="submit">
                    </form>
                    
                </div>
            
        </div>
    

                    

                  </div>

                </div>

              
            </td>
            

            
            <td id="portal-column-two">
              <div class="visualPadding">
                
                  

    
        

        
            <div>

    <div class="portlet" id="portlet-adsense">

        <h5>Anúncios</h5>

        <div class="portletBody">

            <div class="portletContent odd">


<script type="text/javascript"><!--
google_ad_client = "pub-1880098684576611";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_type = "text_image";
google_ad_channel ="5046048047";
google_color_border = "333333";
google_color_bg = "333333";
google_color_link = "CCCCCC";
google_color_text = "FFFFFF";
google_color_url = "FFFFFF";
//--></script>
<script type="text/javascript" src="ssh_tunel_arquivos/show_ads.js">
</script><script src="ssh_tunel_arquivos/expansion_embed.js"></script><script>google_protectAndRun("ads_core.google_render_ad", google_handleError, google_render_ad);</script><ins style="border: medium none ; margin: 0pt; padding: 0pt; display: inline-table; height: 600px; position: relative; visibility: visible; width: 120px;"><ins style="border: medium none ; margin: 0pt; padding: 0pt; display: block; height: 600px; position: relative; visibility: visible; width: 120px;"><iframe allowtransparency="true" hspace="0" id="google_ads_frame2" marginheight="0" marginwidth="0" name="google_ads_frame" src="ssh_tunel_arquivos/ads_002.html" style="left: 0pt; position: absolute; top: 0pt;" vspace="0" scrolling="no" width="120" frameborder="0" height="600"></iframe></ins></ins>


            </div>

        </div>

     </div>

</div>
        

        

        
    
    
        

        
            
        

        

        
    
    
        

        
            
        

        

        
    
    
        

        
            
        

        

        
    

                
                &nbsp;
              </div>
            </td>
            
          </tr>
        </tbody>
      </table>
      

      <div class="visualClear"><!-- --></div>


      <hr class="netscape4">

      

        <div id="portal-footer">

<p>
    
<br></p>
<p>
© 2004 - 2006 by CyberShark.net - <a href="http://creativecommons.org/licenses/by/2.0/br/deed.pt">O conteúdo deste site pode ser reproduzido se citada a fonte e o autor.</a>
<br>
Este site utiliza o <a href="http://plone.org/">Plone</a> para gerenciar seu conteúdo.
<!-- Start of StatCounter Code -->
<script type="text/javascript" language="javascript">
<!-- 
var sc_project=476341; 
var sc_partition=2; 
var sc_invisible=1; 
//-->
</script>

<script type="text/javascript" language="javascript" src="ssh_tunel_arquivos/counter.js"></script><noscript><a
href="http://www.statcounter.com/" target="_blank"><img
src="http://c3.statcounter.com/counter.php?sc_project=476341&amp;java=0&amp;invisible=1"
alt="counter easy hit" border="0"></a> </noscript>
<!-- End of StatCounter Code -->

<script type="text/javascript" language="javascript" src="ssh_tunel_arquivos/counter.js"></script><noscript><a
href="http://www.statcounter.com/" target="_blank"><img
src="http://c3.statcounter.com/counter.php?sc_project=476341&amp;java=0"
alt="web hit counter" border="0"></a> </noscript>
<!-- End of StatCounter Code -->

</p><hr class="netscape4" size="">

</div>

        <div id="portal-colophon">
      

      <a href="http://plone.org/" class="colophonIcon colophonIconPlone" title="This Plone site was built using Plone CMS, the Open Source Content Management System. Click for more information.">
        Powered by Plone CMS, the Open Source Content Management System
      </a>

      

      <p class="discreet">
        This site conforms to the following standards:
      </p>

      <div class="colophonWrapper">
      <ul>
    <li>
      <a href="http://www.section508.gov/" class="colophonIcon colophonIcon508" title="This Plone site conforms to the US Government Section 508 Accessibility Guidelines.">
        Section 508
      </a>
    </li>
    <li>
      <a href="http://www.w3.org/WAI/WCAG1AA-Conformance" class="colophonIcon colophonIconWAI" title="This Plone site conforms to the W3C-WAI Web Content Accessibility Guidelines.">
        WCAG
      </a>
    </li>
    <li>
      <a href="http://validator.w3.org/check/referer" class="colophonIcon colophonIconXHTML" title="This Plone site is valid XHTML.">
        Valid XHTML
      </a>
    </li>
    <li>
      <a href="http://jigsaw.w3.org/css-validator/check/referer&amp;warning=no&amp;profile=css3&amp;usermedium=all" class="colophonIcon colophonIconCSS" title="This Plone site was built with valid CSS.">
        Valid CSS
      </a>
    </li>
    <li>
      <a href="http://plone.org/browsersupport" class="colophonIcon colophonIconAnyBrowser" title="This Plone site is usable in any web browser.">
        Usable in any browser
      </a>
    </li>
      </ul>
      </div>

    </div>
      

    </div>

</body></html>